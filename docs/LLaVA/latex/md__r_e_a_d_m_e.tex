\chapter{üåã LLa\+VA\+: Large Language and Vision Assistant}
\hypertarget{md__r_e_a_d_m_e}{}\label{md__r_e_a_d_m_e}\index{üåã LLaVA: Large Language and Vision Assistant@{üåã LLaVA: Large Language and Vision Assistant}}
\label{md__r_e_a_d_m_e_autotoc_md61}%
\Hypertarget{md__r_e_a_d_m_e_autotoc_md61}%


{\itshape Visual instruction tuning towards large language and vision models with GPT-\/4 level capabilities.}

\mbox{[}üì¢ \href{https://llava-vl.github.io/blog/2024-01-30-llava-next/}{\texttt{ LLa\+VA-\/\+Ne\+XT Blog}}\mbox{]} \mbox{[}\href{https://llava-vl.github.io/}{\texttt{ Project Page}}\mbox{]} \mbox{[}\href{https://llava.hliu.cc/}{\texttt{ Demo}}\mbox{]} \mbox{[}\href{https://github.com/haotian-liu/LLaVA/blob/main/docs/Data.md}{\texttt{ Data}}\mbox{]} \mbox{[}\href{https://github.com/haotian-liu/LLaVA/blob/main/docs/MODEL_ZOO.md}{\texttt{ Model Zoo}}\mbox{]}

ü§ù\+Community Contributions\+: \mbox{[}\href{https://github.com/ggerganov/llama.cpp/pull/3436}{\texttt{ llama.\+cpp}}\mbox{]} \mbox{[}\href{https://github.com/camenduru/LLaVA-colab}{\texttt{ Colab}}\mbox{]} \mbox{[}\href{https://huggingface.co/spaces/badayvedat/LLaVA}{\texttt{ ü§ó\+Space}}\mbox{]} \mbox{[}\href{https://replicate.com/yorickvp/llava-13b}{\texttt{ Replicate}}\mbox{]} \mbox{[}\href{https://github.com/microsoft/autogen/blob/main/notebook/agentchat_lmm_llava.ipynb}{\texttt{ Auto\+Gen}}\mbox{]} \mbox{[}\href{https://github.com/SkunkworksAI/BakLLaVA}{\texttt{ Bak\+LLa\+VA}}\mbox{]}

{\bfseries{Improved Baselines with Visual Instruction Tuning}} \mbox{[}\href{https://arxiv.org/abs/2310.03744}{\texttt{ Paper}}\mbox{]} \mbox{[}\href{https://huggingface.co/papers/2310.03744}{\texttt{ HF}}\mbox{]} ~\newline
 \href{https://hliu.cc}{\texttt{ Haotian Liu}}, \href{https://chunyuan.li/}{\texttt{ Chunyuan Li}}, \href{https://yuheng-li.github.io/}{\texttt{ Yuheng Li}}, \href{https://pages.cs.wisc.edu/~yongjaelee/}{\texttt{ Yong Jae Lee}}

{\bfseries{Visual Instruction Tuning}} (Neur\+IPS 2023, {\bfseries{Oral}}) \mbox{[}\href{https://arxiv.org/abs/2304.08485}{\texttt{ Paper}}\mbox{]} \mbox{[}\href{https://huggingface.co/papers/2304.08485}{\texttt{ HF}}\mbox{]} ~\newline
 \href{https://hliu.cc}{\texttt{ Haotian Liu\texorpdfstring{$\ast$}{*}}}, \href{https://chunyuan.li/}{\texttt{ Chunyuan Li\texorpdfstring{$\ast$}{*}}}, \href{https://scholar.google.ca/citations?user=HDiw-TsAAAAJ&hl=en/}{\texttt{ Qingyang Wu}}, \href{https://pages.cs.wisc.edu/~yongjaelee/}{\texttt{ Yong Jae Lee}} (\texorpdfstring{$\ast$}{*}\+Equal Contribution)\hypertarget{md__r_e_a_d_m_e_autotoc_md62}{}\doxysection{\texorpdfstring{Release}{Release}}\label{md__r_e_a_d_m_e_autotoc_md62}

\begin{DoxyItemize}
\item \mbox{[}2024/05/10\mbox{]} üî• {\bfseries{LLa\+VA-\/\+Ne\+XT}} (Stronger) models are released, stronger LMM with support of LLama-\/3 (8B) and Qwen-\/1.\+5 (72B/110B). \mbox{[}\href{https://llava-vl.github.io/blog/2024-05-10-llava-next-stronger-llms/}{\texttt{ Blog}}\mbox{]} \mbox{[}\href{https://huggingface.co/collections/lmms-lab/llava-next-6623288e2d61edba3ddbf5ff}{\texttt{ Checkpoints}}\mbox{]} \mbox{[}\href{https://llava-next.lmms-lab.com/}{\texttt{ Demo}}\mbox{]} \mbox{[}\href{https://github.com/LLaVA-VL/LLaVA-NeXT/}{\texttt{ Code}}\mbox{]}
\item \mbox{[}2024/05/10\mbox{]} üî• {\bfseries{LLa\+VA-\/\+Ne\+XT}} (Video) is released. The image-\/only-\/trained LLa\+VA-\/\+Ne\+XT model is surprisingly strong on video tasks with zero-\/shot modality transfer. DPO training with AI feedback on videos can yield significant improvement. \mbox{[}\href{https://llava-vl.github.io/blog/2024-04-30-llava-next-video/}{\texttt{ Blog}}\mbox{]} \mbox{[}\href{https://huggingface.co/collections/lmms-lab/llava-next-video-661e86f5e8dabc3ff793c944}{\texttt{ Checkpoints}}\mbox{]} \mbox{[}\href{https://github.com/LLaVA-VL/LLaVA-NeXT/}{\texttt{ Code}}\mbox{]}
\item \mbox{[}03/10\mbox{]} Releasing {\bfseries{LMMs-\/\+Eval}}, a highly efficient evaluation pipeline we used when developing LLa\+VA-\/\+Ne\+XT. It supports the evaluation of LMMs on dozens of public datasets and allows new dataset onboarding, making the dev of new LMMs much faster. \mbox{[}\href{https://lmms-lab.github.io/lmms-eval-blog/lmms-eval-0.1/}{\texttt{ Blog}}\mbox{]} \mbox{[}\href{https://github.com/EvolvingLMMs-Lab/lmms-eval}{\texttt{ Codebase}}\mbox{]}
\item \mbox{[}1/30\mbox{]} üî• {\bfseries{LLa\+VA-\/\+Ne\+XT}} (LLa\+VA-\/1.\+6) is out! With additional scaling to LLa\+VA-\/1.\+5, LLa\+VA-\/\+Ne\+XT-\/34B outperforms Gemini Pro on some benchmarks. It can now process 4x more pixels and perform more tasks/applications than before. Check out the \href{https://llava-vl.github.io/blog/2024-01-30-llava-next/}{\texttt{ blog post}}, and explore the \href{https://llava.hliu.cc/}{\texttt{ demo}}! Models are available in \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/MODEL_ZOO.md}{\texttt{ Model Zoo}}. Training/eval data and scripts coming soon.
\item \mbox{[}11/10\mbox{]} \href{https://llava-vl.github.io/llava-plus/}{\texttt{ LLa\+VA-\/\+Plus}} is released\+: Learning to Use Tools for Creating Multimodal Agents, with LLa\+VA-\/\+Plus (LLa\+VA that Plug and Learn to Use Skills). \mbox{[}\href{https://llava-vl.github.io/llava-plus/}{\texttt{ Project Page}}\mbox{]} \mbox{[}\href{https://llavaplus.ngrok.io/}{\texttt{ Demo}}\mbox{]} \mbox{[}\href{https://github.com/LLaVA-VL/LLaVA-Plus-Codebase}{\texttt{ Code}}\mbox{]} \mbox{[}\href{https://arxiv.org/abs/2311.05437}{\texttt{ Paper}}\mbox{]}
\item \mbox{[}11/2\mbox{]} \href{https://llava-vl.github.io/llava-interactive/}{\texttt{ LLa\+VA-\/\+Interactive}} is released\+: Experience the future of human-\/\+AI multimodal interaction with an all-\/in-\/one demo for Image Chat, Segmentation, Generation and Editing. \mbox{[}\href{https://llava-vl.github.io/llava-interactive/}{\texttt{ Project Page}}\mbox{]} \mbox{[}\href{https://llavainteractive.ngrok.io/}{\texttt{ Demo}}\mbox{]} \mbox{[}\href{https://github.com/LLaVA-VL/LLaVA-Interactive-Demo}{\texttt{ Code}}\mbox{]} \mbox{[}\href{https://arxiv.org/abs/2311.00571}{\texttt{ Paper}}\mbox{]}
\item \mbox{[}10/26\mbox{]} üî• LLa\+VA-\/1.\+5 with Lo\+RA achieves comparable performance as full-\/model finetuning, with a reduced GPU RAM requirement (\href{https://github.com/haotian-liu/LLaVA/blob/main/docs/MODEL_ZOO.md\#llava-v15}{\texttt{ ckpts}}, \href{https://github.com/haotian-liu/LLaVA\#train}{\texttt{ script}}). We also provide a \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/Finetune_Custom_Data.md}{\texttt{ doc}} on how to finetune LLa\+VA-\/1.\+5 on your own dataset with Lo\+RA.
\item \mbox{[}10/12\mbox{]} Check out the Korean LLa\+VA (Ko-\/\+LLa\+VA), created by ETRI, who has generously supported our research! \mbox{[}\href{https://huggingface.co/spaces/etri-vilab/Ko-LLaVA}{\texttt{ ü§ó Demo}}\mbox{]}
\item \mbox{[}10/5\mbox{]} üî• LLa\+VA-\/1.\+5 is out! Achieving So\+TA on 11 benchmarks, with just simple modifications to the original LLa\+VA, utilizes all public data, completes training in \texorpdfstring{$\sim$}{\string~}1 day on a single 8-\/A100 node, and surpasses methods like Qwen-\/\+VL-\/\+Chat that use billion-\/scale data. Check out the \href{https://arxiv.org/abs/2310.03744}{\texttt{ technical report}}, and explore the \href{https://llava.hliu.cc/}{\texttt{ demo}}! Models are available in \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/MODEL_ZOO.md}{\texttt{ Model Zoo}}. The training data and scripts of LLa\+VA-\/1.\+5 are released \href{https://github.com/haotian-liu/LLaVA\#train}{\texttt{ here}}, and evaluation scripts are released \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/Evaluation.md}{\texttt{ here}}!
\item \mbox{[}9/26\mbox{]} LLa\+VA is improved with reinforcement learning from human feedback (RLHF) to improve fact grounding and reduce hallucination. Check out the new SFT and RLHF checkpoints at project \href{https://llava-rlhf.github.io/}{\texttt{ \mbox{[}LLav\+A-\/\+RLHF\mbox{]}}}
\item \mbox{[}9/22\mbox{]} \href{https://arxiv.org/abs/2304.08485}{\texttt{ LLa\+VA}} is accepted by Neur\+IPS 2023 as {\bfseries{oral presentation}}, and \href{https://arxiv.org/abs/2306.00890}{\texttt{ LLa\+VA-\/\+Med}} is accepted by Neur\+IPS 2023 Datasets and Benchmarks Track as {\bfseries{spotlight presentation}}.
\end{DoxyItemize}



{\bfseries{More}}\begin{adjustwidth}{1em}{0em}



\begin{DoxyItemize}
\item \mbox{[}11/6\mbox{]} Support {\bfseries{Intel}} d\+GPU and CPU platforms. \href{https://github.com/haotian-liu/LLaVA/tree/intel/docs/intel}{\texttt{ More details here.}}
\item \mbox{[}10/12\mbox{]} LLa\+VA is now supported in \href{https://github.com/ggerganov/llama.cpp/pull/3436}{\texttt{ llama.\+cpp}} with 4-\/bit / 5-\/bit quantization support!
\item \mbox{[}10/11\mbox{]} The training data and scripts of LLa\+VA-\/1.\+5 are released \href{https://github.com/haotian-liu/LLaVA\#train}{\texttt{ here}}, and evaluation scripts are released \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/Evaluation.md}{\texttt{ here}}!
\item \mbox{[}10/10\mbox{]} \href{https://blog.roboflow.com/first-impressions-with-llava-1-5/}{\texttt{ Roboflow Deep Dive}}\+: First Impressions with LLa\+VA-\/1.\+5.
\item \mbox{[}9/20\mbox{]} We summarize our empirical study of training 33B and 65B LLa\+VA models in a \href{https://arxiv.org/abs/2309.09958}{\texttt{ note}}. Further, if you are interested in the comprehensive review, evolution and trend of multimodal foundation models, please check out our recent survey paper \href{https://arxiv.org/abs/2309.10020}{\texttt{ \`{}`Multimodal Foundation Models\+: From Specialists to General-\/\+Purpose Assistants'\textquotesingle{}.}} 
\end{DoxyItemize}

 




\begin{DoxyItemize}
\item \mbox{[}7/19\mbox{]} üî• We release a major upgrade, including support for LLa\+MA-\/2, Lo\+RA training, 4-\//8-\/bit inference, higher resolution (336x336), and a lot more. We release \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/LLaVA_Bench.md}{\texttt{ LLa\+VA Bench}} for benchmarking open-\/ended visual chat with results from Bard and Bing-\/\+Chat. We also support and verify training with RTX 3090 and RTX A6000. Check out \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/LLaVA_from_LLaMA2.md}{\texttt{ LLa\+VA-\/from-\/\+LLa\+MA-\/2}}, and our \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/MODEL_ZOO.md}{\texttt{ model zoo}}!
\item \mbox{[}6/26\mbox{]} \href{https://vlp-tutorial.github.io/}{\texttt{ CVPR 2023 Tutorial}} on {\bfseries{Large Multimodal Models\+: Towards Building and Surpassing Multimodal GPT-\/4}}! Please check out \mbox{[}\href{https://datarelease.blob.core.windows.net/tutorial/vision_foundation_models_2023/slides/Chunyuan_cvpr2023_tutorial_lmm.pdf}{\texttt{ Slides}}\mbox{]} \mbox{[}\href{https://arxiv.org/abs/2306.14895}{\texttt{ Notes}}\mbox{]} \mbox{[}\href{https://youtu.be/mkI7EPD1vp8}{\texttt{ You\+Tube}}\mbox{]} \mbox{[}\href{https://www.bilibili.com/video/BV1Ng4y1T7v3/}{\texttt{ Bilibli}}\mbox{]}.
\item \mbox{[}6/11\mbox{]} We released the preview for the most requested feature\+: Deep\+Speed and Lo\+RA support! Please see documentations \doxysectlink{md_docs_2_lo_r_a}{here}{0}.
\item \mbox{[}6/1\mbox{]} We released {\bfseries{LLa\+VA-\/\+Med\+: Large Language and Vision Assistant for Biomedicine}}, a step towards building biomedical domain large language and vision models with GPT-\/4 level capabilities. Checkout the \href{https://arxiv.org/abs/2306.00890}{\texttt{ paper}} and \href{https://github.com/microsoft/LLaVA-Med}{\texttt{ page}}.
\item \mbox{[}5/6\mbox{]} We are releasing \href{https://huggingface.co/liuhaotian/LLaVA-Lightning-MPT-7B-preview}{\texttt{ LLa\+VA-\/\+Lighting-\/\+MPT-\/7\+B-\/preview}}, based on MPT-\/7\+B-\/\+Chat! See here for more details.
\item \mbox{[}5/2\mbox{]} üî• We are releasing LLa\+VA-\/\+Lighting! Train a lite, multimodal GPT-\/4 with just \$40 in 3 hours! See here for more details.
\item \mbox{[}4/27\mbox{]} Thanks to the community effort, LLa\+VA-\/13B with 4-\/bit quantization allows you to run on a GPU with as few as 12GB VRAM! Try it out \href{https://github.com/oobabooga/text-generation-webui/tree/main/extensions/llava}{\texttt{ here}}.
\item \mbox{[}4/17\mbox{]} üî• We released {\bfseries{LLa\+VA\+: Large Language and Vision Assistant}}. We propose visual instruction tuning, towards building large language and vision models with GPT-\/4 level capabilities. Checkout the \href{https://arxiv.org/abs/2304.08485}{\texttt{ paper}} and \href{https://llava.hliu.cc/}{\texttt{ demo}}.
\end{DoxyItemize}

\end{adjustwidth}


\href{https://github.com/tatsu-lab/stanford_alpaca/blob/main/LICENSE}{\texttt{ }} {\bfseries{Usage and License Notices}}\+: This project utilizes certain datasets and checkpoints that are subject to their respective original licenses. Users must comply with all terms and conditions of these original licenses, including but not limited to the \href{https://openai.com/policies/terms-of-use}{\texttt{ Open\+AI Terms of Use}} for the dataset and the specific licenses for base language models for checkpoints trained using the dataset (e.\+g. \href{https://ai.meta.com/llama/license/}{\texttt{ Llama community license}} for LLa\+MA-\/2 and Vicuna-\/v1.\+5). This project does not impose any additional constraints beyond those stipulated in the original licenses. Furthermore, users are reminded to ensure that their use of the dataset and checkpoints is in compliance with all applicable laws and regulations.\hypertarget{md__r_e_a_d_m_e_autotoc_md63}{}\doxysection{\texorpdfstring{Contents}{Contents}}\label{md__r_e_a_d_m_e_autotoc_md63}

\begin{DoxyItemize}
\item Install
\item LLa\+VA Weights
\item Demo
\item \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/MODEL_ZOO.md}{\texttt{ Model Zoo}}
\item \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/Data.md}{\texttt{ Dataset}}
\item \doxylink{namespacetrain}{Train}
\item Evaluation
\end{DoxyItemize}\hypertarget{md__r_e_a_d_m_e_autotoc_md64}{}\doxysection{\texorpdfstring{Install}{Install}}\label{md__r_e_a_d_m_e_autotoc_md64}
If you are not using Linux, do {\itshape NOT} proceed, see instructions for \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/macOS.md}{\texttt{ mac\+OS}} and \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/Windows.md}{\texttt{ Windows}}.


\begin{DoxyEnumerate}
\item Clone this repository and navigate to LLa\+VA folder 
\begin{DoxyCode}{0}
\DoxyCodeLine{git\ clone\ https://github.com/haotian-\/liu/LLaVA.git}
\DoxyCodeLine{cd\ LLaVA}

\end{DoxyCode}

\item Install Package 
\begin{DoxyCode}{0}
\DoxyCodeLine{conda\ create\ -\/n\ llava\ python=3.10\ -\/y}
\DoxyCodeLine{conda\ activate\ llava}
\DoxyCodeLine{pip\ install\ -\/-\/upgrade\ pip\ \ \#\ enable\ PEP\ 660\ support}
\DoxyCodeLine{pip\ install\ -\/e\ .}

\end{DoxyCode}

\item Install additional packages for training cases 
\begin{DoxyCode}{0}
\DoxyCodeLine{pip\ install\ -\/e\ "{}.[train]"{}}
\DoxyCodeLine{pip\ install\ flash-\/attn\ -\/-\/no-\/build-\/isolation}

\end{DoxyCode}

\end{DoxyEnumerate}\hypertarget{md__r_e_a_d_m_e_autotoc_md65}{}\doxysubsection{\texorpdfstring{Upgrade to latest code base}{Upgrade to latest code base}}\label{md__r_e_a_d_m_e_autotoc_md65}

\begin{DoxyCode}{0}
\DoxyCodeLine{git\ pull}
\DoxyCodeLine{pip\ install\ -\/e\ .}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ if\ you\ see\ some\ import\ errors\ when\ you\ upgrade,}
\DoxyCodeLine{\#\ please\ try\ running\ the\ command\ below\ (without\ \#)}
\DoxyCodeLine{\#\ pip\ install\ flash-\/attn\ -\/-\/no-\/build-\/isolation\ -\/-\/no-\/cache-\/dir}

\end{DoxyCode}
\hypertarget{md__r_e_a_d_m_e_autotoc_md66}{}\doxysubsection{\texorpdfstring{Quick Start With Hugging\+Face}{Quick Start With Hugging\+Face}}\label{md__r_e_a_d_m_e_autotoc_md66}


{\bfseries{Example Code}}\begin{adjustwidth}{1em}{0em}



\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{from}\ \mbox{\hyperlink{namespacellava_1_1model_1_1builder}{llava.model.builder}}\ \textcolor{keyword}{import}\ load\_pretrained\_model}
\DoxyCodeLine{\textcolor{keyword}{from}\ \mbox{\hyperlink{namespacellava_1_1mm__utils}{llava.mm\_utils}}\ \textcolor{keyword}{import}\ get\_model\_name\_from\_path}
\DoxyCodeLine{\textcolor{keyword}{from}\ llava.eval.run\_llava\ \textcolor{keyword}{import}\ eval\_model}
\DoxyCodeLine{}
\DoxyCodeLine{model\_path\ =\ \textcolor{stringliteral}{"{}liuhaotian/llava-\/v1.5-\/7b"{}}}
\DoxyCodeLine{}
\DoxyCodeLine{tokenizer,\ model,\ image\_processor,\ context\_len\ =\ load\_pretrained\_model(}
\DoxyCodeLine{\ \ \ \ model\_path=model\_path,}
\DoxyCodeLine{\ \ \ \ model\_base=\textcolor{keywordtype}{None},}
\DoxyCodeLine{\ \ \ \ model\_name=get\_model\_name\_from\_path(model\_path)}
\DoxyCodeLine{)}

\end{DoxyCode}


Check out the details wth the {\ttfamily load\+\_\+pretrained\+\_\+model} function in {\ttfamily \doxylink{builder_8py}{llava/model/builder.\+py}}.

You can also use the {\ttfamily eval\+\_\+model} function in {\ttfamily \doxylink{run__llava_8py}{llava/eval/run\+\_\+llava.\+py}} to get the output easily. By doing so, you can use this code on Colab directly after downloading this repository.


\begin{DoxyCode}{0}
\DoxyCodeLine{\ python}
\DoxyCodeLine{model\_path\ =\ "{}liuhaotian/llava-\/v1.5-\/7b"{}}
\DoxyCodeLine{prompt\ =\ "{}What\ are\ the\ things\ I\ should\ be\ cautious\ about\ when\ I\ visit\ here?"{}}
\DoxyCodeLine{image\_file\ =\ "{}https://llava-\/vl.github.io/static/images/view.jpg"{}}
\DoxyCodeLine{}
\DoxyCodeLine{args\ =\ type('Args',\ (),\ \{}
\DoxyCodeLine{\ \ \ \ "{}model\_path"{}:\ model\_path,}
\DoxyCodeLine{\ \ \ \ "{}model\_base"{}:\ None,}
\DoxyCodeLine{\ \ \ \ "{}model\_name"{}:\ get\_model\_name\_from\_path(model\_path),}
\DoxyCodeLine{\ \ \ \ "{}query"{}:\ prompt,}
\DoxyCodeLine{\ \ \ \ "{}conv\_mode"{}:\ None,}
\DoxyCodeLine{\ \ \ \ "{}image\_file"{}:\ image\_file,}
\DoxyCodeLine{\ \ \ \ "{}sep"{}:\ "{},"{},}
\DoxyCodeLine{\ \ \ \ "{}temperature"{}:\ 0,}
\DoxyCodeLine{\ \ \ \ "{}top\_p"{}:\ None,}
\DoxyCodeLine{\ \ \ \ "{}num\_beams"{}:\ 1,}
\DoxyCodeLine{\ \ \ \ "{}max\_new\_tokens"{}:\ 512}
\DoxyCodeLine{\})()}
\DoxyCodeLine{}
\DoxyCodeLine{eval\_model(args)}

\end{DoxyCode}
 \end{adjustwidth}
\hypertarget{md__r_e_a_d_m_e_autotoc_md67}{}\doxysection{\texorpdfstring{LLa\+VA Weights}{LLa\+VA Weights}}\label{md__r_e_a_d_m_e_autotoc_md67}
Please check out our \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/MODEL_ZOO.md}{\texttt{ Model Zoo}} for all public LLa\+VA checkpoints, and the instructions of how to use the weights.\hypertarget{md__r_e_a_d_m_e_autotoc_md68}{}\doxysection{\texorpdfstring{Demo}{Demo}}\label{md__r_e_a_d_m_e_autotoc_md68}
\hypertarget{md__r_e_a_d_m_e_autotoc_md69}{}\doxysubsection{\texorpdfstring{Gradio Web UI}{Gradio Web UI}}\label{md__r_e_a_d_m_e_autotoc_md69}
To launch a Gradio demo locally, please run the following commands one by one. If you plan to launch multiple model workers to compare between different checkpoints, you only need to launch the controller and the web server {\itshape ONCE}.


\begin{DoxyCode}{0}
\DoxyCodeLine{flowchart\ BT}
\DoxyCodeLine{\ \ \ \ \%\%\ Declare\ Nodes}
\DoxyCodeLine{\ \ \ \ gws("{}Gradio\ (UI\ Server)"{})}
\DoxyCodeLine{\ \ \ \ c("{}Controller\ (API\ Server):<br/>PORT:\ 10000"{})}
\DoxyCodeLine{\ \ \ \ mw7b("{}Model\ Worker:<br/>llava-\/v1.5-\/7b<br/>PORT:\ 40000"{})}
\DoxyCodeLine{\ \ \ \ mw13b("{}Model\ Worker:<br/>llava-\/v1.5-\/13b<br/>PORT:\ 40001"{})}
\DoxyCodeLine{\ \ \ \ sglw13b("{}SGLang\ Backend:<br/>llava-\/v1.6-\/34b<br/>http://localhost:30000"{})}
\DoxyCodeLine{\ \ \ \ lsglw13b("{}SGLang\ Worker:<br/>llava-\/v1.6-\/34b<br/>PORT:\ 40002"{})}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \%\%\ Declare\ Styles}
\DoxyCodeLine{\ \ \ \ classDef\ data\ fill:\#3af,stroke:\#48a,stroke-\/width:2px,color:\#444}
\DoxyCodeLine{\ \ \ \ classDef\ success\ fill:\#8f8,stroke:\#0a0,stroke-\/width:2px,color:\#444}
\DoxyCodeLine{\ \ \ \ classDef\ failure\ fill:\#f88,stroke:\#f00,stroke-\/width:2px,color:\#444}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \%\%\ Assign\ Styles}
\DoxyCodeLine{\ \ \ \ class\ id,od\ data;}
\DoxyCodeLine{\ \ \ \ class\ cimg,cs\_s,scsim\_s\ success;}
\DoxyCodeLine{\ \ \ \ class\ ncimg,cs\_f,scsim\_f\ failure;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ subgraph\ Demo\ Connections}
\DoxyCodeLine{\ \ \ \ \ \ \ \ direction\ BT}
\DoxyCodeLine{\ \ \ \ \ \ \ \ c<-\/-\/>gws}
\DoxyCodeLine{\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ mw7b<-\/-\/>c}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mw13b<-\/-\/>c}
\DoxyCodeLine{\ \ \ \ \ \ \ \ lsglw13b<-\/-\/>c}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sglw13b<-\/-\/>lsglw13b}
\DoxyCodeLine{\ \ \ \ end}

\end{DoxyCode}
\hypertarget{md__r_e_a_d_m_e_autotoc_md70}{}\doxysubsubsection{\texorpdfstring{Launch a controller}{Launch a controller}}\label{md__r_e_a_d_m_e_autotoc_md70}

\begin{DoxyCode}{0}
\DoxyCodeLine{python\ -\/m\ llava.serve.controller\ -\/-\/host\ 0.0.0.0\ -\/-\/port\ 10000}

\end{DoxyCode}
\hypertarget{md__r_e_a_d_m_e_autotoc_md71}{}\doxysubsubsection{\texorpdfstring{Launch a gradio web server.}{Launch a gradio web server.}}\label{md__r_e_a_d_m_e_autotoc_md71}

\begin{DoxyCode}{0}
\DoxyCodeLine{python\ -\/m\ llava.serve.gradio\_web\_server\ -\/-\/controller\ http://localhost:10000\ -\/-\/model-\/list-\/mode\ reload}

\end{DoxyCode}
 You just launched the Gradio web interface. Now, you can open the web interface with the URL printed on the screen. You may notice that there is no model in the model list. Do not worry, as we have not launched any model worker yet. It will be automatically updated when you launch a model worker.\hypertarget{md__r_e_a_d_m_e_autotoc_md72}{}\doxysubsubsection{\texorpdfstring{Launch a SGLang worker}{Launch a SGLang worker}}\label{md__r_e_a_d_m_e_autotoc_md72}
This is the recommended way to serve LLa\+VA model with high throughput, and you need to install SGLang first. Note that currently {\ttfamily 4-\/bit} quantization is not supported yet on SGLang-\/\+LLa\+VA, and if you have limited GPU VRAM, please check out model worker with \href{https://github.com/haotian-liu/LLaVA?tab=readme-ov-file\#launch-a-model-worker-4-bit-8-bit-inference-quantized}{\texttt{ quantization}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{pip\ install\ "{}sglang[all]"{}}

\end{DoxyCode}


You\textquotesingle{}ll first launch a SGLang backend worker which will execute the models on GPUs. Remember the {\ttfamily -\/-\/port} you\textquotesingle{}ve set and you\textquotesingle{}ll use that later.


\begin{DoxyCode}{0}
\DoxyCodeLine{\#\ Single\ GPU}
\DoxyCodeLine{CUDA\_VISIBLE\_DEVICES=0\ python3\ -\/m\ sglang.launch\_server\ -\/-\/model-\/path\ liuhaotian/llava-\/v1.5-\/7b\ -\/-\/tokenizer-\/path\ llava-\/hf/llava-\/1.5-\/7b-\/hf\ -\/-\/port\ 30000}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Multiple\ GPUs\ with\ tensor\ parallel}
\DoxyCodeLine{CUDA\_VISIBLE\_DEVICES=0,1\ python3\ -\/m\ sglang.launch\_server\ -\/-\/model-\/path\ liuhaotian/llava-\/v1.5-\/13b\ -\/-\/tokenizer-\/path\ llava-\/hf/llava-\/1.5-\/13b-\/hf\ -\/-\/port\ 30000\ -\/-\/tp\ 2}

\end{DoxyCode}


Tokenizers (temporary)\+: {\ttfamily llava-\/hf/llava-\/1.\+5-\/7b-\/hf}, {\ttfamily llava-\/hf/llava-\/1.\+5-\/13b-\/hf}, {\ttfamily liuhaotian/llava-\/v1.\+6-\/34b-\/tokenizer}.

You\textquotesingle{}ll then launch a LLa\+VA-\/\+SGLang worker that will communicate between LLa\+VA controller and SGLang backend to route the requests. Set {\ttfamily -\/-\/sgl-\/endpoint} to {\ttfamily \href{http://127.0.0.1:port}{\texttt{ http\+://127.\+0.\+0.\+1\+:port}}} where {\ttfamily port} is the one you just set (default\+: 30000).


\begin{DoxyCode}{0}
\DoxyCodeLine{python\ -\/m\ llava.serve.sglang\_worker\ -\/-\/host\ 0.0.0.0\ -\/-\/controller\ http://localhost:10000\ -\/-\/port\ 40000\ -\/-\/worker\ http://localhost:40000\ -\/-\/sgl-\/endpoint\ http://127.0.0.1:30000}

\end{DoxyCode}
\hypertarget{md__r_e_a_d_m_e_autotoc_md73}{}\doxysubsubsection{\texorpdfstring{Launch a model worker}{Launch a model worker}}\label{md__r_e_a_d_m_e_autotoc_md73}
This is the actual {\itshape worker} that performs the inference on the GPU. Each worker is responsible for a single model specified in {\ttfamily -\/-\/model-\/path}.


\begin{DoxyCode}{0}
\DoxyCodeLine{python\ -\/m\ llava.serve.model\_worker\ -\/-\/host\ 0.0.0.0\ -\/-\/controller\ http://localhost:10000\ -\/-\/port\ 40000\ -\/-\/worker\ http://localhost:40000\ -\/-\/model-\/path\ liuhaotian/llava-\/v1.5-\/13b}

\end{DoxyCode}
 Wait until the process finishes loading the model and you see "{}\+Uvicorn running on ..."{}. Now, refresh your Gradio web UI, and you will see the model you just launched in the model list.

You can launch as many workers as you want, and compare between different model checkpoints in the same Gradio interface. Please keep the {\ttfamily -\/-\/controller} the same, and modify the {\ttfamily -\/-\/port} and {\ttfamily -\/-\/worker} to a different port number for each worker. 
\begin{DoxyCode}{0}
\DoxyCodeLine{python\ -\/m\ llava.serve.model\_worker\ -\/-\/host\ 0.0.0.0\ -\/-\/controller\ http://localhost:10000\ -\/-\/port\ <different\ from\ 40000,\ say\ 40001>\ -\/-\/worker\ http://localhost:<change\ accordingly,\ i.e.\ 40001>\ -\/-\/model-\/path\ <ckpt2>}

\end{DoxyCode}


If you are using an Apple device with an M1 or M2 chip, you can specify the mps device by using the {\ttfamily -\/-\/device} flag\+: {\ttfamily -\/-\/device mps}.\hypertarget{md__r_e_a_d_m_e_autotoc_md74}{}\doxysubsubsection{\texorpdfstring{Launch a model worker (Multiple GPUs, when GPU VRAM \texorpdfstring{$<$}{<}= 24GB)}{Launch a model worker (Multiple GPUs, when GPU VRAM \texorpdfstring{$<$}{<}= 24GB)}}\label{md__r_e_a_d_m_e_autotoc_md74}
If the VRAM of your GPU is less than 24GB (e.\+g., RTX 3090, RTX 4090, etc.), you may try running it with multiple GPUs. Our latest code base will automatically try to use multiple GPUs if you have more than one GPU. You can specify which GPUs to use with {\ttfamily CUDA\+\_\+\+VISIBLE\+\_\+\+DEVICES}. Below is an example of running with the first two GPUs.


\begin{DoxyCode}{0}
\DoxyCodeLine{CUDA\_VISIBLE\_DEVICES=0,1\ python\ -\/m\ llava.serve.model\_worker\ -\/-\/host\ 0.0.0.0\ -\/-\/controller\ http://localhost:10000\ -\/-\/port\ 40000\ -\/-\/worker\ http://localhost:40000\ -\/-\/model-\/path\ liuhaotian/llava-\/v1.5-\/13b}

\end{DoxyCode}
\hypertarget{md__r_e_a_d_m_e_autotoc_md75}{}\doxysubsubsection{\texorpdfstring{Launch a model worker (4-\/bit, 8-\/bit inference, quantized)}{Launch a model worker (4-\/bit, 8-\/bit inference, quantized)}}\label{md__r_e_a_d_m_e_autotoc_md75}
You can launch the model worker with quantized bits (4-\/bit, 8-\/bit), which allows you to run the inference with reduced GPU memory footprint, potentially allowing you to run on a GPU with as few as 12GB VRAM. Note that inference with quantized bits may not be as accurate as the full-\/precision model. Simply append {\ttfamily -\/-\/load-\/4bit} or {\ttfamily -\/-\/load-\/8bit} to the {\bfseries{model worker}} command that you are executing. Below is an example of running with 4-\/bit quantization.


\begin{DoxyCode}{0}
\DoxyCodeLine{python\ -\/m\ llava.serve.model\_worker\ -\/-\/host\ 0.0.0.0\ -\/-\/controller\ http://localhost:10000\ -\/-\/port\ 40000\ -\/-\/worker\ http://localhost:40000\ -\/-\/model-\/path\ liuhaotian/llava-\/v1.5-\/13b\ -\/-\/load-\/4bit}

\end{DoxyCode}
\hypertarget{md__r_e_a_d_m_e_autotoc_md76}{}\doxysubsubsection{\texorpdfstring{Launch a model worker (Lo\+RA weights, unmerged)}{Launch a model worker (Lo\+RA weights, unmerged)}}\label{md__r_e_a_d_m_e_autotoc_md76}
You can launch the model worker with Lo\+RA weights, without merging them with the base checkpoint, to save disk space. There will be additional loading time, while the inference speed is the same as the merged checkpoints. Unmerged Lo\+RA checkpoints do not have {\ttfamily lora-\/merge} in the model name, and are usually much smaller (less than 1GB) than the merged checkpoints (13G for 7B, and 25G for 13B).

To load unmerged Lo\+RA weights, you simply need to pass an additional argument {\ttfamily -\/-\/model-\/base}, which is the base LLM that is used to train the Lo\+RA weights. You can check the base LLM of each Lo\+RA weights in the \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/MODEL_ZOO.md}{\texttt{ model zoo}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{python\ -\/m\ llava.serve.model\_worker\ -\/-\/host\ 0.0.0.0\ -\/-\/controller\ http://localhost:10000\ -\/-\/port\ 40000\ -\/-\/worker\ http://localhost:40000\ -\/-\/model-\/path\ liuhaotian/llava-\/v1-\/0719-\/336px-\/lora-\/vicuna-\/13b-\/v1.3\ -\/-\/model-\/base\ lmsys/vicuna-\/13b-\/v1.3}

\end{DoxyCode}
\hypertarget{md__r_e_a_d_m_e_autotoc_md77}{}\doxysubsection{\texorpdfstring{CLI Inference}{CLI Inference}}\label{md__r_e_a_d_m_e_autotoc_md77}
Chat about images using LLa\+VA without the need of Gradio interface. It also supports multiple GPUs, 4-\/bit and 8-\/bit quantized inference. With 4-\/bit quantization, for our LLa\+VA-\/1.\+5-\/7B, it uses less than 8GB VRAM on a single GPU.


\begin{DoxyCode}{0}
\DoxyCodeLine{python\ -\/m\ llava.serve.cli\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/-\/model-\/path\ liuhaotian/llava-\/v1.5-\/7b\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/-\/image-\/file\ "{}https://llava-\/vl.github.io/static/images/view.jpg"{}\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/-\/load-\/4bit}

\end{DoxyCode}


\hypertarget{md__r_e_a_d_m_e_autotoc_md78}{}\doxysection{\texorpdfstring{Train}{Train}}\label{md__r_e_a_d_m_e_autotoc_md78}
{\itshape Below is the latest training configuration for LLa\+VA v1.\+5. For legacy models, please refer to README of \href{https://github.com/haotian-liu/LLaVA/tree/v1.0.1}{\texttt{ this}} version for now. We\textquotesingle{}ll add them in a separate doc later.}

LLa\+VA training consists of two stages\+: (1) feature alignment stage\+: use our 558K subset of the LAION-\/\+CC-\/\+SBU dataset to connect a {\itshape frozen pretrained} vision encoder to a {\itshape frozen LLM}; (2) visual instruction tuning stage\+: use 150K GPT-\/generated multimodal instruction-\/following data, plus around 515K VQA data from academic-\/oriented tasks, to teach the model to follow multimodal instructions.

LLa\+VA is trained on 8 A100 GPUs with 80GB memory. To train on fewer GPUs, you can reduce the {\ttfamily per\+\_\+device\+\_\+train\+\_\+batch\+\_\+size} and increase the {\ttfamily gradient\+\_\+accumulation\+\_\+steps} accordingly. Always keep the global batch size the same\+: {\ttfamily per\+\_\+device\+\_\+train\+\_\+batch\+\_\+size} x {\ttfamily gradient\+\_\+accumulation\+\_\+steps} x {\ttfamily num\+\_\+gpus}.\hypertarget{md__r_e_a_d_m_e_autotoc_md79}{}\doxysubsection{\texorpdfstring{Hyperparameters}{Hyperparameters}}\label{md__r_e_a_d_m_e_autotoc_md79}
We use a similar set of hyperparameters as Vicuna in finetuning. Both hyperparameters used in pretraining and finetuning are provided below.


\begin{DoxyEnumerate}
\item Pretraining
\end{DoxyEnumerate}

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{6}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Hyperparameter   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Global Batch Size   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Learning rate   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Epochs   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Max length   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Weight decay    }\\\cline{1-6}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Hyperparameter   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Global Batch Size   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Learning rate   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Epochs   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Max length   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Weight decay    }\\\cline{1-6}
\endhead
LLa\+VA-\/v1.\+5-\/13B   &\PBS\raggedleft 256   &\PBS\raggedleft 1e-\/3   &\PBS\raggedleft 1   &\PBS\raggedleft 2048   &\PBS\raggedleft 0   \\\cline{1-6}
\end{longtabu}



\begin{DoxyEnumerate}
\item Finetuning
\end{DoxyEnumerate}

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{6}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Hyperparameter   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Global Batch Size   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Learning rate   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Epochs   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Max length   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Weight decay    }\\\cline{1-6}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Hyperparameter   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Global Batch Size   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Learning rate   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Epochs   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Max length   }&\PBS\raggedleft \cellcolor{\tableheadbgcolor}\textbf{ Weight decay    }\\\cline{1-6}
\endhead
LLa\+VA-\/v1.\+5-\/13B   &\PBS\raggedleft 128   &\PBS\raggedleft 2e-\/5   &\PBS\raggedleft 1   &\PBS\raggedleft 2048   &\PBS\raggedleft 0   \\\cline{1-6}
\end{longtabu}
\hypertarget{md__r_e_a_d_m_e_autotoc_md80}{}\doxysubsection{\texorpdfstring{Download Vicuna checkpoints (automatically)}{Download Vicuna checkpoints (automatically)}}\label{md__r_e_a_d_m_e_autotoc_md80}
Our base model Vicuna v1.\+5, which is an instruction-\/tuned chatbot, will be downloaded automatically when you run our provided training scripts. No action is needed.\hypertarget{md__r_e_a_d_m_e_autotoc_md81}{}\doxysubsection{\texorpdfstring{Pretrain (feature alignment)}{Pretrain (feature alignment)}}\label{md__r_e_a_d_m_e_autotoc_md81}
Please download the 558K subset of the LAION-\/\+CC-\/\+SBU dataset with BLIP captions we use in the paper \href{https://huggingface.co/datasets/liuhaotian/LLaVA-Pretrain}{\texttt{ here}}.

Pretrain takes around 5.\+5 hours for LLa\+VA-\/v1.\+5-\/13B on 8x A100 (80G), due to the increased resolution to 336px. It takes around 3.\+5 hours for LLa\+VA-\/v1.\+5-\/7B.

Training script with Deep\+Speed Ze\+RO-\/2\+: \href{https://github.com/haotian-liu/LLaVA/blob/main/scripts/v1_5/pretrain.sh}{\texttt{ {\ttfamily pretrain.\+sh}}}.


\begin{DoxyItemize}
\item {\ttfamily -\/-\/mm\+\_\+projector\+\_\+type mlp2x\+\_\+gelu}\+: the two-\/layer MLP vision-\/language connector.
\item {\ttfamily -\/-\/vision\+\_\+tower openai/clip-\/vit-\/large-\/patch14-\/336}\+: CLIP Vi\+T-\/\+L/14 336px.
\end{DoxyItemize}



{\bfseries{Pretrain takes around 20 hours for LLa\+VA-\/7B on 8x V100 (32G)}}\begin{adjustwidth}{1em}{0em}


We provide training script with Deep\+Speed \href{https://github.com/haotian-liu/LLaVA/blob/main/scripts/pretrain_xformers.sh}{\texttt{ here}}. Tips\+:
\begin{DoxyItemize}
\item If you are using V100 which is not supported by Flash\+Attention, you can use the \href{https://arxiv.org/abs/2112.05682}{\texttt{ memory-\/efficient attention}} implemented in \href{https://github.com/facebookresearch/xformers}{\texttt{ x\+Formers}}. Install xformers and replace {\ttfamily \doxylink{train__mem_8py}{llava/train/train\+\_\+mem.\+py}} above with \href{llava/train/train_xformers.py}{\texttt{ llava/train/train\+\_\+xformers.\+py}}. 
\end{DoxyItemize}\end{adjustwidth}
\hypertarget{md__r_e_a_d_m_e_autotoc_md82}{}\doxysubsection{\texorpdfstring{Visual Instruction Tuning}{Visual Instruction Tuning}}\label{md__r_e_a_d_m_e_autotoc_md82}

\begin{DoxyEnumerate}
\item Prepare data
\end{DoxyEnumerate}

Please download the annotation of the final mixture our instruction tuning data \href{https://huggingface.co/datasets/liuhaotian/LLaVA-Instruct-150K/blob/main/llava_v1_5_mix665k.json}{\texttt{ llava\+\_\+v1\+\_\+5\+\_\+mix665k.\+json}}, and download the images from constituting datasets\+:


\begin{DoxyItemize}
\item COCO\+: \href{http://images.cocodataset.org/zips/train2017.zip}{\texttt{ train2017}}
\item GQA\+: \href{https://downloads.cs.stanford.edu/nlp/data/gqa/images.zip}{\texttt{ images}}
\item OCR-\/\+VQA\+: \href{https://drive.google.com/drive/folders/1_GYPY5UkUy7HIcR0zq3ZCFgeZN7BAfm_?usp=sharing}{\texttt{ download script}}, {\bfseries{we save all files as {\ttfamily .jpg}}}
\item Text\+VQA\+: \href{https://dl.fbaipublicfiles.com/textvqa/images/train_val_images.zip}{\texttt{ train\+\_\+val\+\_\+images}}
\item Visual\+Genome\+: \href{https://cs.stanford.edu/people/rak248/VG_100K_2/images.zip}{\texttt{ part1}}, \href{https://cs.stanford.edu/people/rak248/VG_100K_2/images2.zip}{\texttt{ part2}}
\end{DoxyItemize}

After downloading all of them, organize the data as follows in {\ttfamily ./playground/data},


\begin{DoxyCode}{0}
\DoxyCodeLine{‚îú‚îÄ‚îÄ\ coco}
\DoxyCodeLine{‚îÇ\ \ \ ‚îî‚îÄ‚îÄ\ train2017}
\DoxyCodeLine{‚îú‚îÄ‚îÄ\ gqa}
\DoxyCodeLine{‚îÇ\ \ \ ‚îî‚îÄ‚îÄ\ images}
\DoxyCodeLine{‚îú‚îÄ‚îÄ\ ocr\_vqa}
\DoxyCodeLine{‚îÇ\ \ \ ‚îî‚îÄ‚îÄ\ images}
\DoxyCodeLine{‚îú‚îÄ‚îÄ\ textvqa}
\DoxyCodeLine{‚îÇ\ \ \ ‚îî‚îÄ‚îÄ\ train\_images}
\DoxyCodeLine{‚îî‚îÄ‚îÄ\ vg}
\DoxyCodeLine{\ \ \ \ ‚îú‚îÄ‚îÄ\ VG\_100K}
\DoxyCodeLine{\ \ \ \ ‚îî‚îÄ‚îÄ\ VG\_100K\_2}

\end{DoxyCode}



\begin{DoxyEnumerate}
\item Start training!
\end{DoxyEnumerate}

You may download our pretrained projectors in \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/MODEL_ZOO.md}{\texttt{ Model Zoo}}. It is not recommended to use legacy projectors, as they may be trained with a different version of the codebase, and if any option is off, the model will not function/train as we expected.

Visual instruction tuning takes around 20 hours for LLa\+VA-\/v1.\+5-\/13B on 8x A100 (80G), due to the increased resolution to 336px. It takes around 10 hours for LLa\+VA-\/v1.\+5-\/7B on 8x A100 (40G).

Training script with Deep\+Speed Ze\+RO-\/3\+: \href{https://github.com/haotian-liu/LLaVA/blob/main/scripts/v1_5/finetune.sh}{\texttt{ {\ttfamily finetune.\+sh}}}.

If you are do not have enough GPU memory\+:


\begin{DoxyItemize}
\item Use Lo\+RA\+: \href{https://github.com/haotian-liu/LLaVA/blob/main/scripts/v1_5/finetune_lora.sh}{\texttt{ {\ttfamily finetune\+\_\+lora.\+sh}}}. We are able to fit 13B training in 8-\/A100-\/40\+G/8-\/\+A6000, and 7B training in 8-\/RTX3090. Make sure {\ttfamily per\+\_\+device\+\_\+train\+\_\+batch\+\_\+size\texorpdfstring{$\ast$}{*}gradient\+\_\+accumulation\+\_\+steps} is the same as the provided script for best reproducibility.
\item Replace {\ttfamily zero3.\+json} with {\ttfamily zero3\+\_\+offload.\+json} which offloads some parameters to CPU RAM. This slows down the training speed.
\end{DoxyItemize}

If you are interested in finetuning LLa\+VA model to your own task/data, please check out \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/Finetune_Custom_Data.md}{\texttt{ {\ttfamily Finetune\+\_\+\+Custom\+\_\+\+Data.\+md}}}„ÄÇ

New options to note\+:


\begin{DoxyItemize}
\item {\ttfamily -\/-\/mm\+\_\+projector\+\_\+type mlp2x\+\_\+gelu}\+: the two-\/layer MLP vision-\/language connector.
\item {\ttfamily -\/-\/vision\+\_\+tower openai/clip-\/vit-\/large-\/patch14-\/336}\+: CLIP Vi\+T-\/\+L/14 336px.
\item {\ttfamily -\/-\/image\+\_\+aspect\+\_\+ratio pad}\+: this pads the non-\/square images to square, instead of cropping them; it slightly reduces hallucination.
\item {\ttfamily -\/-\/group\+\_\+by\+\_\+modality\+\_\+length True}\+: this should only be used when your instruction tuning dataset contains both language (e.\+g. Share\+GPT) and multimodal (e.\+g. LLa\+VA-\/\+Instruct). It makes the training sampler only sample a single modality (either image or language) during training, which we observe to speed up training by \texorpdfstring{$\sim$}{\string~}25\%, and does not affect the final outcome.
\end{DoxyItemize}\hypertarget{md__r_e_a_d_m_e_autotoc_md83}{}\doxysection{\texorpdfstring{Evaluation}{Evaluation}}\label{md__r_e_a_d_m_e_autotoc_md83}
In LLa\+VA-\/1.\+5, we evaluate models on a diverse set of 12 benchmarks. To ensure the reproducibility, we evaluate the models with greedy decoding. We do not evaluate using beam search to make the inference process consistent with the chat demo of real-\/time outputs.

See \href{https://github.com/haotian-liu/LLaVA/blob/main/docs/Evaluation.md}{\texttt{ Evaluation.\+md}}.\hypertarget{md__r_e_a_d_m_e_autotoc_md84}{}\doxysubsection{\texorpdfstring{GPT-\/assisted Evaluation}{GPT-\/assisted Evaluation}}\label{md__r_e_a_d_m_e_autotoc_md84}
Our GPT-\/assisted evaluation pipeline for multimodal modeling is provided for a comprehensive understanding of the capabilities of vision-\/language models. Please see our paper for more details.


\begin{DoxyEnumerate}
\item Generate LLa\+VA responses
\end{DoxyEnumerate}


\begin{DoxyCode}{0}
\DoxyCodeLine{python\ model\_vqa.py\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/-\/model-\/path\ ./checkpoints/LLaVA-\/13B-\/v0\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/-\/question-\/file\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ playground/data/coco2014\_val\_qa\_eval/qa90\_questions.jsonl\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/-\/image-\/folder\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ /path/to/coco2014\_val\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/-\/answers-\/file\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ /path/to/answer-\/file-\/our.jsonl}

\end{DoxyCode}



\begin{DoxyEnumerate}
\item Evaluate the generated responses. In our case, \href{./playground/data/coco2014_val_qa_eval/qa90_gpt4_answer.jsonl}{\texttt{ {\ttfamily answer-\/file-\/ref.\+jsonl}}} is the response generated by text-\/only GPT-\/4 (0314), with the context captions/boxes provided.
\end{DoxyEnumerate}


\begin{DoxyCode}{0}
\DoxyCodeLine{OPENAI\_API\_KEY="{}sk-\/***********************************"{}\ python\ llava/eval/eval\_gpt\_review\_visual.py\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/-\/question\ playground/data/coco2014\_val\_qa\_eval/qa90\_questions.jsonl\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/-\/context\ llava/eval/table/caps\_boxes\_coco2014\_val\_80.jsonl\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/-\/answer-\/list\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ /path/to/answer-\/file-\/ref.jsonl\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ /path/to/answer-\/file-\/our.jsonl\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/-\/rule\ llava/eval/table/rule.json\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/-\/output\ /path/to/review.json}

\end{DoxyCode}



\begin{DoxyEnumerate}
\item Summarize the evaluation results
\end{DoxyEnumerate}


\begin{DoxyCode}{0}
\DoxyCodeLine{python\ summarize\_gpt\_review.py}

\end{DoxyCode}
\hypertarget{md__r_e_a_d_m_e_autotoc_md85}{}\doxysection{\texorpdfstring{Citation}{Citation}}\label{md__r_e_a_d_m_e_autotoc_md85}
If you find LLa\+VA useful for your research and applications, please cite using this Bib\+TeX\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{@misc\{liu2024llavanext,}
\DoxyCodeLine{\ \ \ \ title=\{LLaVA-\/NeXT:\ Improved\ reasoning,\ OCR,\ and\ world\ knowledge\},}
\DoxyCodeLine{\ \ \ \ url=\{https://llava-\/vl.github.io/blog/2024-\/01-\/30-\/llava-\/next/\},}
\DoxyCodeLine{\ \ \ \ author=\{Liu,\ Haotian\ and\ Li,\ Chunyuan\ and\ Li,\ Yuheng\ and\ Li,\ Bo\ and\ Zhang,\ Yuanhan\ and\ Shen,\ Sheng\ and\ Lee,\ Yong\ Jae\},}
\DoxyCodeLine{\ \ \ \ month=\{January\},}
\DoxyCodeLine{\ \ \ \ year=\{2024\}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{@misc\{liu2023improvedllava,}
\DoxyCodeLine{\ \ \ \ \ \ title=\{Improved\ Baselines\ with\ Visual\ Instruction\ Tuning\},\ }
\DoxyCodeLine{\ \ \ \ \ \ author=\{Liu,\ Haotian\ and\ Li,\ Chunyuan\ and\ Li,\ Yuheng\ and\ Lee,\ Yong\ Jae\},}
\DoxyCodeLine{\ \ \ \ \ \ publisher=\{arXiv:2310.03744\},}
\DoxyCodeLine{\ \ \ \ \ \ year=\{2023\},}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{@misc\{liu2023llava,}
\DoxyCodeLine{\ \ \ \ \ \ title=\{Visual\ Instruction\ Tuning\},\ }
\DoxyCodeLine{\ \ \ \ \ \ author=\{Liu,\ Haotian\ and\ Li,\ Chunyuan\ and\ Wu,\ Qingyang\ and\ Lee,\ Yong\ Jae\},}
\DoxyCodeLine{\ \ \ \ \ \ publisher=\{NeurIPS\},}
\DoxyCodeLine{\ \ \ \ \ \ year=\{2023\},}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__r_e_a_d_m_e_autotoc_md86}{}\doxysection{\texorpdfstring{Acknowledgement}{Acknowledgement}}\label{md__r_e_a_d_m_e_autotoc_md86}

\begin{DoxyItemize}
\item \href{https://github.com/lm-sys/FastChat}{\texttt{ Vicuna}}\+: the codebase we built upon, and our base model Vicuna-\/13B that has the amazing language capabilities!
\end{DoxyItemize}\hypertarget{md__r_e_a_d_m_e_autotoc_md87}{}\doxysection{\texorpdfstring{Related Projects}{Related Projects}}\label{md__r_e_a_d_m_e_autotoc_md87}

\begin{DoxyItemize}
\item \href{https://github.com/Instruction-Tuning-with-GPT-4/GPT-4-LLM}{\texttt{ Instruction Tuning with GPT-\/4}}
\item \href{https://github.com/microsoft/LLaVA-Med}{\texttt{ LLa\+VA-\/\+Med\+: Training a Large Language-\/and-\/\+Vision Assistant for Biomedicine in One Day}}
\item \href{https://github.com/Luodian/Otter}{\texttt{ Otter\+: In-\/\+Context Multi-\/\+Modal Instruction Tuning}}
\end{DoxyItemize}

For future project ideas, please check out\+:
\begin{DoxyItemize}
\item \href{https://github.com/UX-Decoder/Segment-Everything-Everywhere-All-At-Once}{\texttt{ SEEM\+: Segment Everything Everywhere All at Once}}
\item \href{https://github.com/IDEA-Research/Grounded-Segment-Anything}{\texttt{ Grounded-\/\+Segment-\/\+Anything}} to detect, segment, and generate anything by marrying \href{https://github.com/IDEA-Research/GroundingDINO}{\texttt{ Grounding DINO}} and \href{https://github.com/facebookresearch/segment-anything}{\texttt{ Segment-\/\+Anything}}. 
\end{DoxyItemize}