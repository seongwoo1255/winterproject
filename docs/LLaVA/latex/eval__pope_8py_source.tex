\doxysection{eval\+\_\+pope.\+py}
\hypertarget{eval__pope_8py_source}{}\label{eval__pope_8py_source}\index{llava/eval/eval\_pope.py@{llava/eval/eval\_pope.py}}
\mbox{\hyperlink{eval__pope_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00001}\mbox{\hyperlink{namespaceeval__pope}{00001}}\ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00002}00002\ \textcolor{keyword}{import}\ json}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00003}00003\ \textcolor{keyword}{import}\ argparse}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00005}\mbox{\hyperlink{namespaceeval__pope_a52e243ef5d768d0c945ee6fa02710a12}{00005}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceeval__pope}{eval\_pope}}(answers,\ label\_file):}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00006}00006\ \ \ \ \ label\_list\ =\ [json.loads(q)[\textcolor{stringliteral}{'label'}]\ \textcolor{keywordflow}{for}\ q\ \textcolor{keywordflow}{in}\ open(label\_file,\ \textcolor{stringliteral}{'r'})]}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00008}00008\ \ \ \ \ \textcolor{keywordflow}{for}\ answer\ \textcolor{keywordflow}{in}\ answers:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00009}00009\ \ \ \ \ \ \ \ \ text\ =\ answer[\textcolor{stringliteral}{'text'}]}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00010}00010\ }
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00011}00011\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Only\ keep\ the\ first\ sentence}}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00012}00012\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ text.find(\textcolor{stringliteral}{'.'})\ !=\ -\/1:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00013}00013\ \ \ \ \ \ \ \ \ \ \ \ \ text\ =\ text.split(\textcolor{stringliteral}{'.'})[0]}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00015}00015\ \ \ \ \ \ \ \ \ text\ =\ text.replace(\textcolor{stringliteral}{','},\ \textcolor{stringliteral}{''})}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00016}00016\ \ \ \ \ \ \ \ \ words\ =\ text.split(\textcolor{stringliteral}{'\ '})}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00017}00017\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{'No'}\ \textcolor{keywordflow}{in}\ words\ \textcolor{keywordflow}{or}\ \textcolor{stringliteral}{'not'}\ \textcolor{keywordflow}{in}\ words\ \textcolor{keywordflow}{or}\ \textcolor{stringliteral}{'no'}\ \textcolor{keywordflow}{in}\ words:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00018}00018\ \ \ \ \ \ \ \ \ \ \ \ \ answer[\textcolor{stringliteral}{'text'}]\ =\ \textcolor{stringliteral}{'no'}}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00019}00019\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00020}00020\ \ \ \ \ \ \ \ \ \ \ \ \ answer[\textcolor{stringliteral}{'text'}]\ =\ \textcolor{stringliteral}{'yes'}}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00021}00021\ }
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00022}00022\ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(len(label\_list)):}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00023}00023\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ label\_list[i]\ ==\ \textcolor{stringliteral}{'no'}:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00024}00024\ \ \ \ \ \ \ \ \ \ \ \ \ label\_list[i]\ =\ 0}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00025}00025\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00026}00026\ \ \ \ \ \ \ \ \ \ \ \ \ label\_list[i]\ =\ 1}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00028}00028\ \ \ \ \ pred\_list\ =\ []}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00029}00029\ \ \ \ \ \textcolor{keywordflow}{for}\ answer\ \textcolor{keywordflow}{in}\ answers:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00030}00030\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ answer[\textcolor{stringliteral}{'text'}]\ ==\ \textcolor{stringliteral}{'no'}:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00031}00031\ \ \ \ \ \ \ \ \ \ \ \ \ pred\_list.append(0)}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00032}00032\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00033}00033\ \ \ \ \ \ \ \ \ \ \ \ \ pred\_list.append(1)}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00034}00034\ }
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00035}00035\ \ \ \ \ pos\ =\ 1}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00036}00036\ \ \ \ \ neg\ =\ 0}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00037}00037\ \ \ \ \ yes\_ratio\ =\ pred\_list.count(1)\ /\ len(pred\_list)}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00039}00039\ \ \ \ \ TP,\ TN,\ FP,\ FN\ =\ 0,\ 0,\ 0,\ 0}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00040}00040\ \ \ \ \ \textcolor{keywordflow}{for}\ pred,\ label\ \textcolor{keywordflow}{in}\ zip(pred\_list,\ label\_list):}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00041}00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ pred\ ==\ pos\ \textcolor{keywordflow}{and}\ label\ ==\ pos:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00042}00042\ \ \ \ \ \ \ \ \ \ \ \ \ TP\ +=\ 1}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00043}00043\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ pred\ ==\ pos\ \textcolor{keywordflow}{and}\ label\ ==\ neg:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00044}00044\ \ \ \ \ \ \ \ \ \ \ \ \ FP\ +=\ 1}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00045}00045\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ pred\ ==\ neg\ \textcolor{keywordflow}{and}\ label\ ==\ neg:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00046}00046\ \ \ \ \ \ \ \ \ \ \ \ \ TN\ +=\ 1}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00047}00047\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ pred\ ==\ neg\ \textcolor{keywordflow}{and}\ label\ ==\ pos:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00048}00048\ \ \ \ \ \ \ \ \ \ \ \ \ FN\ +=\ 1}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00049}00049\ }
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00050}00050\ \ \ \ \ print(\textcolor{stringliteral}{'TP\(\backslash\)tFP\(\backslash\)tTN\(\backslash\)tFN\(\backslash\)t'})}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00051}00051\ \ \ \ \ print(\textcolor{stringliteral}{'\{\}\(\backslash\)t\{\}\(\backslash\)t\{\}\(\backslash\)t\{\}'}.format(TP,\ FP,\ TN,\ FN))}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00052}00052\ }
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00053}00053\ \ \ \ \ precision\ =\ float(TP)\ /\ float(TP\ +\ FP)}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00054}00054\ \ \ \ \ recall\ =\ float(TP)\ /\ float(TP\ +\ FN)}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00055}00055\ \ \ \ \ f1\ =\ 2*precision*recall\ /\ (precision\ +\ recall)}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00056}00056\ \ \ \ \ acc\ =\ (TP\ +\ TN)\ /\ (TP\ +\ TN\ +\ FP\ +\ FN)}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00057}00057\ \ \ \ \ print(\textcolor{stringliteral}{'Accuracy:\ \{\}'}.format(acc))}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00058}00058\ \ \ \ \ print(\textcolor{stringliteral}{'Precision:\ \{\}'}.format(precision))}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00059}00059\ \ \ \ \ print(\textcolor{stringliteral}{'Recall:\ \{\}'}.format(recall))}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00060}00060\ \ \ \ \ print(\textcolor{stringliteral}{'F1\ score:\ \{\}'}.format(f1))}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00061}00061\ \ \ \ \ print(\textcolor{stringliteral}{'Yes\ ratio:\ \{\}'}.format(yes\_ratio))}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00062}00062\ \ \ \ \ print(\textcolor{stringliteral}{'\%.3f,\ \%.3f,\ \%.3f,\ \%.3f,\ \%.3f'}\ \%\ (f1,\ acc,\ precision,\ recall,\ yes\_ratio)\ )}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00063}00063\ }
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00064}00064\ \textcolor{keywordflow}{if}\ \_\_name\_\_\ ==\ \textcolor{stringliteral}{"{}\_\_main\_\_"{}}:}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00065}\mbox{\hyperlink{namespaceeval__pope_ad1a4f3177767b98b69663b18c1a1537f}{00065}}\ \ \ \ \ parser\ =\ argparse.ArgumentParser()}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00066}\mbox{\hyperlink{namespaceeval__pope_acb56e1455f37b77d5a1a893d5e539dec}{00066}}\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/annotation-\/dir"{}},\ type=str)}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00067}00067\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/question-\/file"{}},\ type=str)}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00068}00068\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/result-\/file"{}},\ type=str)}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00069}\mbox{\hyperlink{namespaceeval__pope_a21f3bc0a3e0186a80227f20aedabe904}{00069}}\ \ \ \ \ args\ =\ parser.parse\_args()}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00070}00070\ }
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00071}\mbox{\hyperlink{namespaceeval__pope_a00d11b6bb8d179a945200a0811fb22f3}{00071}}\ \ \ \ \ questions\ =\ [json.loads(line)\ \textcolor{keywordflow}{for}\ line\ \textcolor{keywordflow}{in}\ open(args.question\_file)]}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00072}00072\ \ \ \ \ questions\ =\ \{question[\textcolor{stringliteral}{'question\_id'}]:\ question\ \textcolor{keywordflow}{for}\ question\ \textcolor{keywordflow}{in}\ questions\}}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00073}\mbox{\hyperlink{namespaceeval__pope_a2a40bb03ad27a654dd4e1a1340b6070f}{00073}}\ \ \ \ \ answers\ =\ [json.loads(q)\ \textcolor{keywordflow}{for}\ q\ \textcolor{keywordflow}{in}\ open(args.result\_file)]}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00074}00074\ \ \ \ \ \textcolor{keywordflow}{for}\ file\ \textcolor{keywordflow}{in}\ os.listdir(args.annotation\_dir):}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00075}00075\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ file.startswith(\textcolor{stringliteral}{'coco\_pope\_'})}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00076}00076\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ file.endswith(\textcolor{stringliteral}{'.json'})}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00077}\mbox{\hyperlink{namespaceeval__pope_a6e6897f8a310712acd0ddf1ab3ff15c2}{00077}}\ \ \ \ \ \ \ \ \ category\ =\ file[10:-\/5]}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00078}\mbox{\hyperlink{namespaceeval__pope_ad85c31915ca1a716e011c9315e5cda81}{00078}}\ \ \ \ \ \ \ \ \ cur\_answers\ =\ [x\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ answers\ \textcolor{keywordflow}{if}\ questions[x[\textcolor{stringliteral}{'question\_id'}]][\textcolor{stringliteral}{'category'}]\ ==\ category]}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00079}00079\ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{'Category:\ \{\},\ \#\ samples:\ \{\}'}.format(category,\ len(cur\_answers)))}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00080}00080\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceeval__pope}{eval\_pope}}(cur\_answers,\ os.path.join(args.annotation\_dir,\ file))}
\DoxyCodeLine{\Hypertarget{eval__pope_8py_source_l00081}00081\ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{"{}===================================="{}})}

\end{DoxyCode}
