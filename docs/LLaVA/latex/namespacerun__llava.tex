\doxysection{run\+\_\+llava Namespace Reference}
\hypertarget{namespacerun__llava}{}\label{namespacerun__llava}\index{run\_llava@{run\_llava}}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacerun__llava_a1a9fa4d532f496e027c2fd41d4ea396a}{image\+\_\+parser}} (\mbox{\hyperlink{namespacerun__llava_a97df31f2c8e43ce7535abe58edb02ed5}{args}})
\item 
\mbox{\hyperlink{namespacerun__llava_a4520023ea63a4c31df6ba02451d285d4}{load\+\_\+image}} (image\+\_\+file)
\item 
\mbox{\hyperlink{namespacerun__llava_a9fe46554dac093cad50d5698fe44f00b}{load\+\_\+images}} (image\+\_\+files)
\item 
\mbox{\hyperlink{namespacerun__llava_a28158121cca9af176b13b01b2ef290f4}{eval\+\_\+model}} (\mbox{\hyperlink{namespacerun__llava_a97df31f2c8e43ce7535abe58edb02ed5}{args}})
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacerun__llava_ad5efc31b33e146ff3ec32ca0588c3a4c}{parser}} = argparse.\+Argument\+Parser()
\item 
\mbox{\hyperlink{namespacerun__llava_aff493185455c104572f719d25cc73c78}{type}}
\item 
\mbox{\hyperlink{namespacerun__llava_aac8acd0e145ef0a0348c3b0ae8c6d0f1}{str}}
\item 
\mbox{\hyperlink{namespacerun__llava_a2783747959ed1f933391aec93ed911c4}{default}}
\item 
\mbox{\hyperlink{namespacerun__llava_a8a3293b3a19b9a3d3a3a44af088a715a}{required}}
\item 
\mbox{\hyperlink{namespacerun__llava_a52cbf3400c1d7134bf3982068c9c29bb}{float}}
\item 
\mbox{\hyperlink{namespacerun__llava_afd578ba363d27ee17bfd484fafb406b6}{int}}
\item 
\mbox{\hyperlink{namespacerun__llava_a97df31f2c8e43ce7535abe58edb02ed5}{args}} = parser.\+parse\+\_\+args()
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\Hypertarget{namespacerun__llava_a28158121cca9af176b13b01b2ef290f4}\index{run\_llava@{run\_llava}!eval\_model@{eval\_model}}
\index{eval\_model@{eval\_model}!run\_llava@{run\_llava}}
\doxysubsubsection{\texorpdfstring{eval\_model()}{eval\_model()}}
{\footnotesize\ttfamily \label{namespacerun__llava_a28158121cca9af176b13b01b2ef290f4} 
run\+\_\+llava.\+eval\+\_\+model (\begin{DoxyParamCaption}\item[{}]{args}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{run__llava_8py_source_l00050}{50}} of file \mbox{\hyperlink{run__llava_8py_source}{run\+\_\+llava.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00050\ \textcolor{keyword}{def\ }eval\_model(args):}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{comment}{\#\ Model}}
\DoxyCodeLine{00052\ \ \ \ \ disable\_torch\_init()}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ model\_name\ =\ get\_model\_name\_from\_path(args.model\_path)}
\DoxyCodeLine{00055\ \ \ \ \ tokenizer,\ model,\ image\_processor,\ context\_len\ =\ load\_pretrained\_model(}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ args.model\_path,\ args.model\_base,\ model\_name}
\DoxyCodeLine{00057\ \ \ \ \ )}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ qs\ =\ args.query}
\DoxyCodeLine{00060\ \ \ \ \ image\_token\_se\ =\ DEFAULT\_IM\_START\_TOKEN\ +\ DEFAULT\_IMAGE\_TOKEN\ +\ DEFAULT\_IM\_END\_TOKEN}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordflow}{if}\ IMAGE\_PLACEHOLDER\ \textcolor{keywordflow}{in}\ qs:}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ model.config.mm\_use\_im\_start\_end:}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ qs\ =\ re.sub(IMAGE\_PLACEHOLDER,\ image\_token\_se,\ qs)}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ qs\ =\ re.sub(IMAGE\_PLACEHOLDER,\ DEFAULT\_IMAGE\_TOKEN,\ qs)}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ model.config.mm\_use\_im\_start\_end:}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ qs\ =\ image\_token\_se\ +\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}\ +\ qs}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ qs\ =\ DEFAULT\_IMAGE\_TOKEN\ +\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}\ +\ qs}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}llama-\/2"{}}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ conv\_mode\ =\ \textcolor{stringliteral}{"{}llava\_llama\_2"{}}}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{"{}mistral"{}}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ conv\_mode\ =\ \textcolor{stringliteral}{"{}mistral\_instruct"{}}}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{"{}v1.6-\/34b"{}}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ conv\_mode\ =\ \textcolor{stringliteral}{"{}chatml\_direct"{}}}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{"{}v1"{}}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ conv\_mode\ =\ \textcolor{stringliteral}{"{}llava\_v1"{}}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{"{}mpt"{}}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ conv\_mode\ =\ \textcolor{stringliteral}{"{}mpt"{}}}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ conv\_mode\ =\ \textcolor{stringliteral}{"{}llava\_v0"{}}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordflow}{if}\ args.conv\_mode\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{and}\ conv\_mode\ !=\ args.conv\_mode:}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ print(}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}[WARNING]\ the\ auto\ inferred\ conversation\ mode\ is\ \{\},\ while\ \`{}-\/-\/conv-\/mode`\ is\ \{\},\ using\ \{\}"{}}.format(}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ conv\_mode,\ args.conv\_mode,\ args.conv\_mode}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ args.conv\_mode\ =\ conv\_mode}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \ \ conv\ =\ conv\_templates[args.conv\_mode].copy()}
\DoxyCodeLine{00095\ \ \ \ \ conv.append\_message(conv.roles[0],\ qs)}
\DoxyCodeLine{00096\ \ \ \ \ conv.append\_message(conv.roles[1],\ \textcolor{keywordtype}{None})}
\DoxyCodeLine{00097\ \ \ \ \ prompt\ =\ conv.get\_prompt()}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \ \ image\_files\ =\ image\_parser(args)}
\DoxyCodeLine{00100\ \ \ \ \ images\ =\ load\_images(image\_files)}
\DoxyCodeLine{00101\ \ \ \ \ image\_sizes\ =\ [x.size\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ images]}
\DoxyCodeLine{00102\ \ \ \ \ images\_tensor\ =\ process\_images(}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ images,}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ image\_processor,}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ model.config}
\DoxyCodeLine{00106\ \ \ \ \ ).to(model.device,\ dtype=torch.float16)}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \ \ input\_ids\ =\ (}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ tokenizer\_image\_token(prompt,\ tokenizer,\ IMAGE\_TOKEN\_INDEX,\ return\_tensors=\textcolor{stringliteral}{"{}pt"{}})}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ .unsqueeze(0)}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ .cuda()}
\DoxyCodeLine{00112\ \ \ \ \ )}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keyword}{with}\ torch.inference\_mode():}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ output\_ids\ =\ model.generate(}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ input\_ids,}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ images=images\_tensor,}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ image\_sizes=image\_sizes,}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ do\_sample=\textcolor{keyword}{True}\ \textcolor{keywordflow}{if}\ args.temperature\ >\ 0\ \textcolor{keywordflow}{else}\ \textcolor{keyword}{False},}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ temperature=args.temperature,}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ top\_p=args.top\_p,}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ num\_beams=args.num\_beams,}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ max\_new\_tokens=args.max\_new\_tokens,}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ use\_cache=\textcolor{keyword}{True},}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \ \ outputs\ =\ tokenizer.batch\_decode(output\_ids,\ skip\_special\_tokens=\textcolor{keyword}{True})[0].strip()}
\DoxyCodeLine{00128\ \ \ \ \ print(outputs)}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ }

\end{DoxyCode}
Here is the call graph for this function\+:
% FIG 0
\Hypertarget{namespacerun__llava_a1a9fa4d532f496e027c2fd41d4ea396a}\index{run\_llava@{run\_llava}!image\_parser@{image\_parser}}
\index{image\_parser@{image\_parser}!run\_llava@{run\_llava}}
\doxysubsubsection{\texorpdfstring{image\_parser()}{image\_parser()}}
{\footnotesize\ttfamily \label{namespacerun__llava_a1a9fa4d532f496e027c2fd41d4ea396a} 
run\+\_\+llava.\+image\+\_\+parser (\begin{DoxyParamCaption}\item[{}]{args}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{run__llava_8py_source_l00028}{28}} of file \mbox{\hyperlink{run__llava_8py_source}{run\+\_\+llava.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00028\ \textcolor{keyword}{def\ }image\_parser(args):}
\DoxyCodeLine{00029\ \ \ \ \ out\ =\ args.image\_file.split(args.sep)}
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keywordflow}{return}\ out}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
% FIG 1
\Hypertarget{namespacerun__llava_a4520023ea63a4c31df6ba02451d285d4}\index{run\_llava@{run\_llava}!load\_image@{load\_image}}
\index{load\_image@{load\_image}!run\_llava@{run\_llava}}
\doxysubsubsection{\texorpdfstring{load\_image()}{load\_image()}}
{\footnotesize\ttfamily \label{namespacerun__llava_a4520023ea63a4c31df6ba02451d285d4} 
run\+\_\+llava.\+load\+\_\+image (\begin{DoxyParamCaption}\item[{}]{image\+\_\+file}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{run__llava_8py_source_l00033}{33}} of file \mbox{\hyperlink{run__llava_8py_source}{run\+\_\+llava.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00033\ \textcolor{keyword}{def\ }load\_image(image\_file):}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keywordflow}{if}\ image\_file.startswith(\textcolor{stringliteral}{"{}http"{}})\ \textcolor{keywordflow}{or}\ image\_file.startswith(\textcolor{stringliteral}{"{}https"{}}):}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ response\ =\ requests.get(image\_file)}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ image\ =\ Image.open(BytesIO(response.content)).convert(\textcolor{stringliteral}{"{}RGB"{}})}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ image\ =\ Image.open(image\_file).convert(\textcolor{stringliteral}{"{}RGB"{}})}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
% FIG 2
\Hypertarget{namespacerun__llava_a9fe46554dac093cad50d5698fe44f00b}\index{run\_llava@{run\_llava}!load\_images@{load\_images}}
\index{load\_images@{load\_images}!run\_llava@{run\_llava}}
\doxysubsubsection{\texorpdfstring{load\_images()}{load\_images()}}
{\footnotesize\ttfamily \label{namespacerun__llava_a9fe46554dac093cad50d5698fe44f00b} 
run\+\_\+llava.\+load\+\_\+images (\begin{DoxyParamCaption}\item[{}]{image\+\_\+files}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{run__llava_8py_source_l00042}{42}} of file \mbox{\hyperlink{run__llava_8py_source}{run\+\_\+llava.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00042\ \textcolor{keyword}{def\ }load\_images(image\_files):}
\DoxyCodeLine{00043\ \ \ \ \ out\ =\ []}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordflow}{for}\ image\_file\ \textcolor{keywordflow}{in}\ image\_files:}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ image\ =\ load\_image(image\_file)}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ out.append(image)}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordflow}{return}\ out}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ }

\end{DoxyCode}
Here is the call graph for this function\+:
% FIG 3
Here is the caller graph for this function\+:
% FIG 4


\doxysubsection{Variable Documentation}
\Hypertarget{namespacerun__llava_a97df31f2c8e43ce7535abe58edb02ed5}\index{run\_llava@{run\_llava}!args@{args}}
\index{args@{args}!run\_llava@{run\_llava}}
\doxysubsubsection{\texorpdfstring{args}{args}}
{\footnotesize\ttfamily \label{namespacerun__llava_a97df31f2c8e43ce7535abe58edb02ed5} 
run\+\_\+llava.\+args = parser.\+parse\+\_\+args()}



Definition at line \mbox{\hyperlink{run__llava_8py_source_l00143}{143}} of file \mbox{\hyperlink{run__llava_8py_source}{run\+\_\+llava.\+py}}.

\Hypertarget{namespacerun__llava_a2783747959ed1f933391aec93ed911c4}\index{run\_llava@{run\_llava}!default@{default}}
\index{default@{default}!run\_llava@{run\_llava}}
\doxysubsubsection{\texorpdfstring{default}{default}}
{\footnotesize\ttfamily \label{namespacerun__llava_a2783747959ed1f933391aec93ed911c4} 
run\+\_\+llava.\+default}



Definition at line \mbox{\hyperlink{run__llava_8py_source_l00133}{133}} of file \mbox{\hyperlink{run__llava_8py_source}{run\+\_\+llava.\+py}}.

\Hypertarget{namespacerun__llava_a52cbf3400c1d7134bf3982068c9c29bb}\index{run\_llava@{run\_llava}!float@{float}}
\index{float@{float}!run\_llava@{run\_llava}}
\doxysubsubsection{\texorpdfstring{float}{float}}
{\footnotesize\ttfamily \label{namespacerun__llava_a52cbf3400c1d7134bf3982068c9c29bb} 
run\+\_\+llava.\+float}



Definition at line \mbox{\hyperlink{run__llava_8py_source_l00139}{139}} of file \mbox{\hyperlink{run__llava_8py_source}{run\+\_\+llava.\+py}}.

\Hypertarget{namespacerun__llava_afd578ba363d27ee17bfd484fafb406b6}\index{run\_llava@{run\_llava}!int@{int}}
\index{int@{int}!run\_llava@{run\_llava}}
\doxysubsubsection{\texorpdfstring{int}{int}}
{\footnotesize\ttfamily \label{namespacerun__llava_afd578ba363d27ee17bfd484fafb406b6} 
run\+\_\+llava.\+int}



Definition at line \mbox{\hyperlink{run__llava_8py_source_l00141}{141}} of file \mbox{\hyperlink{run__llava_8py_source}{run\+\_\+llava.\+py}}.

\Hypertarget{namespacerun__llava_ad5efc31b33e146ff3ec32ca0588c3a4c}\index{run\_llava@{run\_llava}!parser@{parser}}
\index{parser@{parser}!run\_llava@{run\_llava}}
\doxysubsubsection{\texorpdfstring{parser}{parser}}
{\footnotesize\ttfamily \label{namespacerun__llava_ad5efc31b33e146ff3ec32ca0588c3a4c} 
run\+\_\+llava.\+parser = argparse.\+Argument\+Parser()}



Definition at line \mbox{\hyperlink{run__llava_8py_source_l00132}{132}} of file \mbox{\hyperlink{run__llava_8py_source}{run\+\_\+llava.\+py}}.

\Hypertarget{namespacerun__llava_a8a3293b3a19b9a3d3a3a44af088a715a}\index{run\_llava@{run\_llava}!required@{required}}
\index{required@{required}!run\_llava@{run\_llava}}
\doxysubsubsection{\texorpdfstring{required}{required}}
{\footnotesize\ttfamily \label{namespacerun__llava_a8a3293b3a19b9a3d3a3a44af088a715a} 
run\+\_\+llava.\+required}



Definition at line \mbox{\hyperlink{run__llava_8py_source_l00135}{135}} of file \mbox{\hyperlink{run__llava_8py_source}{run\+\_\+llava.\+py}}.

\Hypertarget{namespacerun__llava_aac8acd0e145ef0a0348c3b0ae8c6d0f1}\index{run\_llava@{run\_llava}!str@{str}}
\index{str@{str}!run\_llava@{run\_llava}}
\doxysubsubsection{\texorpdfstring{str}{str}}
{\footnotesize\ttfamily \label{namespacerun__llava_aac8acd0e145ef0a0348c3b0ae8c6d0f1} 
run\+\_\+llava.\+str}



Definition at line \mbox{\hyperlink{run__llava_8py_source_l00133}{133}} of file \mbox{\hyperlink{run__llava_8py_source}{run\+\_\+llava.\+py}}.

\Hypertarget{namespacerun__llava_aff493185455c104572f719d25cc73c78}\index{run\_llava@{run\_llava}!type@{type}}
\index{type@{type}!run\_llava@{run\_llava}}
\doxysubsubsection{\texorpdfstring{type}{type}}
{\footnotesize\ttfamily \label{namespacerun__llava_aff493185455c104572f719d25cc73c78} 
run\+\_\+llava.\+type}



Definition at line \mbox{\hyperlink{run__llava_8py_source_l00133}{133}} of file \mbox{\hyperlink{run__llava_8py_source}{run\+\_\+llava.\+py}}.

