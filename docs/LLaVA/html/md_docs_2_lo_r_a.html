<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLaVA: LLaVA (LoRA, Preview)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LLaVA<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_docs_2_lo_r_a.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">LLaVA (LoRA, Preview)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md35"></a></p>
<p>NOTE: This is a technical preview, and is not yet ready for production use. We are still running hyperparameter search for the LoRA model, and will release the final model soon. If you'd like to contribute to this, please contact us.</p>
<p>You need latest code base for LoRA support (instructions <a href="https://github.com/haotian-liu/LLaVA#upgrade-to-latest-code-base">here</a>)</p>
<h1><a class="anchor" id="autotoc_md36"></a>
Demo (Web UI)</h1>
<p>Please execute each of the commands below one by one (after the previous one has finished). The commands are the same as launching other demos except for an additional <code>--model-base</code> flag to specify the base model to use. Please make sure the base model corresponds to the LoRA checkpoint that you are using. For this technical preview, you need Vicuna v1.1 (7B) checkpoint (if you do not have that already, follow the instructions <a href="https://github.com/lm-sys/FastChat#vicuna-weights">here</a>).</p>
<h3><a class="anchor" id="autotoc_md37"></a>
Launch a controller</h3>
<div class="fragment"><div class="line">python -m llava.serve.controller --host 0.0.0.0 --port 10000</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md38"></a>
Launch a gradio web server.</h3>
<div class="fragment"><div class="line">python -m llava.serve.gradio_web_server --controller http://localhost:10000 --model-list-mode reload</div>
</div><!-- fragment --><p> You just launched the Gradio web interface. Now, you can open the web interface with the URL printed on the screen. You may notice that there is no model in the model list. Do not worry, as we have not launched any model worker yet. It will be automatically updated when you launch a model worker.</p>
<h3><a class="anchor" id="autotoc_md39"></a>
Launch a model worker</h3>
<div class="fragment"><div class="line">python -m llava.serve.model_worker --host 0.0.0.0 --controller http://localhost:10000 --port 40000 --worker http://localhost:40000 --model-path liuhaotian/llava-vicuna-7b-v1.1-lcs_558k-instruct_80k_3e-lora-preview-alpha --model-base /path/to/vicuna-v1.1</div>
</div><!-- fragment --><p> Wait until the process finishes loading the model and you see "Uvicorn running on ...". Now, refresh your Gradio web UI, and you will see the model you just launched in the model list.</p>
<p>You can launch as many workers as you want, and compare between different model checkpoints in the same Gradio interface. Please keep the <code>--controller</code> the same, and modify the <code>--port</code> and <code>--worker</code> to a different port number for each worker.</p>
<h1><a class="anchor" id="autotoc_md40"></a>
Training</h1>
<p>Please see sample training scripts for <a href="https://github.com/haotian-liu/LLaVA/blob/main/scripts/finetune_lora.sh">LoRA</a> and <a href="https://github.com/haotian-liu/LLaVA/blob/main/scripts/finetune_qlora.sh">QLoRA</a>.</p>
<p>We provide sample DeepSpeed configs, <a href="https://github.com/haotian-liu/LLaVA/blob/main/scripts/zero3.json"><code>zero3.json</code></a> is more like PyTorch FSDP, and <a href="https://github.com/haotian-liu/LLaVA/blob/main/scripts/zero3_offload.json"><code>zero3_offload.json</code></a> can further save memory consumption by offloading parameters to CPU. <code>zero3.json</code> is usually faster than <code>zero3_offload.json</code> but requires more GPU memory, therefore, we recommend trying <code>zero3.json</code> first, and if you run out of GPU memory, try <code>zero3_offload.json</code>. You can also tweak the <code>per_device_train_batch_size</code> and <code>gradient_accumulation_steps</code> in the config to save memory, and just to make sure that <code>per_device_train_batch_size</code> and <code>gradient_accumulation_steps</code> remains the same.</p>
<p>If you are having issues with ZeRO-3 configs, and there are enough VRAM, you may try <a href="https://github.com/haotian-liu/LLaVA/blob/main/scripts/zero2.json"><code>zero2.json</code></a>. This consumes slightly more memory than ZeRO-3, and behaves more similar to PyTorch FSDP, while still supporting parameter-efficient tuning.</p>
<h1><a class="anchor" id="autotoc_md41"></a>
Create Merged Checkpoints</h1>
<div class="fragment"><div class="line">python scripts/merge_lora_weights.py \</div>
<div class="line">    --model-path /path/to/lora_model \</div>
<div class="line">    --model-base /path/to/base_model \</div>
<div class="line">    --save-model-path /path/to/merge_model</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.0 </li>
  </ul>
</div>
</body>
</html>
