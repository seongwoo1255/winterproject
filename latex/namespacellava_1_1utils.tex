\doxysection{llava.\+utils Namespace Reference}
\hypertarget{namespacellava_1_1utils}{}\label{namespacellava_1_1utils}\index{llava.utils@{llava.utils}}
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classllava_1_1utils_1_1_stream_to_logger}{Stream\+To\+Logger}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacellava_1_1utils_a2edaade06a4717b5b3ccf845ddb1fcaa}{build\+\_\+logger}} (logger\+\_\+name, logger\+\_\+filename)
\item 
\mbox{\hyperlink{namespacellava_1_1utils_ab4dd2979a33cf78e1dcda5c2203479b5}{disable\+\_\+torch\+\_\+init}} ()
\item 
\mbox{\hyperlink{namespacellava_1_1utils_abdb0187269f2e753dc66119b06b9b4f1}{violates\+\_\+moderation}} (text)
\item 
\mbox{\hyperlink{namespacellava_1_1utils_ac70d2691d2994d759cb83a731f15ccb4}{pretty\+\_\+print\+\_\+semaphore}} (semaphore)
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
str \mbox{\hyperlink{namespacellava_1_1utils_acfa38e2ae788f752074968cd96a23d0c}{server\+\_\+error\+\_\+msg}} = "{}\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}NETWORK ERROR DUE TO HIGH TRAFFIC. PLEASE REGENERATE OR REFRESH THIS PAGE.\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}"{}
\item 
str \mbox{\hyperlink{namespacellava_1_1utils_abdfc2015791c4617051d2e2c1fae3e5b}{moderation\+\_\+msg}} = "{}YOUR INPUT VIOLATES OUR CONTENT MODERATION GUIDELINES. PLEASE TRY AGAIN."{}
\item 
\mbox{\hyperlink{namespacellava_1_1utils_a591d42159dd12d0d1435e53ceaae21a7}{handler}} = None
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\Hypertarget{namespacellava_1_1utils_a2edaade06a4717b5b3ccf845ddb1fcaa}\index{llava.utils@{llava.utils}!build\_logger@{build\_logger}}
\index{build\_logger@{build\_logger}!llava.utils@{llava.utils}}
\doxysubsubsection{\texorpdfstring{build\_logger()}{build\_logger()}}
{\footnotesize\ttfamily \label{namespacellava_1_1utils_a2edaade06a4717b5b3ccf845ddb1fcaa} 
llava.\+utils.\+build\+\_\+logger (\begin{DoxyParamCaption}\item[{}]{logger\+\_\+name}{, }\item[{}]{logger\+\_\+filename}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{utils_8py_source_l00017}{17}} of file \mbox{\hyperlink{utils_8py_source}{utils.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00017\ \textcolor{keyword}{def\ }build\_logger(logger\_name,\ logger\_filename):}
\DoxyCodeLine{00018\ \ \ \ \ \textcolor{keyword}{global}\ handler}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \ \ \ \ formatter\ =\ logging.Formatter(}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ fmt=\textcolor{stringliteral}{"{}\%(asctime)s\ |\ \%(levelname)s\ |\ \%(name)s\ |\ \%(message)s"{}},}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ datefmt=\textcolor{stringliteral}{"{}\%Y-\/\%m-\/\%d\ \%H:\%M:\%S"{}},}
\DoxyCodeLine{00023\ \ \ \ \ )}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{comment}{\#\ Set\ the\ format\ of\ root\ handlers}}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ logging.getLogger().handlers:}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ logging.basicConfig(level=logging.INFO)}
\DoxyCodeLine{00028\ \ \ \ \ logging.getLogger().handlers[0].setFormatter(formatter)}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{comment}{\#\ Redirect\ stdout\ and\ stderr\ to\ loggers}}
\DoxyCodeLine{00031\ \ \ \ \ stdout\_logger\ =\ logging.getLogger(\textcolor{stringliteral}{"{}stdout"{}})}
\DoxyCodeLine{00032\ \ \ \ \ stdout\_logger.setLevel(logging.INFO)}
\DoxyCodeLine{00033\ \ \ \ \ sl\ =\ StreamToLogger(stdout\_logger,\ logging.INFO)}
\DoxyCodeLine{00034\ \ \ \ \ sys.stdout\ =\ sl}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ stderr\_logger\ =\ logging.getLogger(\textcolor{stringliteral}{"{}stderr"{}})}
\DoxyCodeLine{00037\ \ \ \ \ stderr\_logger.setLevel(logging.ERROR)}
\DoxyCodeLine{00038\ \ \ \ \ sl\ =\ StreamToLogger(stderr\_logger,\ logging.ERROR)}
\DoxyCodeLine{00039\ \ \ \ \ sys.stderr\ =\ sl}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{comment}{\#\ Get\ logger}}
\DoxyCodeLine{00042\ \ \ \ \ logger\ =\ logging.getLogger(logger\_name)}
\DoxyCodeLine{00043\ \ \ \ \ logger.setLevel(logging.INFO)}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{comment}{\#\ Add\ a\ file\ handler\ for\ all\ loggers}}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordflow}{if}\ handler\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ os.makedirs(LOGDIR,\ exist\_ok=\textcolor{keyword}{True})}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ filename\ =\ os.path.join(LOGDIR,\ logger\_filename)}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ handler\ =\ logging.handlers.TimedRotatingFileHandler(}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ filename,\ when=\textcolor{stringliteral}{'D'},\ utc=\textcolor{keyword}{True},\ encoding=\textcolor{stringliteral}{'UTF-\/8'})}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ handler.setFormatter(formatter)}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ name,\ item\ \textcolor{keywordflow}{in}\ logging.root.manager.loggerDict.items():}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ isinstance(item,\ logging.Logger):}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ item.addHandler(handler)}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordflow}{return}\ logger}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ }

\end{DoxyCode}
\Hypertarget{namespacellava_1_1utils_ab4dd2979a33cf78e1dcda5c2203479b5}\index{llava.utils@{llava.utils}!disable\_torch\_init@{disable\_torch\_init}}
\index{disable\_torch\_init@{disable\_torch\_init}!llava.utils@{llava.utils}}
\doxysubsubsection{\texorpdfstring{disable\_torch\_init()}{disable\_torch\_init()}}
{\footnotesize\ttfamily \label{namespacellava_1_1utils_ab4dd2979a33cf78e1dcda5c2203479b5} 
llava.\+utils.\+disable\+\_\+torch\+\_\+init (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

\begin{DoxyVerb}Disable the redundant torch default initialization to accelerate model creation.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{utils_8py_source_l00093}{93}} of file \mbox{\hyperlink{utils_8py_source}{utils.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00093\ \textcolor{keyword}{def\ }disable\_torch\_init():}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00095\ \textcolor{stringliteral}{\ \ \ \ Disable\ the\ redundant\ torch\ default\ initialization\ to\ accelerate\ model\ creation.}}
\DoxyCodeLine{00096\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keyword}{import}\ torch}
\DoxyCodeLine{00098\ \ \ \ \ setattr(torch.nn.Linear,\ \textcolor{stringliteral}{"{}reset\_parameters"{}},\ \textcolor{keyword}{lambda}\ self:\ \textcolor{keywordtype}{None})}
\DoxyCodeLine{00099\ \ \ \ \ setattr(torch.nn.LayerNorm,\ \textcolor{stringliteral}{"{}reset\_parameters"{}},\ \textcolor{keyword}{lambda}\ self:\ \textcolor{keywordtype}{None})}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ }

\end{DoxyCode}
\Hypertarget{namespacellava_1_1utils_ac70d2691d2994d759cb83a731f15ccb4}\index{llava.utils@{llava.utils}!pretty\_print\_semaphore@{pretty\_print\_semaphore}}
\index{pretty\_print\_semaphore@{pretty\_print\_semaphore}!llava.utils@{llava.utils}}
\doxysubsubsection{\texorpdfstring{pretty\_print\_semaphore()}{pretty\_print\_semaphore()}}
{\footnotesize\ttfamily \label{namespacellava_1_1utils_ac70d2691d2994d759cb83a731f15ccb4} 
llava.\+utils.\+pretty\+\_\+print\+\_\+semaphore (\begin{DoxyParamCaption}\item[{}]{semaphore}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{utils_8py_source_l00123}{123}} of file \mbox{\hyperlink{utils_8py_source}{utils.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00123\ \textcolor{keyword}{def\ }pretty\_print\_semaphore(semaphore):}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordflow}{if}\ semaphore\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}None"{}}}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keywordflow}{return}\ f\textcolor{stringliteral}{"{}Semaphore(value=\{semaphore.\_value\},\ locked=\{semaphore.locked()\})"{}}}

\end{DoxyCode}
\Hypertarget{namespacellava_1_1utils_abdb0187269f2e753dc66119b06b9b4f1}\index{llava.utils@{llava.utils}!violates\_moderation@{violates\_moderation}}
\index{violates\_moderation@{violates\_moderation}!llava.utils@{llava.utils}}
\doxysubsubsection{\texorpdfstring{violates\_moderation()}{violates\_moderation()}}
{\footnotesize\ttfamily \label{namespacellava_1_1utils_abdb0187269f2e753dc66119b06b9b4f1} 
llava.\+utils.\+violates\+\_\+moderation (\begin{DoxyParamCaption}\item[{}]{text}{}\end{DoxyParamCaption})}

\begin{DoxyVerb}Check whether the text violates OpenAI moderation API.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{utils_8py_source_l00102}{102}} of file \mbox{\hyperlink{utils_8py_source}{utils.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00102\ \textcolor{keyword}{def\ }violates\_moderation(text):}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00104\ \textcolor{stringliteral}{\ \ \ \ Check\ whether\ the\ text\ violates\ OpenAI\ moderation\ API.}}
\DoxyCodeLine{00105\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{00106\ \ \ \ \ url\ =\ \textcolor{stringliteral}{"{}https://api.openai.com/v1/moderations"{}}}
\DoxyCodeLine{00107\ \ \ \ \ headers\ =\ \{\textcolor{stringliteral}{"{}Content-\/Type"{}}:\ \textcolor{stringliteral}{"{}application/json"{}},}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Authorization"{}}:\ \textcolor{stringliteral}{"{}Bearer\ "{}}\ +\ os.environ[\textcolor{stringliteral}{"{}OPENAI\_API\_KEY"{}}]\}}
\DoxyCodeLine{00109\ \ \ \ \ text\ =\ text.replace(\textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{00110\ \ \ \ \ data\ =\ \textcolor{stringliteral}{"{}\{"{}}\ +\ \textcolor{stringliteral}{'"{}input"{}:\ '}\ +\ f\textcolor{stringliteral}{'"{}\{text\}"{}'}\ +\ \textcolor{stringliteral}{"{}\}"{}}}
\DoxyCodeLine{00111\ \ \ \ \ data\ =\ data.encode(\textcolor{stringliteral}{"{}utf-\/8"{}})}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ ret\ =\ requests.post(url,\ headers=headers,\ data=data,\ timeout=5)}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ flagged\ =\ ret.json()[\textcolor{stringliteral}{"{}results"{}}][0][\textcolor{stringliteral}{"{}flagged"{}}]}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordflow}{except}\ requests.exceptions.RequestException\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ flagged\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keywordflow}{except}\ KeyError\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ flagged\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordflow}{return}\ flagged}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ }

\end{DoxyCode}


\doxysubsection{Variable Documentation}
\Hypertarget{namespacellava_1_1utils_a591d42159dd12d0d1435e53ceaae21a7}\index{llava.utils@{llava.utils}!handler@{handler}}
\index{handler@{handler}!llava.utils@{llava.utils}}
\doxysubsubsection{\texorpdfstring{handler}{handler}}
{\footnotesize\ttfamily \label{namespacellava_1_1utils_a591d42159dd12d0d1435e53ceaae21a7} 
llava.\+utils.\+handler = None}



Definition at line \mbox{\hyperlink{utils_8py_source_l00014}{14}} of file \mbox{\hyperlink{utils_8py_source}{utils.\+py}}.

\Hypertarget{namespacellava_1_1utils_abdfc2015791c4617051d2e2c1fae3e5b}\index{llava.utils@{llava.utils}!moderation\_msg@{moderation\_msg}}
\index{moderation\_msg@{moderation\_msg}!llava.utils@{llava.utils}}
\doxysubsubsection{\texorpdfstring{moderation\_msg}{moderation\_msg}}
{\footnotesize\ttfamily \label{namespacellava_1_1utils_abdfc2015791c4617051d2e2c1fae3e5b} 
str llava.\+utils.\+moderation\+\_\+msg = "{}YOUR INPUT VIOLATES OUR CONTENT MODERATION GUIDELINES. PLEASE TRY AGAIN."{}}



Definition at line \mbox{\hyperlink{utils_8py_source_l00012}{12}} of file \mbox{\hyperlink{utils_8py_source}{utils.\+py}}.

\Hypertarget{namespacellava_1_1utils_acfa38e2ae788f752074968cd96a23d0c}\index{llava.utils@{llava.utils}!server\_error\_msg@{server\_error\_msg}}
\index{server\_error\_msg@{server\_error\_msg}!llava.utils@{llava.utils}}
\doxysubsubsection{\texorpdfstring{server\_error\_msg}{server\_error\_msg}}
{\footnotesize\ttfamily \label{namespacellava_1_1utils_acfa38e2ae788f752074968cd96a23d0c} 
str llava.\+utils.\+server\+\_\+error\+\_\+msg = "{}\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}NETWORK ERROR DUE TO HIGH TRAFFIC. PLEASE REGENERATE OR REFRESH THIS PAGE.\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}"{}}



Definition at line \mbox{\hyperlink{utils_8py_source_l00011}{11}} of file \mbox{\hyperlink{utils_8py_source}{utils.\+py}}.

