\doxysection{llava.\+model.\+make\+\_\+delta Namespace Reference}
\hypertarget{namespacellava_1_1model_1_1make__delta}{}\label{namespacellava_1_1model_1_1make__delta}\index{llava.model.make\_delta@{llava.model.make\_delta}}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacellava_1_1model_1_1make__delta_a257b05185469d9b41d32e297c96e81d6}{make\+\_\+delta}} (base\+\_\+model\+\_\+path, target\+\_\+model\+\_\+path, delta\+\_\+path, hub\+\_\+repo\+\_\+id)
\begin{DoxyCompactList}\small\item\em Delta 파일을 생성하는 함수 \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacellava_1_1model_1_1make__delta_a978c8cb6fc7a4eca29851804497b88a8}{parser}} = argparse.\+Argument\+Parser()
\item 
\mbox{\hyperlink{namespacellava_1_1model_1_1make__delta_a42e996c0ac9c0825e6d08d1e71dce379}{type}}
\item 
\mbox{\hyperlink{namespacellava_1_1model_1_1make__delta_adc8959c6d04dd747b9a0954d5bfdf61b}{str}}
\item 
\mbox{\hyperlink{namespacellava_1_1model_1_1make__delta_af93ae2295a5f8733fec43d7c7abe3555}{required}}
\item 
\mbox{\hyperlink{namespacellava_1_1model_1_1make__delta_a3611351ab02e9ef8cf492e355dad0bd6}{default}}
\item 
\mbox{\hyperlink{namespacellava_1_1model_1_1make__delta_a8be36c78f84c40fa7c2720772fb96581}{args}} = parser.\+parse\+\_\+args()
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}Usage:
python3 -m llava.model.make_delta --base ~/model_weights/llama-7b --target ~/model_weights/llava-7b --delta ~/model_weights/llava-7b-delta --hub-repo-id liuhaotian/llava-7b-delta
\end{DoxyVerb}
 

\doxysubsection{Function Documentation}
\Hypertarget{namespacellava_1_1model_1_1make__delta_a257b05185469d9b41d32e297c96e81d6}\index{llava.model.make\_delta@{llava.model.make\_delta}!make\_delta@{make\_delta}}
\index{make\_delta@{make\_delta}!llava.model.make\_delta@{llava.model.make\_delta}}
\doxysubsubsection{\texorpdfstring{make\_delta()}{make\_delta()}}
{\footnotesize\ttfamily \label{namespacellava_1_1model_1_1make__delta_a257b05185469d9b41d32e297c96e81d6} 
llava.\+model.\+make\+\_\+delta.\+make\+\_\+delta (\begin{DoxyParamCaption}\item[{}]{base\+\_\+model\+\_\+path}{, }\item[{}]{target\+\_\+model\+\_\+path}{, }\item[{}]{delta\+\_\+path}{, }\item[{}]{hub\+\_\+repo\+\_\+id}{}\end{DoxyParamCaption})}



Delta 파일을 생성하는 함수 

\begin{DoxyAuthor}{Author}
이지희(2021113406)
\end{DoxyAuthor}

\begin{DoxyParams}{Parameters}
{\em base\+\_\+model\+\_\+path} & (str) Base 모델 경로 \\
\hline
{\em target\+\_\+model\+\_\+path} & (str) Target 모델 경로 \\
\hline
{\em delta\+\_\+path} & (str) Delta 파일 저장 경로 \\
\hline
{\em hub\+\_\+repo\+\_\+id} & (str) Delta 파일 업로드에 사용할 허브 레포지토리 ID (선택 사항)\\
\hline
\end{DoxyParams}

\begin{DoxyExceptions}{Exceptions}
{\em Assertion\+Error} & Base 모델과 Target 모델의 매칭되지 않는 파라미터가 발견될 경우 발생 \\
\hline
\end{DoxyExceptions}


Definition at line \mbox{\hyperlink{make__delta_8py_source_l00030}{30}} of file \mbox{\hyperlink{make__delta_8py_source}{make\+\_\+delta.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00030\ \textcolor{keyword}{def\ }make\_delta(base\_model\_path,\ target\_model\_path,\ delta\_path,\ hub\_repo\_id):}
\DoxyCodeLine{00031\ \ \ \ \ print(\textcolor{stringliteral}{"{}Loading\ base\ model"{}})}
\DoxyCodeLine{00032\ \ \ \ \ base\ =\ AutoModelForCausalLM.from\_pretrained(}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ base\_model\_path,\ torch\_dtype=torch.float16,\ low\_cpu\_mem\_usage=\textcolor{keyword}{True})}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \ \ print(\textcolor{stringliteral}{"{}Loading\ target\ model"{}})}
\DoxyCodeLine{00036\ \ \ \ \ auto\_upgrade(target\_model\_path)}
\DoxyCodeLine{00037\ \ \ \ \ target\ =\ AutoModelForCausalLM.from\_pretrained(target\_model\_path,\ torch\_dtype=torch.float16,\ low\_cpu\_mem\_usage=\textcolor{keyword}{True})}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ print(\textcolor{stringliteral}{"{}Calculating\ delta"{}})}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordflow}{for}\ name,\ param\ \textcolor{keywordflow}{in}\ tqdm(target.state\_dict().items(),\ desc=\textcolor{stringliteral}{"{}Calculating\ delta"{}}):}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ name\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ base.state\_dict():}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ name\ \textcolor{keywordflow}{in}\ [\textcolor{stringliteral}{'model.mm\_projector.weight'},\ \textcolor{stringliteral}{'model.mm\_projector.bias'}],\ f\textcolor{stringliteral}{'\{name\}\ not\ in\ base\ model'}}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ param.data.shape\ ==\ base.state\_dict()[name].shape:}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ param.data\ -\/=\ base.state\_dict()[name]}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ name\ \textcolor{keywordflow}{in}\ [\textcolor{stringliteral}{'model.embed\_tokens.weight'},\ \textcolor{stringliteral}{'lm\_head.weight'}],\ f\textcolor{stringliteral}{'\{name\}\ dimension\ mismatch:\ \{param.data.shape\}\ vs\ \{base.state\_dict()[name].shape\}'}}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ bparam\ =\ base.state\_dict()[name]}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ param.data[:bparam.shape[0],\ :bparam.shape[1]]\ -\/=\ bparam}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ print(\textcolor{stringliteral}{"{}Saving\ delta"{}})}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{if}\ hub\_repo\_id:}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ kwargs\ =\ \{\textcolor{stringliteral}{"{}push\_to\_hub"{}}:\ \textcolor{keyword}{True},\ \textcolor{stringliteral}{"{}repo\_id"{}}:\ hub\_repo\_id\}}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ kwargs\ =\ \{\}}
\DoxyCodeLine{00056\ \ \ \ \ target.save\_pretrained(delta\_path,\ **kwargs)}
\DoxyCodeLine{00057\ \ \ \ \ target\_tokenizer\ =\ AutoTokenizer.from\_pretrained(target\_model\_path)}
\DoxyCodeLine{00058\ \ \ \ \ target\_tokenizer.save\_pretrained(delta\_path,\ **kwargs)}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ }

\end{DoxyCode}


\doxysubsection{Variable Documentation}
\Hypertarget{namespacellava_1_1model_1_1make__delta_a8be36c78f84c40fa7c2720772fb96581}\index{llava.model.make\_delta@{llava.model.make\_delta}!args@{args}}
\index{args@{args}!llava.model.make\_delta@{llava.model.make\_delta}}
\doxysubsubsection{\texorpdfstring{args}{args}}
{\footnotesize\ttfamily \label{namespacellava_1_1model_1_1make__delta_a8be36c78f84c40fa7c2720772fb96581} 
llava.\+model.\+make\+\_\+delta.\+args = parser.\+parse\+\_\+args()}



Definition at line \mbox{\hyperlink{make__delta_8py_source_l00067}{67}} of file \mbox{\hyperlink{make__delta_8py_source}{make\+\_\+delta.\+py}}.

\Hypertarget{namespacellava_1_1model_1_1make__delta_a3611351ab02e9ef8cf492e355dad0bd6}\index{llava.model.make\_delta@{llava.model.make\_delta}!default@{default}}
\index{default@{default}!llava.model.make\_delta@{llava.model.make\_delta}}
\doxysubsubsection{\texorpdfstring{default}{default}}
{\footnotesize\ttfamily \label{namespacellava_1_1model_1_1make__delta_a3611351ab02e9ef8cf492e355dad0bd6} 
llava.\+model.\+make\+\_\+delta.\+default}



Definition at line \mbox{\hyperlink{make__delta_8py_source_l00066}{66}} of file \mbox{\hyperlink{make__delta_8py_source}{make\+\_\+delta.\+py}}.

\Hypertarget{namespacellava_1_1model_1_1make__delta_a978c8cb6fc7a4eca29851804497b88a8}\index{llava.model.make\_delta@{llava.model.make\_delta}!parser@{parser}}
\index{parser@{parser}!llava.model.make\_delta@{llava.model.make\_delta}}
\doxysubsubsection{\texorpdfstring{parser}{parser}}
{\footnotesize\ttfamily \label{namespacellava_1_1model_1_1make__delta_a978c8cb6fc7a4eca29851804497b88a8} 
llava.\+model.\+make\+\_\+delta.\+parser = argparse.\+Argument\+Parser()}



Definition at line \mbox{\hyperlink{make__delta_8py_source_l00062}{62}} of file \mbox{\hyperlink{make__delta_8py_source}{make\+\_\+delta.\+py}}.

\Hypertarget{namespacellava_1_1model_1_1make__delta_af93ae2295a5f8733fec43d7c7abe3555}\index{llava.model.make\_delta@{llava.model.make\_delta}!required@{required}}
\index{required@{required}!llava.model.make\_delta@{llava.model.make\_delta}}
\doxysubsubsection{\texorpdfstring{required}{required}}
{\footnotesize\ttfamily \label{namespacellava_1_1model_1_1make__delta_af93ae2295a5f8733fec43d7c7abe3555} 
llava.\+model.\+make\+\_\+delta.\+required}



Definition at line \mbox{\hyperlink{make__delta_8py_source_l00063}{63}} of file \mbox{\hyperlink{make__delta_8py_source}{make\+\_\+delta.\+py}}.

\Hypertarget{namespacellava_1_1model_1_1make__delta_adc8959c6d04dd747b9a0954d5bfdf61b}\index{llava.model.make\_delta@{llava.model.make\_delta}!str@{str}}
\index{str@{str}!llava.model.make\_delta@{llava.model.make\_delta}}
\doxysubsubsection{\texorpdfstring{str}{str}}
{\footnotesize\ttfamily \label{namespacellava_1_1model_1_1make__delta_adc8959c6d04dd747b9a0954d5bfdf61b} 
llava.\+model.\+make\+\_\+delta.\+str}



Definition at line \mbox{\hyperlink{make__delta_8py_source_l00063}{63}} of file \mbox{\hyperlink{make__delta_8py_source}{make\+\_\+delta.\+py}}.

\Hypertarget{namespacellava_1_1model_1_1make__delta_a42e996c0ac9c0825e6d08d1e71dce379}\index{llava.model.make\_delta@{llava.model.make\_delta}!type@{type}}
\index{type@{type}!llava.model.make\_delta@{llava.model.make\_delta}}
\doxysubsubsection{\texorpdfstring{type}{type}}
{\footnotesize\ttfamily \label{namespacellava_1_1model_1_1make__delta_a42e996c0ac9c0825e6d08d1e71dce379} 
llava.\+model.\+make\+\_\+delta.\+type}



Definition at line \mbox{\hyperlink{make__delta_8py_source_l00063}{63}} of file \mbox{\hyperlink{make__delta_8py_source}{make\+\_\+delta.\+py}}.

