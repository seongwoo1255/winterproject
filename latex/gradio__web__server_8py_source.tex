\doxysection{gradio\+\_\+web\+\_\+server.\+py}
\hypertarget{gradio__web__server_8py_source}{}\label{gradio__web__server_8py_source}\index{llava/serve/gradio\_web\_server.py@{llava/serve/gradio\_web\_server.py}}
\mbox{\hyperlink{gradio__web__server_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00001}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server}{00001}}\ \textcolor{keyword}{import}\ argparse}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00002}00002\ \textcolor{keyword}{import}\ datetime}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00003}00003\ \textcolor{keyword}{import}\ json}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00004}00004\ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00005}00005\ \textcolor{keyword}{import}\ time}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00007}00007\ \textcolor{keyword}{import}\ gradio\ \textcolor{keyword}{as}\ gr}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00008}00008\ \textcolor{keyword}{import}\ requests}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00010}00010\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacellava_1_1conversation}{llava.conversation}}\ \textcolor{keyword}{import}\ (default\_conversation,\ conv\_templates,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00011}00011\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ SeparatorStyle)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00012}00012\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacellava_1_1constants}{llava.constants}}\ \textcolor{keyword}{import}\ LOGDIR}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00013}00013\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacellava_1_1utils}{llava.utils}}\ \textcolor{keyword}{import}\ (build\_logger,\ server\_error\_msg,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00014}00014\ \ \ \ \ violates\_moderation,\ moderation\_msg)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00015}00015\ \textcolor{keyword}{import}\ hashlib}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00016}00016\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00018}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_af31b75562f23477c6c980c12623c474d}{00018}}\ logger\ =\ build\_logger(\textcolor{stringliteral}{"{}gradio\_web\_server"{}},\ \textcolor{stringliteral}{"{}gradio\_web\_server.log"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00020}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_ab716f16be1a211ec76f589925510da65}{00020}}\ headers\ =\ \{\textcolor{stringliteral}{"{}User-\/Agent"{}}:\ \textcolor{stringliteral}{"{}LLaVA\ Client"{}}\}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00021}00021\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00022}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a87eaffb357945265286b11af0f1b90de}{00022}}\ no\_change\_btn\ =\ gr.Button()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00023}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_afe7fd8d42f54aeacf5777334776a1c94}{00023}}\ enable\_btn\ =\ gr.Button(interactive=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00024}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_ab18d901f12f99cc3edfd52f99bb90923}{00024}}\ disable\_btn\ =\ gr.Button(interactive=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00025}00025\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00026}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a961deb3d57ee7711f2d697f8c4f23834}{00026}}\ priority\ =\ \{}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00027}00027\ \ \ \ \ \textcolor{stringliteral}{"{}vicuna-\/13b"{}}:\ \textcolor{stringliteral}{"{}aaaaaaa"{}},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00028}00028\ \ \ \ \ \textcolor{stringliteral}{"{}koala-\/13b"{}}:\ \textcolor{stringliteral}{"{}aaaaaab"{}},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00029}00029\ \}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00030}00030\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00032}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a051e70056bbe57dbbbf2f75acd022f04}{00032}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a051e70056bbe57dbbbf2f75acd022f04}{get\_conv\_log\_filename}}():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00033}00033\ \ \ \ \ t\ =\ datetime.datetime.now()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00034}00034\ \ \ \ \ name\ =\ os.path.join(LOGDIR,\ f\textcolor{stringliteral}{"{}\{t.year\}-\/\{t.month:02d\}-\/\{t.day:02d\}-\/conv.json"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00035}00035\ \ \ \ \ \textcolor{keywordflow}{return}\ name}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00036}00036\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00038}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a5e04990393402eb7011f171ecb0bb724}{00038}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a5e04990393402eb7011f171ecb0bb724}{get\_model\_list}}():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00039}00039\ \ \ \ \ ret\ =\ requests.post(args.controller\_url\ +\ \textcolor{stringliteral}{"{}/refresh\_all\_workers"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00040}00040\ \ \ \ \ \textcolor{keyword}{assert}\ ret.status\_code\ ==\ 200}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00041}00041\ \ \ \ \ ret\ =\ requests.post(args.controller\_url\ +\ \textcolor{stringliteral}{"{}/list\_models"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00042}00042\ \ \ \ \ models\ =\ ret.json()[\textcolor{stringliteral}{"{}models"{}}]}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00043}00043\ \ \ \ \ models.sort(key=\textcolor{keyword}{lambda}\ x:\ priority.get(x,\ x))}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00044}00044\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}Models:\ \{models\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00045}00045\ \ \ \ \ \textcolor{keywordflow}{return}\ models}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00047}00047\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00048}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a1159aa4489f298ab5a5ce6828727968b}{00048}}\ get\_window\_url\_params\ =\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00049}00049\ \textcolor{stringliteral}{function()\ \{}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00050}00050\ \textcolor{stringliteral}{\ \ \ \ const\ params\ =\ new\ URLSearchParams(window.location.search);}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00051}00051\ \textcolor{stringliteral}{\ \ \ \ url\_params\ =\ Object.fromEntries(params);}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00052}00052\ \textcolor{stringliteral}{\ \ \ \ console.log(url\_params);}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00053}00053\ \textcolor{stringliteral}{\ \ \ \ return\ url\_params;}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00054}00054\ \textcolor{stringliteral}{\ \ \ \ \}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00055}00055\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00056}00056\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00057}00057\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00058}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a93c1f6a8ca63fcaa4d2dfc938685c0b8}{00058}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a93c1f6a8ca63fcaa4d2dfc938685c0b8}{load\_demo}}(url\_params,\ request:\ gr.Request):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00059}00059\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}load\_demo.\ ip:\ \{request.client.host\}.\ params:\ \{url\_params\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00061}00061\ \ \ \ \ dropdown\_update\ =\ gr.Dropdown(visible=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00062}00062\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}model"{}}\ \textcolor{keywordflow}{in}\ url\_params:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00063}00063\ \ \ \ \ \ \ \ \ model\ =\ url\_params[\textcolor{stringliteral}{"{}model"{}}]}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00064}00064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ model\ \textcolor{keywordflow}{in}\ models:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00065}00065\ \ \ \ \ \ \ \ \ \ \ \ \ dropdown\_update\ =\ gr.Dropdown(value=model,\ visible=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00066}00066\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00067}00067\ \ \ \ \ state\ =\ default\_conversation.copy()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00068}00068\ \ \ \ \ \textcolor{keywordflow}{return}\ state,\ dropdown\_update}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00070}00070\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00071}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a0b4fa2eb00a29ebf4180b262469a30ee}{00071}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a0b4fa2eb00a29ebf4180b262469a30ee}{load\_demo\_refresh\_model\_list}}(request:\ gr.Request):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00072}00072\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}load\_demo.\ ip:\ \{request.client.host\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00073}00073\ \ \ \ \ models\ =\ \mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a5e04990393402eb7011f171ecb0bb724}{get\_model\_list}}()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00074}00074\ \ \ \ \ state\ =\ default\_conversation.copy()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00075}00075\ \ \ \ \ dropdown\_update\ =\ gr.Dropdown(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00076}00076\ \ \ \ \ \ \ \ \ choices=models,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00077}00077\ \ \ \ \ \ \ \ \ value=models[0]\ \textcolor{keywordflow}{if}\ len(models)\ >\ 0\ \textcolor{keywordflow}{else}\ \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00078}00078\ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00079}00079\ \ \ \ \ \textcolor{keywordflow}{return}\ state,\ dropdown\_update}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00080}00080\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00081}00081\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00082}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a859a9f172b39a6097a21be093e3d5550}{00082}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a859a9f172b39a6097a21be093e3d5550}{vote\_last\_response}}(state,\ vote\_type,\ model\_selector,\ request:\ gr.Request):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00083}00083\ \ \ \ \ \textcolor{keyword}{with}\ open(\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a051e70056bbe57dbbbf2f75acd022f04}{get\_conv\_log\_filename}}(),\ \textcolor{stringliteral}{"{}a"{}})\ \textcolor{keyword}{as}\ fout:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00084}00084\ \ \ \ \ \ \ \ \ data\ =\ \{}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}tstamp"{}}:\ round(time.time(),\ 4),}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}type"{}}:\ vote\_type,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}model"{}}:\ model\_selector,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}state"{}}:\ state.dict(),}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}ip"{}}:\ request.client.host,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00090}00090\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00091}00091\ \ \ \ \ \ \ \ \ fout.write(json.dumps(data)\ +\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00092}00092\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00093}00093\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00094}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_af60d4ac622856c2a745cafcebfa0c958}{00094}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_af60d4ac622856c2a745cafcebfa0c958}{upvote\_last\_response}}(state,\ model\_selector,\ request:\ gr.Request):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00095}00095\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}upvote.\ ip:\ \{request.client.host\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00096}00096\ \ \ \ \ \mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a859a9f172b39a6097a21be093e3d5550}{vote\_last\_response}}(state,\ \textcolor{stringliteral}{"{}upvote"{}},\ model\_selector,\ request)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00097}00097\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{stringliteral}{"{}"{}},)\ +\ (disable\_btn,)\ *\ 3}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00098}00098\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00099}00099\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00100}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a120e078ca589adb9f75d5c72418547df}{00100}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a120e078ca589adb9f75d5c72418547df}{downvote\_last\_response}}(state,\ model\_selector,\ request:\ gr.Request):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00101}00101\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}downvote.\ ip:\ \{request.client.host\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00102}00102\ \ \ \ \ \mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a859a9f172b39a6097a21be093e3d5550}{vote\_last\_response}}(state,\ \textcolor{stringliteral}{"{}downvote"{}},\ model\_selector,\ request)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00103}00103\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{stringliteral}{"{}"{}},)\ +\ (disable\_btn,)\ *\ 3}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00104}00104\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00105}00105\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00106}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_ae96933ad11b1e741cb77700cefbf35ce}{00106}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_ae96933ad11b1e741cb77700cefbf35ce}{flag\_last\_response}}(state,\ model\_selector,\ request:\ gr.Request):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00107}00107\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}flag.\ ip:\ \{request.client.host\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00108}00108\ \ \ \ \ \mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a859a9f172b39a6097a21be093e3d5550}{vote\_last\_response}}(state,\ \textcolor{stringliteral}{"{}flag"{}},\ model\_selector,\ request)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00109}00109\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{stringliteral}{"{}"{}},)\ +\ (disable\_btn,)\ *\ 3}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00110}00110\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00111}00111\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00112}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a9a95c3ad99d8e4971a5a424f02ada04e}{00112}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a9a95c3ad99d8e4971a5a424f02ada04e}{regenerate}}(state,\ image\_process\_mode,\ request:\ gr.Request):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00113}00113\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}regenerate.\ ip:\ \{request.client.host\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00114}00114\ \ \ \ \ state.messages[-\/1][-\/1]\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00115}00115\ \ \ \ \ prev\_human\_msg\ =\ state.messages[-\/2]}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00116}00116\ \ \ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a52ce837216d8fab7c8979ec3851a5a8d}{type}}(prev\_human\_msg[1])\ \textcolor{keywordflow}{in}\ (tuple,\ list):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00117}00117\ \ \ \ \ \ \ \ \ prev\_human\_msg[1]\ =\ (*prev\_human\_msg[1][:2],\ image\_process\_mode)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00118}00118\ \ \ \ \ state.skip\_next\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00119}00119\ \ \ \ \ \textcolor{keywordflow}{return}\ (state,\ state.to\_gradio\_chatbot(),\ \textcolor{stringliteral}{"{}"{}},\ \textcolor{keywordtype}{None})\ +\ (disable\_btn,)\ *\ 5}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00120}00120\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00121}00121\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00122}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a3fd7c3becaa3399ca6a0d236b483e30f}{00122}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a3fd7c3becaa3399ca6a0d236b483e30f}{clear\_history}}(request:\ gr.Request):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00123}00123\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}clear\_history.\ ip:\ \{request.client.host\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00124}00124\ \ \ \ \ state\ =\ default\_conversation.copy()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00125}00125\ \ \ \ \ \textcolor{keywordflow}{return}\ (state,\ state.to\_gradio\_chatbot(),\ \textcolor{stringliteral}{"{}"{}},\ \textcolor{keywordtype}{None})\ +\ (disable\_btn,)\ *\ 5}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00126}00126\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00127}00127\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00128}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_aeaad5c2bd719b4550756bbe7255e4a7f}{00128}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_aeaad5c2bd719b4550756bbe7255e4a7f}{add\_text}}(state,\ text,\ image,\ image\_process\_mode,\ request:\ gr.Request):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00129}00129\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}add\_text.\ ip:\ \{request.client.host\}.\ len:\ \{len(text)\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00130}00130\ \ \ \ \ \textcolor{keywordflow}{if}\ len(text)\ <=\ 0\ \textcolor{keywordflow}{and}\ image\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00131}00131\ \ \ \ \ \ \ \ \ state.skip\_next\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00132}00132\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (state,\ state.to\_gradio\_chatbot(),\ \textcolor{stringliteral}{"{}"{}},\ \textcolor{keywordtype}{None})\ +\ (no\_change\_btn,)\ *\ 5}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00133}00133\ \ \ \ \ \textcolor{keywordflow}{if}\ args.moderate:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00134}00134\ \ \ \ \ \ \ \ \ flagged\ =\ violates\_moderation(text)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00135}00135\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ flagged:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00136}00136\ \ \ \ \ \ \ \ \ \ \ \ \ state.skip\_next\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00137}00137\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (state,\ state.to\_gradio\_chatbot(),\ moderation\_msg,\ \textcolor{keywordtype}{None})\ +\ (}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00138}00138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ no\_change\_btn,)\ *\ 5}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00139}00139\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00140}00140\ \ \ \ \ text\ =\ text[:1536]\ \ \textcolor{comment}{\#\ Hard\ cut-\/off}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00141}00141\ \ \ \ \ \textcolor{keywordflow}{if}\ image\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00142}00142\ \ \ \ \ \ \ \ \ text\ =\ text[:1200]\ \ \textcolor{comment}{\#\ Hard\ cut-\/off\ for\ images}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00143}00143\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{'<image>'}\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ text:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00144}00144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ text\ =\ '<Image><image></Image>'\ +\ text}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00145}00145\ \ \ \ \ \ \ \ \ \ \ \ \ text\ =\ text\ +\ \textcolor{stringliteral}{'\(\backslash\)n<image>'}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00146}00146\ \ \ \ \ \ \ \ \ text\ =\ (text,\ image,\ image\_process\_mode)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00147}00147\ \ \ \ \ \ \ \ \ state\ =\ default\_conversation.copy()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00148}00148\ \ \ \ \ state.append\_message(state.roles[0],\ text)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00149}00149\ \ \ \ \ state.append\_message(state.roles[1],\ \textcolor{keywordtype}{None})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00150}00150\ \ \ \ \ state.skip\_next\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00151}00151\ \ \ \ \ \textcolor{keywordflow}{return}\ (state,\ state.to\_gradio\_chatbot(),\ \textcolor{stringliteral}{"{}"{}},\ \textcolor{keywordtype}{None})\ +\ (disable\_btn,)\ *\ 5}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00152}00152\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00153}00153\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00154}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a1307d1516461919ebc5484d362f5d1af}{00154}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a1307d1516461919ebc5484d362f5d1af}{http\_bot}}(state,\ model\_selector,\ temperature,\ top\_p,\ max\_new\_tokens,\ request:\ gr.Request):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00155}00155\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}http\_bot.\ ip:\ \{request.client.host\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00156}00156\ \ \ \ \ start\_tstamp\ =\ time.time()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00157}00157\ \ \ \ \ model\_name\ =\ model\_selector}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00158}00158\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00159}00159\ \ \ \ \ \textcolor{keywordflow}{if}\ state.skip\_next:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00160}00160\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ This\ generate\ call\ is\ skipped\ due\ to\ invalid\ inputs}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00161}00161\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ (state,\ state.to\_gradio\_chatbot())\ +\ (no\_change\_btn,)\ *\ 5}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00162}00162\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00163}00163\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00164}00164\ \ \ \ \ \textcolor{keywordflow}{if}\ len(state.messages)\ ==\ state.offset\ +\ 2:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00165}00165\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ First\ round\ of\ conversation}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00166}00166\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}llava"{}}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00167}00167\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{'llama-\/2'}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00168}00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}llava\_llama\_2"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00169}00169\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{"{}mistral"{}}\ \textcolor{keywordflow}{in}\ model\_name.lower()\ \textcolor{keywordflow}{or}\ \textcolor{stringliteral}{"{}mixtral"{}}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00170}00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{'orca'}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00171}00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}mistral\_orca"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00172}00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{'hermes'}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00173}00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}chatml\_direct"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00175}00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}mistral\_instruct"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00176}00176\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{'llava-\/v1.6-\/34b'}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00177}00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}chatml\_direct"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00178}00178\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{"{}v1"{}}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00179}00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{'mmtag'}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00180}00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}v1\_mmtag"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{'plain'}\ \textcolor{keywordflow}{in}\ model\_name.lower()\ \textcolor{keywordflow}{and}\ \textcolor{stringliteral}{'finetune'}\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00182}00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}v1\_mmtag"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00183}00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00184}00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}llava\_v1"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00185}00185\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{"{}mpt"{}}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00186}00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}mpt"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00187}00187\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00188}00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{'mmtag'}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00189}00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}v0\_mmtag"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00190}00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{'plain'}\ \textcolor{keywordflow}{in}\ model\_name.lower()\ \textcolor{keywordflow}{and}\ \textcolor{stringliteral}{'finetune'}\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ model\_name.lower():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00191}00191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}v0\_mmtag"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00192}00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00193}00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}llava\_v0"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00194}00194\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{"{}mpt"{}}\ \textcolor{keywordflow}{in}\ model\_name:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00195}00195\ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}mpt\_text"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00196}00196\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{stringliteral}{"{}llama-\/2"{}}\ \textcolor{keywordflow}{in}\ model\_name:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00197}00197\ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}llama\_2"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00198}00198\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00199}00199\ \ \ \ \ \ \ \ \ \ \ \ \ template\_name\ =\ \textcolor{stringliteral}{"{}vicuna\_v1"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00200}00200\ \ \ \ \ \ \ \ \ new\_state\ =\ conv\_templates[template\_name].copy()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00201}00201\ \ \ \ \ \ \ \ \ new\_state.append\_message(new\_state.roles[0],\ state.messages[-\/2][1])}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00202}00202\ \ \ \ \ \ \ \ \ new\_state.append\_message(new\_state.roles[1],\ \textcolor{keywordtype}{None})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00203}00203\ \ \ \ \ \ \ \ \ state\ =\ new\_state}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00204}00204\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00205}00205\ \ \ \ \ \textcolor{comment}{\#\ Query\ worker\ address}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00206}00206\ \ \ \ \ controller\_url\ =\ args.controller\_url}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00207}00207\ \ \ \ \ ret\ =\ requests.post(controller\_url\ +\ \textcolor{stringliteral}{"{}/get\_worker\_address"{}},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \ \ \ json=\{\textcolor{stringliteral}{"{}model"{}}:\ model\_name\})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00209}00209\ \ \ \ \ worker\_addr\ =\ ret.json()[\textcolor{stringliteral}{"{}address"{}}]}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00210}00210\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}model\_name:\ \{model\_name\},\ worker\_addr:\ \{worker\_addr\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00211}00211\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00212}00212\ \ \ \ \ \textcolor{comment}{\#\ No\ available\ worker}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00213}00213\ \ \ \ \ \textcolor{keywordflow}{if}\ worker\_addr\ ==\ \textcolor{stringliteral}{"{}"{}}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00214}00214\ \ \ \ \ \ \ \ \ state.messages[-\/1][-\/1]\ =\ server\_error\_msg}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00215}00215\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ (state,\ state.to\_gradio\_chatbot(),\ disable\_btn,\ disable\_btn,\ disable\_btn,\ enable\_btn,\ enable\_btn)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00216}00216\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00217}00217\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00218}00218\ \ \ \ \ \textcolor{comment}{\#\ Construct\ prompt}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00219}00219\ \ \ \ \ prompt\ =\ state.get\_prompt()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00220}00220\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00221}00221\ \ \ \ \ all\_images\ =\ state.get\_images(return\_pil=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00222}00222\ \ \ \ \ all\_image\_hash\ =\ [hashlib.md5(image.tobytes()).hexdigest()\ \textcolor{keywordflow}{for}\ image\ \textcolor{keywordflow}{in}\ all\_images]}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00223}00223\ \ \ \ \ \textcolor{keywordflow}{for}\ image,\ hash\ \textcolor{keywordflow}{in}\ zip(all\_images,\ all\_image\_hash):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00224}00224\ \ \ \ \ \ \ \ \ t\ =\ datetime.datetime.now()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00225}00225\ \ \ \ \ \ \ \ \ filename\ =\ os.path.join(LOGDIR,\ \textcolor{stringliteral}{"{}serve\_images"{}},\ f\textcolor{stringliteral}{"{}\{t.year\}-\/\{t.month:02d\}-\/\{t.day:02d\}"{}},\ f\textcolor{stringliteral}{"{}\{hash\}.jpg"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00226}00226\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ os.path.isfile(filename):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00227}00227\ \ \ \ \ \ \ \ \ \ \ \ \ os.makedirs(os.path.dirname(filename),\ exist\_ok=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00228}00228\ \ \ \ \ \ \ \ \ \ \ \ \ image.save(filename)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00229}00229\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00230}00230\ \ \ \ \ \textcolor{comment}{\#\ Make\ requests}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00231}00231\ \ \ \ \ pload\ =\ \{}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00232}00232\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}model"{}}:\ model\_name,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00233}00233\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}prompt"{}}:\ prompt,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00234}00234\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}temperature"{}}:\ float(temperature),}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00235}00235\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}top\_p"{}}:\ float(top\_p),}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00236}00236\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}max\_new\_tokens"{}}:\ min(\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_adde3614dee937bc94d6b638414bceba0}{int}}(max\_new\_tokens),\ 1536),}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00237}00237\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}stop"{}}:\ state.sep\ \textcolor{keywordflow}{if}\ state.sep\_style\ \textcolor{keywordflow}{in}\ [SeparatorStyle.SINGLE,\ SeparatorStyle.MPT]\ \textcolor{keywordflow}{else}\ state.sep2,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00238}00238\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}images"{}}:\ f\textcolor{stringliteral}{'List\ of\ \{len(state.get\_images())\}\ images:\ \{all\_image\_hash\}'},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00239}00239\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00240}00240\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}====\ request\ ====\(\backslash\)n\{pload\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00241}00241\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00242}00242\ \ \ \ \ pload[\textcolor{stringliteral}{'images'}]\ =\ state.get\_images()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00243}00243\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00244}00244\ \ \ \ \ state.messages[-\/1][-\/1]\ =\ \textcolor{stringliteral}{"{}â–Œ"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00245}00245\ \ \ \ \ \textcolor{keywordflow}{yield}\ (state,\ state.to\_gradio\_chatbot())\ +\ (disable\_btn,)\ *\ 5}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00246}00246\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00247}00247\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00248}00248\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Stream\ output}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00249}00249\ \ \ \ \ \ \ \ \ response\ =\ requests.post(worker\_addr\ +\ \textcolor{stringliteral}{"{}/worker\_generate\_stream"{}},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00250}00250\ \ \ \ \ \ \ \ \ \ \ \ \ headers=headers,\ json=pload,\ stream=\textcolor{keyword}{True},\ timeout=10)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00251}00251\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ chunk\ \textcolor{keywordflow}{in}\ response.iter\_lines(decode\_unicode=\textcolor{keyword}{False},\ delimiter=b\textcolor{stringliteral}{"{}\(\backslash\)0"{}}):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00252}00252\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ chunk:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00253}00253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\ =\ json.loads(chunk.decode())}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00254}00254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ data[\textcolor{stringliteral}{"{}error\_code"{}}]\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00255}00255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\ =\ data[\textcolor{stringliteral}{"{}text"{}}][len(prompt):].strip()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00256}00256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ state.messages[-\/1][-\/1]\ =\ output\ +\ \textcolor{stringliteral}{"{}â–Œ"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00257}00257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ (state,\ state.to\_gradio\_chatbot())\ +\ (disable\_btn,)\ *\ 5}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00258}00258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00259}00259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\ =\ data[\textcolor{stringliteral}{"{}text"{}}]\ +\ f\textcolor{stringliteral}{"{}\ (error\_code:\ \{data['error\_code']\})"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00260}00260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ state.messages[-\/1][-\/1]\ =\ output}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00261}00261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ (state,\ state.to\_gradio\_chatbot())\ +\ (disable\_btn,\ disable\_btn,\ disable\_btn,\ enable\_btn,\ enable\_btn)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00262}00262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00263}00263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ time.sleep(0.03)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00264}00264\ \ \ \ \ \textcolor{keywordflow}{except}\ requests.exceptions.RequestException\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00265}00265\ \ \ \ \ \ \ \ \ state.messages[-\/1][-\/1]\ =\ server\_error\_msg}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00266}00266\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ (state,\ state.to\_gradio\_chatbot())\ +\ (disable\_btn,\ disable\_btn,\ disable\_btn,\ enable\_btn,\ enable\_btn)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00267}00267\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00268}00268\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00269}00269\ \ \ \ \ state.messages[-\/1][-\/1]\ =\ state.messages[-\/1][-\/1][:-\/1]}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00270}00270\ \ \ \ \ \textcolor{keywordflow}{yield}\ (state,\ state.to\_gradio\_chatbot())\ +\ (enable\_btn,)\ *\ 5}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00271}00271\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00272}00272\ \ \ \ \ finish\_tstamp\ =\ time.time()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00273}00273\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}\{output\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00274}00274\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00275}00275\ \ \ \ \ \textcolor{keyword}{with}\ open(\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a051e70056bbe57dbbbf2f75acd022f04}{get\_conv\_log\_filename}}(),\ \textcolor{stringliteral}{"{}a"{}})\ \textcolor{keyword}{as}\ fout:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00276}00276\ \ \ \ \ \ \ \ \ data\ =\ \{}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00277}00277\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}tstamp"{}}:\ round(finish\_tstamp,\ 4),}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00278}00278\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}type"{}}:\ \textcolor{stringliteral}{"{}chat"{}},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00279}00279\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}model"{}}:\ model\_name,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00280}00280\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}start"{}}:\ round(start\_tstamp,\ 4),}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00281}00281\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}finish"{}}:\ round(finish\_tstamp,\ 4),}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00282}00282\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}state"{}}:\ state.dict(),}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00283}00283\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}images"{}}:\ all\_image\_hash,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00284}00284\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}ip"{}}:\ request.client.host,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00285}00285\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00286}00286\ \ \ \ \ \ \ \ \ fout.write(json.dumps(data)\ +\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00287}00287\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00288}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_aa36484a74530d106a5263373898b8f05}{00288}}\ title\_markdown\ =\ (\textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00289}00289\ \textcolor{stringliteral}{\#\ ðŸŒ‹\ LLaVA:\ Large\ Language\ and\ Vision\ Assistant}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00290}00290\ \textcolor{stringliteral}{[[Project\ Page](https://llava-\/vl.github.io)]\ [[Code](https://github.com/haotian-\/liu/LLaVA)]\ [[Model](https://github.com/haotian-\/liu/LLaVA/blob/main/docs/MODEL\_ZOO.md)]\ |\ ðŸ“š\ [[LLaVA](https://arxiv.org/abs/2304.08485)]\ [[LLaVA-\/v1.5](https://arxiv.org/abs/2310.03744)]\ [[LLaVA-\/v1.6](https://llava-\/vl.github.io/blog/2024-\/01-\/30-\/llava-\/1-\/6/)]}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00291}00291\ \textcolor{stringliteral}{"{}"{}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00292}00292\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00293}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_aa572665932e372d830a39599f368c78d}{00293}}\ tos\_markdown\ =\ (\textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00294}00294\ \textcolor{stringliteral}{\#\#\#\ Terms\ of\ use}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00295}00295\ \textcolor{stringliteral}{By\ using\ this\ service,\ users\ are\ required\ to\ agree\ to\ the\ following\ terms:}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00296}00296\ \textcolor{stringliteral}{The\ service\ is\ a\ research\ preview\ intended\ for\ non-\/commercial\ use\ only.\ It\ only\ provides\ limited\ safety\ measures\ and\ may\ generate\ offensive\ content.\ It\ must\ not\ be\ used\ for\ any\ illegal,\ harmful,\ violent,\ racist,\ or\ sexual\ purposes.\ The\ service\ may\ collect\ user\ dialogue\ data\ for\ future\ research.}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00297}00297\ \textcolor{stringliteral}{Please\ click\ the\ "{}Flag"{}\ button\ if\ you\ get\ any\ inappropriate\ answer!\ We\ will\ collect\ those\ to\ keep\ improving\ our\ moderator.}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00298}00298\ \textcolor{stringliteral}{For\ an\ optimal\ experience,\ please\ use\ desktop\ computers\ for\ this\ demo,\ as\ mobile\ devices\ may\ compromise\ its\ quality.}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00299}00299\ \textcolor{stringliteral}{"{}"{}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00300}00300\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00301}00301\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00302}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_ad7b0a5e7c540efa14afb6455efc8f802}{00302}}\ learn\_more\_markdown\ =\ (\textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00303}00303\ \textcolor{stringliteral}{\#\#\#\ License}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00304}00304\ \textcolor{stringliteral}{The\ service\ is\ a\ research\ preview\ intended\ for\ non-\/commercial\ use\ only,\ subject\ to\ the\ model\ [License](https://github.com/facebookresearch/llama/blob/main/MODEL\_CARD.md)\ of\ LLaMA,\ [Terms\ of\ Use](https://openai.com/policies/terms-\/of-\/use)\ of\ the\ data\ generated\ by\ OpenAI,\ and\ [Privacy\ Practices](https://chrome.google.com/webstore/detail/sharegpt-\/share-\/your-\/chatg/daiacboceoaocpibfodeljbdfacokfjb)\ of\ ShareGPT.\ Please\ contact\ us\ if\ you\ find\ any\ potential\ violation.}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00305}00305\ \textcolor{stringliteral}{"{}"{}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00306}00306\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00307}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_af5d2d67d98d6574d28b052d5e505dab5}{00307}}\ block\_css\ =\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00308}00308\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00309}00309\ \textcolor{stringliteral}{\#buttons\ button\ \{}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00310}00310\ \textcolor{stringliteral}{\ \ \ \ min-\/width:\ min(120px,100\%);}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00311}00311\ \textcolor{stringliteral}{\}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00312}00312\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00313}00313\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00314}00314\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00315}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a79fc5afb330fad6a1ab146ab4f0f49a8}{00315}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a79fc5afb330fad6a1ab146ab4f0f49a8}{build\_demo}}(embed\_mode,\ cur\_dir=None,\ concurrency\_count=10):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00316}00316\ \ \ \ \ textbox\ =\ gr.Textbox(show\_label=\textcolor{keyword}{False},\ placeholder=\textcolor{stringliteral}{"{}Enter\ text\ and\ press\ ENTER"{}},\ container=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00317}00317\ \ \ \ \ \textcolor{keyword}{with}\ gr.Blocks(title=\textcolor{stringliteral}{"{}LLaVA"{}},\ theme=gr.themes.Default(),\ css=block\_css)\ \textcolor{keyword}{as}\ demo:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00318}00318\ \ \ \ \ \ \ \ \ state\ =\ gr.State()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00319}00319\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00320}00320\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ embed\_mode:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00321}00321\ \ \ \ \ \ \ \ \ \ \ \ \ gr.Markdown(title\_markdown)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00322}00322\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00323}00323\ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ gr.Row():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00324}00324\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ gr.Column(scale=3):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00325}00325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ gr.Row(elem\_id=\textcolor{stringliteral}{"{}model\_selector\_row"{}}):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00326}00326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ model\_selector\ =\ gr.Dropdown(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00327}00327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ choices=models,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00328}00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ value=models[0]\ \textcolor{keywordflow}{if}\ len(models)\ >\ 0\ \textcolor{keywordflow}{else}\ \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00329}00329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interactive=\textcolor{keyword}{True},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00330}00330\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ show\_label=\textcolor{keyword}{False},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00331}00331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ container=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00332}00332\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00333}00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ imagebox\ =\ gr.Image(type=\textcolor{stringliteral}{"{}pil"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00334}00334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image\_process\_mode\ =\ gr.Radio(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00335}00335\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\textcolor{stringliteral}{"{}Crop"{}},\ \textcolor{stringliteral}{"{}Resize"{}},\ \textcolor{stringliteral}{"{}Pad"{}},\ \textcolor{stringliteral}{"{}Default"{}}],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00336}00336\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ value=\textcolor{stringliteral}{"{}Default"{}},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00337}00337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ label=\textcolor{stringliteral}{"{}Preprocess\ for\ non-\/square\ image"{}},\ visible=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00338}00338\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00339}00339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ cur\_dir\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00340}00340\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cur\_dir\ =\ os.path.dirname(os.path.abspath(\_\_file\_\_))}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00341}00341\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gr.Examples(examples=[}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00342}00342\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [f\textcolor{stringliteral}{"{}\{cur\_dir\}/examples/extreme\_ironing.jpg"{}},\ \textcolor{stringliteral}{"{}What\ is\ unusual\ about\ this\ image?"{}}],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00343}00343\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [f\textcolor{stringliteral}{"{}\{cur\_dir\}/examples/waterview.jpg"{}},\ \textcolor{stringliteral}{"{}What\ are\ the\ things\ I\ should\ be\ cautious\ about\ when\ I\ visit\ here?"{}}],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00344}00344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ],\ inputs=[imagebox,\ textbox])}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00345}00345\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00346}00346\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ gr.Accordion(\textcolor{stringliteral}{"{}Parameters"{}},\ open=\textcolor{keyword}{False})\ \textcolor{keyword}{as}\ parameter\_row:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00347}00347\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ temperature\ =\ gr.Slider(minimum=0.0,\ maximum=1.0,\ value=0.2,\ step=0.1,\ interactive=\textcolor{keyword}{True},\ label=\textcolor{stringliteral}{"{}Temperature"{}},)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00348}00348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ top\_p\ =\ gr.Slider(minimum=0.0,\ maximum=1.0,\ value=0.7,\ step=0.1,\ interactive=\textcolor{keyword}{True},\ label=\textcolor{stringliteral}{"{}Top\ P"{}},)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00349}00349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max\_output\_tokens\ =\ gr.Slider(minimum=0,\ maximum=1024,\ value=512,\ step=64,\ interactive=\textcolor{keyword}{True},\ label=\textcolor{stringliteral}{"{}Max\ output\ tokens"{}},)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00350}00350\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00351}00351\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ gr.Column(scale=8):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00352}00352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chatbot\ =\ gr.Chatbot(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00353}00353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ elem\_id=\textcolor{stringliteral}{"{}chatbot"{}},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00354}00354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ label=\textcolor{stringliteral}{"{}LLaVA\ Chatbot"{}},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00355}00355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ height=650,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00356}00356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ layout=\textcolor{stringliteral}{"{}panel"{}},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00357}00357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00358}00358\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ gr.Row():}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00359}00359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ gr.Column(scale=8):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00360}00360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ textbox.render()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00361}00361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ gr.Column(scale=1,\ min\_width=50):}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00362}00362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ submit\_btn\ =\ gr.Button(value=\textcolor{stringliteral}{"{}Send"{}},\ variant=\textcolor{stringliteral}{"{}primary"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00363}00363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ gr.Row(elem\_id=\textcolor{stringliteral}{"{}buttons"{}})\ \textcolor{keyword}{as}\ button\_row:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00364}00364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ upvote\_btn\ =\ gr.Button(value=\textcolor{stringliteral}{"{}ðŸ‘\ \ Upvote"{}},\ interactive=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00365}00365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ downvote\_btn\ =\ gr.Button(value=\textcolor{stringliteral}{"{}ðŸ‘Ž\ \ Downvote"{}},\ interactive=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00366}00366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ flag\_btn\ =\ gr.Button(value=\textcolor{stringliteral}{"{}âš ï¸\ \ Flag"{}},\ interactive=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00367}00367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#stop\_btn\ =\ gr.Button(value="{}â¹ï¸\ \ Stop\ Generation"{},\ interactive=False)}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00368}00368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ regenerate\_btn\ =\ gr.Button(value=\textcolor{stringliteral}{"{}ðŸ”„\ \ Regenerate"{}},\ interactive=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00369}00369\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ clear\_btn\ =\ gr.Button(value=\textcolor{stringliteral}{"{}ðŸ—‘ï¸\ \ Clear"{}},\ interactive=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00370}00370\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00371}00371\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ embed\_mode:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00372}00372\ \ \ \ \ \ \ \ \ \ \ \ \ gr.Markdown(tos\_markdown)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00373}00373\ \ \ \ \ \ \ \ \ \ \ \ \ gr.Markdown(learn\_more\_markdown)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00374}00374\ \ \ \ \ \ \ \ \ url\_params\ =\ gr.JSON(visible=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00375}00375\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00376}00376\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Register\ listeners}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00377}00377\ \ \ \ \ \ \ \ \ btn\_list\ =\ [upvote\_btn,\ downvote\_btn,\ flag\_btn,\ regenerate\_btn,\ clear\_btn]}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00378}00378\ \ \ \ \ \ \ \ \ upvote\_btn.click(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00379}00379\ \ \ \ \ \ \ \ \ \ \ \ \ upvote\_last\_response,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00380}00380\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ model\_selector],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00381}00381\ \ \ \ \ \ \ \ \ \ \ \ \ [textbox,\ upvote\_btn,\ downvote\_btn,\ flag\_btn]}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00382}00382\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00383}00383\ \ \ \ \ \ \ \ \ downvote\_btn.click(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00384}00384\ \ \ \ \ \ \ \ \ \ \ \ \ downvote\_last\_response,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00385}00385\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ model\_selector],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00386}00386\ \ \ \ \ \ \ \ \ \ \ \ \ [textbox,\ upvote\_btn,\ downvote\_btn,\ flag\_btn]}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00387}00387\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00388}00388\ \ \ \ \ \ \ \ \ flag\_btn.click(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00389}00389\ \ \ \ \ \ \ \ \ \ \ \ \ flag\_last\_response,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00390}00390\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ model\_selector],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00391}00391\ \ \ \ \ \ \ \ \ \ \ \ \ [textbox,\ upvote\_btn,\ downvote\_btn,\ flag\_btn]}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00392}00392\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00393}00393\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00394}00394\ \ \ \ \ \ \ \ \ regenerate\_btn.click(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00395}00395\ \ \ \ \ \ \ \ \ \ \ \ \ regenerate,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00396}00396\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ image\_process\_mode],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00397}00397\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ chatbot,\ textbox,\ imagebox]\ +\ btn\_list}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00398}00398\ \ \ \ \ \ \ \ \ ).then(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00399}00399\ \ \ \ \ \ \ \ \ \ \ \ \ http\_bot,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00400}00400\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ model\_selector,\ temperature,\ top\_p,\ max\_output\_tokens],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00401}00401\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ chatbot]\ +\ btn\_list,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00402}00402\ \ \ \ \ \ \ \ \ \ \ \ \ concurrency\_limit=concurrency\_count}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00403}00403\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00404}00404\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00405}00405\ \ \ \ \ \ \ \ \ clear\_btn.click(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00406}00406\ \ \ \ \ \ \ \ \ \ \ \ \ clear\_history,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00407}00407\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{None},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00408}00408\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ chatbot,\ textbox,\ imagebox]\ +\ btn\_list,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00409}00409\ \ \ \ \ \ \ \ \ \ \ \ \ queue=\textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00410}00410\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00411}00411\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00412}00412\ \ \ \ \ \ \ \ \ textbox.submit(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00413}00413\ \ \ \ \ \ \ \ \ \ \ \ \ add\_text,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00414}00414\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ textbox,\ imagebox,\ image\_process\_mode],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00415}00415\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ chatbot,\ textbox,\ imagebox]\ +\ btn\_list,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00416}00416\ \ \ \ \ \ \ \ \ \ \ \ \ queue=\textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00417}00417\ \ \ \ \ \ \ \ \ ).then(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00418}00418\ \ \ \ \ \ \ \ \ \ \ \ \ http\_bot,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00419}00419\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ model\_selector,\ temperature,\ top\_p,\ max\_output\_tokens],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00420}00420\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ chatbot]\ +\ btn\_list,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00421}00421\ \ \ \ \ \ \ \ \ \ \ \ \ concurrency\_limit=concurrency\_count}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00422}00422\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00423}00423\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00424}00424\ \ \ \ \ \ \ \ \ submit\_btn.click(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00425}00425\ \ \ \ \ \ \ \ \ \ \ \ \ add\_text,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00426}00426\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ textbox,\ imagebox,\ image\_process\_mode],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00427}00427\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ chatbot,\ textbox,\ imagebox]\ +\ btn\_list}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00428}00428\ \ \ \ \ \ \ \ \ ).then(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00429}00429\ \ \ \ \ \ \ \ \ \ \ \ \ http\_bot,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00430}00430\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ model\_selector,\ temperature,\ top\_p,\ max\_output\_tokens],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00431}00431\ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ chatbot]\ +\ btn\_list,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00432}00432\ \ \ \ \ \ \ \ \ \ \ \ \ concurrency\_limit=concurrency\_count}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00433}00433\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00434}00434\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00435}00435\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ args.model\_list\_mode\ ==\ \textcolor{stringliteral}{"{}once"{}}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00436}00436\ \ \ \ \ \ \ \ \ \ \ \ \ demo.load(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00437}00437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ load\_demo,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00438}00438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [url\_params],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00439}00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ model\_selector],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00440}00440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ js=get\_window\_url\_params}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00441}00441\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00442}00442\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ args.model\_list\_mode\ ==\ \textcolor{stringliteral}{"{}reload"{}}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00443}00443\ \ \ \ \ \ \ \ \ \ \ \ \ demo.load(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00444}00444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ load\_demo\_refresh\_model\_list,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00445}00445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{None},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00446}00446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [state,\ model\_selector],}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00447}00447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ queue=\textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00448}00448\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00449}00449\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00450}00450\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(f\textcolor{stringliteral}{"{}Unknown\ model\ list\ mode:\ \{args.model\_list\_mode\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00451}00451\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00452}00452\ \ \ \ \ \textcolor{keywordflow}{return}\ demo}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00453}00453\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00454}00454\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00455}00455\ \textcolor{keywordflow}{if}\ \_\_name\_\_\ ==\ \textcolor{stringliteral}{"{}\_\_main\_\_"{}}:}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00456}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a9c91c1422c26a5245d253aa0d8edc56a}{00456}}\ \ \ \ \ parser\ =\ argparse.ArgumentParser()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00457}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a0f7a2fec5a700b4aad72f9141a499fd7}{00457}}\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/host"{}},\ type=str,\ default=\textcolor{stringliteral}{"{}0.0.0.0"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00458}00458\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/port"{}},\ type=int)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00459}00459\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/controller-\/url"{}},\ type=str,\ default=\textcolor{stringliteral}{"{}http://localhost:21001"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00460}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_adde3614dee937bc94d6b638414bceba0}{00460}}\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/concurrency-\/count"{}},\ type=int,\ default=16)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00461}00461\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/model-\/list-\/mode"{}},\ type=str,\ default=\textcolor{stringliteral}{"{}once"{}},}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00462}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_abbcd2eda18b93926f2c0e38c02876ea3}{00462}}\ \ \ \ \ \ \ \ \ choices=[\textcolor{stringliteral}{"{}once"{}},\ \textcolor{stringliteral}{"{}reload"{}}])}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00463}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a588fed3fe7932e1e382027de6e9cdd5d}{00463}}\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/share"{}},\ action=\textcolor{stringliteral}{"{}store\_true"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00464}00464\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/moderate"{}},\ action=\textcolor{stringliteral}{"{}store\_true"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00465}00465\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/embed"{}},\ action=\textcolor{stringliteral}{"{}store\_true"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00466}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a265d702a87d43f95259de3334227a58a}{00466}}\ \ \ \ \ args\ =\ parser.parse\_args()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00467}00467\ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}args:\ \{args\}"{}})}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00468}00468\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00469}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a470ecbce5e7dbf9fc1c4826d347f9b3d}{00469}}\ \ \ \ \ models\ =\ \mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a5e04990393402eb7011f171ecb0bb724}{get\_model\_list}}()}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00470}00470\ }
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00471}00471\ \ \ \ \ logger.info(args)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00472}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a4e82d3c5944dad0646403ad184e7af4c}{00472}}\ \ \ \ \ demo\ =\ \mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a79fc5afb330fad6a1ab146ab4f0f49a8}{build\_demo}}(args.embed,\ concurrency\_count=args.concurrency\_count)}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00473}00473\ \ \ \ \ demo.queue(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00474}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a5eda9791b947aae9179d672da69fcdd9}{00474}}\ \ \ \ \ \ \ \ \ api\_open=\textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00475}00475\ \ \ \ \ ).launch(}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00476}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_ad86e203e3c17743e8c79110b733190fb}{00476}}\ \ \ \ \ \ \ \ \ server\_name=args.host,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00477}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_a195508182f18d54d86316c2609c7b435}{00477}}\ \ \ \ \ \ \ \ \ server\_port=args.port,}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00478}\mbox{\hyperlink{namespacellava_1_1serve_1_1gradio__web__server_abe2f7521c420f275c15fd46b09c05633}{00478}}\ \ \ \ \ \ \ \ \ share=args.share}
\DoxyCodeLine{\Hypertarget{gradio__web__server_8py_source_l00479}00479\ \ \ \ \ )}

\end{DoxyCode}
