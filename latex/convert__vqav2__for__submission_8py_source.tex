\doxysection{convert\+\_\+vqav2\+\_\+for\+\_\+submission.\+py}
\hypertarget{convert__vqav2__for__submission_8py_source}{}\label{convert__vqav2__for__submission_8py_source}\index{scripts/convert\_vqav2\_for\_submission.py@{scripts/convert\_vqav2\_for\_submission.py}}
\mbox{\hyperlink{convert__vqav2__for__submission_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00001}\mbox{\hyperlink{namespaceconvert__vqav2__for__submission}{00001}}\ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00002}00002\ \textcolor{keyword}{import}\ argparse}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00003}00003\ \textcolor{keyword}{import}\ json}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00005}00005\ \textcolor{keyword}{from}\ llava.eval.m4c\_evaluator\ \textcolor{keyword}{import}\ EvalAIAnswerProcessor}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00008}\mbox{\hyperlink{namespaceconvert__vqav2__for__submission_a328b44b7e1a6fac5dc2c8b71f11aae75}{00008}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceconvert__vqav2__for__submission_a328b44b7e1a6fac5dc2c8b71f11aae75}{parse\_args}}():}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00009}00009\ \ \ \ \ parser\ =\ argparse.ArgumentParser()}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00010}00010\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{'-\/-\/dir'},\ type=str,\ default=\textcolor{stringliteral}{"{}./playground/data/eval/vqav2"{}})}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00011}00011\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{'-\/-\/ckpt'},\ type=str,\ required=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00012}00012\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{'-\/-\/split'},\ type=str,\ required=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00013}00013\ \ \ \ \ \textcolor{keywordflow}{return}\ parser.parse\_args()}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00016}00016\ \textcolor{keywordflow}{if}\ \_\_name\_\_\ ==\ \textcolor{stringliteral}{'\_\_main\_\_'}:}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00018}\mbox{\hyperlink{namespaceconvert__vqav2__for__submission_a8fd30f70cc834ea31673a35b4cc2ac53}{00018}}\ \ \ \ \ args\ =\ \mbox{\hyperlink{namespaceconvert__vqav2__for__submission_a328b44b7e1a6fac5dc2c8b71f11aae75}{parse\_args}}()}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00020}\mbox{\hyperlink{namespaceconvert__vqav2__for__submission_a510978fc36959e6d3e9ecfd47ab4ec42}{00020}}\ \ \ \ \ src\ =\ os.path.join(args.dir,\ \textcolor{stringliteral}{'answers'},\ args.split,\ args.ckpt,\ \textcolor{stringliteral}{'merge.jsonl'})}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00021}\mbox{\hyperlink{namespaceconvert__vqav2__for__submission_abc0be1d1f2629caf880bca332d161fef}{00021}}\ \ \ \ \ test\_split\ =\ os.path.join(args.dir,\ \textcolor{stringliteral}{'llava\_vqav2\_mscoco\_test2015.jsonl'})}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00022}\mbox{\hyperlink{namespaceconvert__vqav2__for__submission_a37866f4f391767efb1fa238f41e0bf55}{00022}}\ \ \ \ \ dst\ =\ os.path.join(args.dir,\ \textcolor{stringliteral}{'answers\_upload'},\ args.split,\ f\textcolor{stringliteral}{'\{args.ckpt\}.json'})}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00023}\mbox{\hyperlink{namespaceconvert__vqav2__for__submission_aff212422997f15ff676b9ee89702c674}{00023}}\ \ \ \ \ os.makedirs(os.path.dirname(dst),\ exist\_ok=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00025}\mbox{\hyperlink{namespaceconvert__vqav2__for__submission_a3d8b3ff9c8325f5eaf3ecc1910a18b05}{00025}}\ \ \ \ \ results\ =\ []}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00026}\mbox{\hyperlink{namespaceconvert__vqav2__for__submission_a33301141e319b8f126a5df831861a9a8}{00026}}\ \ \ \ \ error\_line\ =\ 0}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00027}00027\ \ \ \ \ \textcolor{keywordflow}{for}\ line\_idx,\ line\ \textcolor{keywordflow}{in}\ enumerate(open(src)):}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00028}00028\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00029}00029\ \ \ \ \ \ \ \ \ \ \ \ \ results.append(json.loads(line))}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00030}00030\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}:}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00031}00031\ \ \ \ \ \ \ \ \ \ \ \ \ error\_line\ +=\ 1}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00033}00033\ \ \ \ \ results\ =\ \{x[\textcolor{stringliteral}{'question\_id'}]:\ x[\textcolor{stringliteral}{'text'}]\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ results\}}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00034}00034\ \ \ \ \ test\_split\ =\ [json.loads(line)\ \textcolor{keywordflow}{for}\ line\ \textcolor{keywordflow}{in}\ open(test\_split)]}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00035}\mbox{\hyperlink{namespaceconvert__vqav2__for__submission_aa06747ad82ab2d980b96d9327431dad4}{00035}}\ \ \ \ \ split\_ids\ =\ set([x[\textcolor{stringliteral}{'question\_id'}]\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ test\_split])}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00036}00036\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00037}00037\ \ \ \ \ print(f\textcolor{stringliteral}{'total\ results:\ \{len(results)\},\ total\ split:\ \{len(test\_split)\},\ error\_line:\ \{error\_line\}'})}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00039}\mbox{\hyperlink{namespaceconvert__vqav2__for__submission_a59501dd5d0932b3ae651d0b0222077d5}{00039}}\ \ \ \ \ all\_answers\ =\ []}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00040}00040\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00041}\mbox{\hyperlink{namespaceconvert__vqav2__for__submission_aaee9415ac157b309bc291d3730a66379}{00041}}\ \ \ \ \ answer\_processor\ =\ EvalAIAnswerProcessor()}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00042}00042\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00043}00043\ \ \ \ \ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ test\_split:}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00044}00044\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ x[\textcolor{stringliteral}{'question\_id'}]\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ results:}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00045}00045\ \ \ \ \ \ \ \ \ \ \ \ \ all\_answers.append(\{}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00046}00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'question\_id'}:\ x[\textcolor{stringliteral}{'question\_id'}],}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00047}00047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'answer'}:\ \textcolor{stringliteral}{''}}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00048}00048\ \ \ \ \ \ \ \ \ \ \ \ \ \})}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00049}00049\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \ \ \ all\_answers.append(\{}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00051}00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'question\_id'}:\ x[\textcolor{stringliteral}{'question\_id'}],}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'answer'}:\ \mbox{\hyperlink{namespaceconvert__vqav2__for__submission_aaee9415ac157b309bc291d3730a66379}{answer\_processor}}(results[x[\textcolor{stringliteral}{'question\_id'}]])}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \ \ \ \})}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00054}00054\ }
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00055}00055\ \ \ \ \ \textcolor{keyword}{with}\ open(dst,\ \textcolor{stringliteral}{'w'})\ \textcolor{keyword}{as}\ f:}
\DoxyCodeLine{\Hypertarget{convert__vqav2__for__submission_8py_source_l00056}00056\ \ \ \ \ \ \ \ \ json.dump(all\_answers,\ open(dst,\ \textcolor{stringliteral}{'w'}))}

\end{DoxyCode}
