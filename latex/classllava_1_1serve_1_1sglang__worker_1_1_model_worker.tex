\doxysection{llava.\+serve.\+sglang\+\_\+worker.\+Model\+Worker Class Reference}
\hypertarget{classllava_1_1serve_1_1sglang__worker_1_1_model_worker}{}\label{classllava_1_1serve_1_1sglang__worker_1_1_model_worker}\index{llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_ae16edc11e91b44bdb7d6e47cbbb8fd1c}{\+\_\+\+\_\+init\+\_\+\+\_\+}} (self, \mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_ab1836c406554a5d89e348679717653b4}{controller\+\_\+addr}}, \mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_adf893cb46c1508e21e7289b706c25d7f}{worker\+\_\+addr}}, sgl\+\_\+endpoint, \mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_aeb246e2817561adc88517ce1c3f90ba5}{worker\+\_\+id}}, no\+\_\+register, \mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a8fc5d8673312c317ae103979cdf9f314}{model\+\_\+name}})
\item 
\mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a4d28a879c8a59361d4f9ea1b198931f7}{register\+\_\+to\+\_\+controller}} (self)
\item 
\mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a6915ed825ca90fb2ceea9fbe041dcc95}{send\+\_\+heart\+\_\+beat}} (self)
\item 
\mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a97b9071f2d49fddb2d1222245789a790}{get\+\_\+queue\+\_\+length}} (self)
\item 
\mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a342e888cb2785863ef671216cae4b375}{get\+\_\+status}} (self)
\item 
\mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a133401e0ef2a42bb85636b44004933a9}{generate\+\_\+stream}} (self, params)
\item 
\mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a0d7af55ab0db361e16e94e2c70f1fcf6}{generate\+\_\+stream\+\_\+gate}} (self, params)
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_ab1836c406554a5d89e348679717653b4}{controller\+\_\+addr}} = controller\+\_\+addr
\item 
\mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_adf893cb46c1508e21e7289b706c25d7f}{worker\+\_\+addr}} = worker\+\_\+addr
\item 
\mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_aeb246e2817561adc88517ce1c3f90ba5}{worker\+\_\+id}} = worker\+\_\+id
\item 
\mbox{\hyperlink{namespacellava_1_1serve_1_1sglang__worker_a006a1e20da180b43fa889b1bfd3b50eb}{str}} \mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a8fc5d8673312c317ae103979cdf9f314}{model\+\_\+name}} = model\+\_\+paths\mbox{[}-\/2\mbox{]} + "{}\+\_\+"{} + model\+\_\+paths\mbox{[}-\/1\mbox{]}
\item 
\mbox{\hyperlink{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_ab55f71cd1a703543f06c98744495fd63}{heart\+\_\+beat\+\_\+thread}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line \mbox{\hyperlink{sglang__worker_8py_source_l00054}{54}} of file \mbox{\hyperlink{sglang__worker_8py_source}{sglang\+\_\+worker.\+py}}.



\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_ae16edc11e91b44bdb7d6e47cbbb8fd1c}\index{llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}!\_\_init\_\_@{\_\_init\_\_}}
\index{\_\_init\_\_@{\_\_init\_\_}!llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}}
\doxysubsubsection{\texorpdfstring{\_\_init\_\_()}{\_\_init\_\_()}}
{\footnotesize\ttfamily \label{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_ae16edc11e91b44bdb7d6e47cbbb8fd1c} 
llava.\+serve.\+sglang\+\_\+worker.\+Model\+Worker.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{controller\+\_\+addr}{, }\item[{}]{worker\+\_\+addr}{, }\item[{}]{sgl\+\_\+endpoint}{, }\item[{}]{worker\+\_\+id}{, }\item[{}]{no\+\_\+register}{, }\item[{}]{model\+\_\+name}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sglang__worker_8py_source_l00055}{55}} of file \mbox{\hyperlink{sglang__worker_8py_source}{sglang\+\_\+worker.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ worker\_id,\ no\_register,\ model\_name):}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ self.controller\_addr\ =\ controller\_addr}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ self.worker\_addr\ =\ worker\_addr}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ self.worker\_id\ =\ worker\_id}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Select\ backend}}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ backend\ =\ RuntimeEndpoint(sgl\_endpoint)}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ sgl.set\_default\_backend(backend)}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ model\_path\ =\ backend.model\_info[\textcolor{stringliteral}{"{}model\_path"{}}]}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ model\_path.endswith(\textcolor{stringliteral}{"{}/"{}}):}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ model\_path\ =\ model\_path[:-\/1]}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ model\_name\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ model\_paths\ =\ model\_path.split(\textcolor{stringliteral}{"{}/"{}})}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ model\_paths[-\/1].startswith(\textcolor{stringliteral}{'checkpoint-\/'}):}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.model\_name\ =\ model\_paths[-\/2]\ +\ \textcolor{stringliteral}{"{}\_"{}}\ +\ model\_paths[-\/1]}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.model\_name\ =\ model\_paths[-\/1]}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ self.model\_name\ =\ model\_name}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}Loading\ the\ SGLANG\ model\ \{self.model\_name\}\ on\ worker\ \{worker\_id\}\ ..."{}})}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ no\_register:}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ self.register\_to\_controller()}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ self.heart\_beat\_thread\ =\ threading.Thread(}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ target=heart\_beat\_worker,\ args=(self,),\ daemon=\textcolor{keyword}{True})}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ self.heart\_beat\_thread.start()}
\DoxyCodeLine{00084\ }

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a133401e0ef2a42bb85636b44004933a9}\index{llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}!generate\_stream@{generate\_stream}}
\index{generate\_stream@{generate\_stream}!llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}}
\doxysubsubsection{\texorpdfstring{generate\_stream()}{generate\_stream()}}
{\footnotesize\ttfamily \label{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a133401e0ef2a42bb85636b44004933a9} 
llava.\+serve.\+sglang\+\_\+worker.\+Model\+Worker.\+generate\+\_\+stream (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{params}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sglang__worker_8py_source_l00132}{132}} of file \mbox{\hyperlink{sglang__worker_8py_source}{sglang\+\_\+worker.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keyword}{async\ def\ }generate\_stream(self,\ params):}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ ori\_prompt\ =\ prompt\ =\ params[\textcolor{stringliteral}{"{}prompt"{}}]}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ images\ =\ params.get(\textcolor{stringliteral}{"{}images"{}},\ \textcolor{keywordtype}{None})}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ images\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{and}\ len(images)\ >\ 0:}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(images)\ >\ 0:}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(images)\ !=\ prompt.count(DEFAULT\_IMAGE\_TOKEN):}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{"{}Number\ of\ images\ does\ not\ match\ number\ of\ <image>\ tokens\ in\ prompt"{}})}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ images\ =\ [load\_image\_from\_base64(image)\ \textcolor{keywordflow}{for}\ image\ \textcolor{keywordflow}{in}\ images]}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ FIXME:\ for\ image-\/start/end\ token}}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ replace\_token\ =\ DEFAULT\_IMAGE\_TOKEN}}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ if\ getattr(self.model.config,\ 'mm\_use\_im\_start\_end',\ False):}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ replace\_token\ =\ DEFAULT\_IM\_START\_TOKEN\ +\ replace\_token\ +\ DEFAULT\_IM\_END\_TOKEN}}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ prompt\ =\ prompt.replace(DEFAULT\_IMAGE\_TOKEN,\ replace\_token)}}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ prompt\ =\ prompt.replace(\textcolor{stringliteral}{'\ '}\ +\ DEFAULT\_IMAGE\_TOKEN\ +\ \textcolor{stringliteral}{'\(\backslash\)n'},\ DEFAULT\_IMAGE\_TOKEN)}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ prompt\_split\ =\ prompt.split(DEFAULT\_IMAGE\_TOKEN)}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ prompt\ =\ []}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(len(prompt\_split)):}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ prompt.append(prompt\_split[i])}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ i\ <\ len(images):}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ prompt.append(images[i])}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ prompt\ =\ [prompt]}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ temperature\ =\ float(params.get(\textcolor{stringliteral}{"{}temperature"{}},\ 1.0))}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ top\_p\ =\ float(params.get(\textcolor{stringliteral}{"{}top\_p"{}},\ 1.0))}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ max\_context\_length\ =\ getattr(model.config,\ 'max\_position\_embeddings',\ 2048)}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ max\_new\_tokens\ =\ min(int(params.get(\textcolor{stringliteral}{"{}max\_new\_tokens"{}},\ 256)),\ 1024)}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ stop\_str\ =\ params.get(\textcolor{stringliteral}{"{}stop"{}},\ \textcolor{keywordtype}{None})}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ stop\_str\ =\ [stop\_str]\ \textcolor{keywordflow}{if}\ stop\_str\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{else}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ print(\{\textcolor{stringliteral}{'prompt'}:\ prompt,\ \textcolor{stringliteral}{'max\_new\_tokens'}:\ max\_new\_tokens,\ \textcolor{stringliteral}{'temperature'}:\ temperature,\ \textcolor{stringliteral}{'top\_p'}:\ top\_p\})}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ state\ =\ pipeline.run(prompt,\ max\_new\_tokens,\ temperature=temperature,\ top\_p=top\_p,\ stream=\textcolor{keyword}{True})}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ generated\_text\ =\ ori\_prompt}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{keyword}{async}\ \textcolor{keywordflow}{for}\ text\_outputs\ \textcolor{keywordflow}{in}\ state.text\_async\_iter(var\_name=\textcolor{stringliteral}{"{}response"{}}):}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ generated\_text\ +=\ text\_outputs}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ json.dumps(\{\textcolor{stringliteral}{"{}text"{}}:\ generated\_text,\ \textcolor{stringliteral}{"{}error\_code"{}}:\ 0\}).encode()\ +\ b\textcolor{stringliteral}{"{}\(\backslash\)0"{}}}
\DoxyCodeLine{00171\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
% FIG 0
\Hypertarget{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a0d7af55ab0db361e16e94e2c70f1fcf6}\index{llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}!generate\_stream\_gate@{generate\_stream\_gate}}
\index{generate\_stream\_gate@{generate\_stream\_gate}!llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}}
\doxysubsubsection{\texorpdfstring{generate\_stream\_gate()}{generate\_stream\_gate()}}
{\footnotesize\ttfamily \label{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a0d7af55ab0db361e16e94e2c70f1fcf6} 
llava.\+serve.\+sglang\+\_\+worker.\+Model\+Worker.\+generate\+\_\+stream\+\_\+gate (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{params}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sglang__worker_8py_source_l00172}{172}} of file \mbox{\hyperlink{sglang__worker_8py_source}{sglang\+\_\+worker.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keyword}{async\ def\ }generate\_stream\_gate(self,\ params):}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{async}\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ self.generate\_stream(params):}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ x}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ ValueError\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{"{}Caught\ ValueError:"{}},\ e)}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ ret\ =\ \{}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}text"{}}:\ server\_error\_msg,}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}error\_code"{}}:\ 1,}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ json.dumps(ret).encode()\ +\ b\textcolor{stringliteral}{"{}\(\backslash\)0"{}}}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{"{}Caught\ Unknown\ Error"{}},\ e)}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ ret\ =\ \{}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}text"{}}:\ server\_error\_msg,}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}error\_code"{}}:\ 1,}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ json.dumps(ret).encode()\ +\ b\textcolor{stringliteral}{"{}\(\backslash\)0"{}}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ }

\end{DoxyCode}
Here is the call graph for this function\+:
% FIG 1
\Hypertarget{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a97b9071f2d49fddb2d1222245789a790}\index{llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}!get\_queue\_length@{get\_queue\_length}}
\index{get\_queue\_length@{get\_queue\_length}!llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}}
\doxysubsubsection{\texorpdfstring{get\_queue\_length()}{get\_queue\_length()}}
{\footnotesize\ttfamily \label{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a97b9071f2d49fddb2d1222245789a790} 
llava.\+serve.\+sglang\+\_\+worker.\+Model\+Worker.\+get\+\_\+queue\+\_\+length (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sglang__worker_8py_source_l00118}{118}} of file \mbox{\hyperlink{sglang__worker_8py_source}{sglang\+\_\+worker.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keyword}{def\ }get\_queue\_length(self):}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ model\_semaphore\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ args.limit\_model\_concurrency\ -\/\ model\_semaphore.\_value\ +\ (len(}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ model\_semaphore.\_waiters)\ \textcolor{keywordflow}{if}\ model\_semaphore.\_waiters\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{else}\ 0)}
\DoxyCodeLine{00124\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
% FIG 2
\Hypertarget{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a342e888cb2785863ef671216cae4b375}\index{llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}!get\_status@{get\_status}}
\index{get\_status@{get\_status}!llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}}
\doxysubsubsection{\texorpdfstring{get\_status()}{get\_status()}}
{\footnotesize\ttfamily \label{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a342e888cb2785863ef671216cae4b375} 
llava.\+serve.\+sglang\+\_\+worker.\+Model\+Worker.\+get\+\_\+status (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sglang__worker_8py_source_l00125}{125}} of file \mbox{\hyperlink{sglang__worker_8py_source}{sglang\+\_\+worker.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{keyword}{def\ }get\_status(self):}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}model\_names"{}}:\ [self.model\_name],}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}speed"{}}:\ 1,}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}queue\_length"{}}:\ self.get\_queue\_length(),}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00131\ }

\end{DoxyCode}
Here is the call graph for this function\+:
% FIG 3
Here is the caller graph for this function\+:
% FIG 4
\Hypertarget{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a4d28a879c8a59361d4f9ea1b198931f7}\index{llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}!register\_to\_controller@{register\_to\_controller}}
\index{register\_to\_controller@{register\_to\_controller}!llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}}
\doxysubsubsection{\texorpdfstring{register\_to\_controller()}{register\_to\_controller()}}
{\footnotesize\ttfamily \label{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a4d28a879c8a59361d4f9ea1b198931f7} 
llava.\+serve.\+sglang\+\_\+worker.\+Model\+Worker.\+register\+\_\+to\+\_\+controller (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sglang__worker_8py_source_l00085}{85}} of file \mbox{\hyperlink{sglang__worker_8py_source}{sglang\+\_\+worker.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keyword}{def\ }register\_to\_controller(self):}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ logger.info(\textcolor{stringliteral}{"{}Register\ to\ controller"{}})}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ url\ =\ self.controller\_addr\ +\ \textcolor{stringliteral}{"{}/register\_worker"{}}}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ data\ =\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}worker\_name"{}}:\ self.worker\_addr,}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}check\_heart\_beat"{}}:\ \textcolor{keyword}{True},}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}worker\_status"{}}:\ self.get\_status()}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ r\ =\ requests.post(url,\ json=data)}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ r.status\_code\ ==\ 200}
\DoxyCodeLine{00096\ }

\end{DoxyCode}
Here is the call graph for this function\+:
% FIG 5
Here is the caller graph for this function\+:
% FIG 6
\Hypertarget{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a6915ed825ca90fb2ceea9fbe041dcc95}\index{llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}!send\_heart\_beat@{send\_heart\_beat}}
\index{send\_heart\_beat@{send\_heart\_beat}!llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}}
\doxysubsubsection{\texorpdfstring{send\_heart\_beat()}{send\_heart\_beat()}}
{\footnotesize\ttfamily \label{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a6915ed825ca90fb2ceea9fbe041dcc95} 
llava.\+serve.\+sglang\+\_\+worker.\+Model\+Worker.\+send\+\_\+heart\+\_\+beat (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sglang__worker_8py_source_l00097}{97}} of file \mbox{\hyperlink{sglang__worker_8py_source}{sglang\+\_\+worker.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keyword}{def\ }send\_heart\_beat(self):}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}Send\ heart\ beat.\ Models:\ \{[self.model\_name]\}.\ "{}}}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}Semaphore:\ \{pretty\_print\_semaphore(model\_semaphore)\}.\ "{}}}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}global\_counter:\ \{global\_counter\}"{}})}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ url\ =\ self.controller\_addr\ +\ \textcolor{stringliteral}{"{}/receive\_heart\_beat"{}}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ \textcolor{keyword}{True}:}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ret\ =\ requests.post(url,\ json=\{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}worker\_name"{}}:\ self.worker\_addr,}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}queue\_length"{}}:\ self.get\_queue\_length()\},\ timeout=5)}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ exist\ =\ ret.json()[\textcolor{stringliteral}{"{}exist"{}}]}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ requests.exceptions.RequestException\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ logger.error(f\textcolor{stringliteral}{"{}heart\ beat\ error:\ \{e\}"{}})}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ time.sleep(5)}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ exist:}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ self.register\_to\_controller()}
\DoxyCodeLine{00117\ }

\end{DoxyCode}
Here is the call graph for this function\+:
% FIG 7


\doxysubsection{Member Data Documentation}
\Hypertarget{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_ab1836c406554a5d89e348679717653b4}\index{llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}!controller\_addr@{controller\_addr}}
\index{controller\_addr@{controller\_addr}!llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}}
\doxysubsubsection{\texorpdfstring{controller\_addr}{controller\_addr}}
{\footnotesize\ttfamily \label{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_ab1836c406554a5d89e348679717653b4} 
llava.\+serve.\+sglang\+\_\+worker.\+Model\+Worker.\+controller\+\_\+addr = controller\+\_\+addr}



Definition at line \mbox{\hyperlink{sglang__worker_8py_source_l00057}{57}} of file \mbox{\hyperlink{sglang__worker_8py_source}{sglang\+\_\+worker.\+py}}.

\Hypertarget{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_ab55f71cd1a703543f06c98744495fd63}\index{llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}!heart\_beat\_thread@{heart\_beat\_thread}}
\index{heart\_beat\_thread@{heart\_beat\_thread}!llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}}
\doxysubsubsection{\texorpdfstring{heart\_beat\_thread}{heart\_beat\_thread}}
{\footnotesize\ttfamily \label{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_ab55f71cd1a703543f06c98744495fd63} 
llava.\+serve.\+sglang\+\_\+worker.\+Model\+Worker.\+heart\+\_\+beat\+\_\+thread}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{=\ \ threading.Thread(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ target=heart\_beat\_worker,\ args=(self,),\ daemon=\textcolor{keyword}{True})}

\end{DoxyCode}


Definition at line \mbox{\hyperlink{sglang__worker_8py_source_l00081}{81}} of file \mbox{\hyperlink{sglang__worker_8py_source}{sglang\+\_\+worker.\+py}}.

\Hypertarget{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a8fc5d8673312c317ae103979cdf9f314}\index{llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}!model\_name@{model\_name}}
\index{model\_name@{model\_name}!llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}}
\doxysubsubsection{\texorpdfstring{model\_name}{model\_name}}
{\footnotesize\ttfamily \label{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_a8fc5d8673312c317ae103979cdf9f314} 
\mbox{\hyperlink{namespacellava_1_1serve_1_1sglang__worker_a006a1e20da180b43fa889b1bfd3b50eb}{str}} llava.\+serve.\+sglang\+\_\+worker.\+Model\+Worker.\+model\+\_\+name = model\+\_\+paths\mbox{[}-\/2\mbox{]} + "{}\+\_\+"{} + model\+\_\+paths\mbox{[}-\/1\mbox{]}}



Definition at line \mbox{\hyperlink{sglang__worker_8py_source_l00071}{71}} of file \mbox{\hyperlink{sglang__worker_8py_source}{sglang\+\_\+worker.\+py}}.

\Hypertarget{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_adf893cb46c1508e21e7289b706c25d7f}\index{llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}!worker\_addr@{worker\_addr}}
\index{worker\_addr@{worker\_addr}!llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}}
\doxysubsubsection{\texorpdfstring{worker\_addr}{worker\_addr}}
{\footnotesize\ttfamily \label{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_adf893cb46c1508e21e7289b706c25d7f} 
llava.\+serve.\+sglang\+\_\+worker.\+Model\+Worker.\+worker\+\_\+addr = worker\+\_\+addr}



Definition at line \mbox{\hyperlink{sglang__worker_8py_source_l00058}{58}} of file \mbox{\hyperlink{sglang__worker_8py_source}{sglang\+\_\+worker.\+py}}.

\Hypertarget{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_aeb246e2817561adc88517ce1c3f90ba5}\index{llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}!worker\_id@{worker\_id}}
\index{worker\_id@{worker\_id}!llava.serve.sglang\_worker.ModelWorker@{llava.serve.sglang\_worker.ModelWorker}}
\doxysubsubsection{\texorpdfstring{worker\_id}{worker\_id}}
{\footnotesize\ttfamily \label{classllava_1_1serve_1_1sglang__worker_1_1_model_worker_aeb246e2817561adc88517ce1c3f90ba5} 
llava.\+serve.\+sglang\+\_\+worker.\+Model\+Worker.\+worker\+\_\+id = worker\+\_\+id}



Definition at line \mbox{\hyperlink{sglang__worker_8py_source_l00059}{59}} of file \mbox{\hyperlink{sglang__worker_8py_source}{sglang\+\_\+worker.\+py}}.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
llava/serve/\mbox{\hyperlink{sglang__worker_8py}{sglang\+\_\+worker.\+py}}\end{DoxyCompactItemize}
