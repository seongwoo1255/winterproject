\doxysection{model\+\_\+vqa\+\_\+science Namespace Reference}
\hypertarget{namespacemodel__vqa__science}{}\label{namespacemodel__vqa__science}\index{model\_vqa\_science@{model\_vqa\_science}}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacemodel__vqa__science_a1674fc1be04ac26c6ae97fb6672d19c6}{split\+\_\+list}} (lst, n)
\item 
\mbox{\hyperlink{namespacemodel__vqa__science_a3348d548ad6768982ecb7ff411c3542d}{get\+\_\+chunk}} (lst, n, k)
\item 
\mbox{\hyperlink{namespacemodel__vqa__science_a4c2aa78b64eac3368bc4069daf473a39}{eval\+\_\+model}} (\mbox{\hyperlink{namespacemodel__vqa__science_aeec20ea62fe6c6c91ec309d58f39e990}{args}})
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacemodel__vqa__science_ad45e0cd7ebb298b8887ef08cdf681d57}{parser}} = argparse.\+Argument\+Parser()
\item 
\mbox{\hyperlink{namespacemodel__vqa__science_a96ed2903417054f0655b68add461abe1}{type}}
\item 
\mbox{\hyperlink{namespacemodel__vqa__science_a3878d2a176d5b99451f4767a1284c059}{str}}
\item 
\mbox{\hyperlink{namespacemodel__vqa__science_a1dae8e20698189c7ebc9f30faa403900}{default}}
\item 
\mbox{\hyperlink{namespacemodel__vqa__science_a70f79d52599d5cb8fbc26aa97e55a815}{int}}
\item 
\mbox{\hyperlink{namespacemodel__vqa__science_ab1648604499e16b5202343be93cb41a5}{float}}
\item 
\mbox{\hyperlink{namespacemodel__vqa__science_a7d434750cdeb0b72cb0e07eec4b02a15}{action}}
\item 
\mbox{\hyperlink{namespacemodel__vqa__science_aeec20ea62fe6c6c91ec309d58f39e990}{args}} = parser.\+parse\+\_\+args()
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\Hypertarget{namespacemodel__vqa__science_a4c2aa78b64eac3368bc4069daf473a39}\index{model\_vqa\_science@{model\_vqa\_science}!eval\_model@{eval\_model}}
\index{eval\_model@{eval\_model}!model\_vqa\_science@{model\_vqa\_science}}
\doxysubsubsection{\texorpdfstring{eval\_model()}{eval\_model()}}
{\footnotesize\ttfamily \label{namespacemodel__vqa__science_a4c2aa78b64eac3368bc4069daf473a39} 
model\+\_\+vqa\+\_\+science.\+eval\+\_\+model (\begin{DoxyParamCaption}\item[{}]{args}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{model__vqa__science_8py_source_l00029}{29}} of file \mbox{\hyperlink{model__vqa__science_8py_source}{model\+\_\+vqa\+\_\+science.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00029\ \textcolor{keyword}{def\ }eval\_model(args):}
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{comment}{\#\ Model}}
\DoxyCodeLine{00031\ \ \ \ \ disable\_torch\_init()}
\DoxyCodeLine{00032\ \ \ \ \ model\_path\ =\ os.path.expanduser(args.model\_path)}
\DoxyCodeLine{00033\ \ \ \ \ model\_name\ =\ get\_model\_name\_from\_path(model\_path)}
\DoxyCodeLine{00034\ \ \ \ \ tokenizer,\ model,\ image\_processor,\ context\_len\ =\ load\_pretrained\_model(model\_path,\ args.model\_base,\ model\_name)}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ questions\ =\ json.load(open(os.path.expanduser(args.question\_file),\ \textcolor{stringliteral}{"{}r"{}}))}
\DoxyCodeLine{00037\ \ \ \ \ questions\ =\ get\_chunk(questions,\ args.num\_chunks,\ args.chunk\_idx)}
\DoxyCodeLine{00038\ \ \ \ \ answers\_file\ =\ os.path.expanduser(args.answers\_file)}
\DoxyCodeLine{00039\ \ \ \ \ os.makedirs(os.path.dirname(answers\_file),\ exist\_ok=\textcolor{keyword}{True})}
\DoxyCodeLine{00040\ \ \ \ \ ans\_file\ =\ open(answers\_file,\ \textcolor{stringliteral}{"{}w"{}})}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ line\ \textcolor{keywordflow}{in}\ enumerate(tqdm(questions)):}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ idx\ =\ line[\textcolor{stringliteral}{"{}id"{}}]}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ question\ =\ line[\textcolor{stringliteral}{'conversations'}][0]}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ qs\ =\ question[\textcolor{stringliteral}{'value'}].replace(\textcolor{stringliteral}{'<image>'},\ \textcolor{stringliteral}{''}).strip()}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ cur\_prompt\ =\ qs}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{'image'}\ \textcolor{keywordflow}{in}\ line:}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ image\_file\ =\ line[\textcolor{stringliteral}{"{}image"{}}]}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ image\ =\ Image.open(os.path.join(args.image\_folder,\ image\_file))}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ image\_tensor\ =\ process\_images([image],\ image\_processor,\ model.config)[0]}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ images\ =\ image\_tensor.unsqueeze(0).half().cuda()}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ image\_sizes\ =\ [image.size]}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ getattr(model.config,\ \textcolor{stringliteral}{'mm\_use\_im\_start\_end'},\ \textcolor{keyword}{False}):}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ qs\ =\ DEFAULT\_IM\_START\_TOKEN\ +\ DEFAULT\_IMAGE\_TOKEN\ +\ DEFAULT\_IM\_END\_TOKEN\ +\ \textcolor{stringliteral}{'\(\backslash\)n'}\ +\ qs}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ qs\ =\ DEFAULT\_IMAGE\_TOKEN\ +\ \textcolor{stringliteral}{'\(\backslash\)n'}\ +\ qs}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ cur\_prompt\ =\ \textcolor{stringliteral}{'<image>'}\ +\ \textcolor{stringliteral}{'\(\backslash\)n'}\ +\ cur\_prompt}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ images\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ image\_sizes\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ args.single\_pred\_prompt:}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ qs\ =\ qs\ +\ \textcolor{stringliteral}{'\(\backslash\)n'}\ +\ \textcolor{stringliteral}{"{}Answer\ with\ the\ option's\ letter\ from\ the\ given\ choices\ directly."{}}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ cur\_prompt\ =\ cur\_prompt\ +\ \textcolor{stringliteral}{'\(\backslash\)n'}\ +\ \textcolor{stringliteral}{"{}Answer\ with\ the\ option's\ letter\ from\ the\ given\ choices\ directly."{}}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ conv\ =\ conv\_templates[args.conv\_mode].copy()}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ conv.append\_message(conv.roles[0],\ qs)}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ conv.append\_message(conv.roles[1],\ \textcolor{keywordtype}{None})}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ prompt\ =\ conv.get\_prompt()}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ input\_ids\ =\ tokenizer\_image\_token(prompt,\ tokenizer,\ IMAGE\_TOKEN\_INDEX,\ return\_tensors=\textcolor{stringliteral}{'pt'}).unsqueeze(0).cuda()}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ torch.inference\_mode():}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ output\_ids\ =\ model.generate(}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input\_ids,}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ images=images,}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image\_sizes=image\_sizes,}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ do\_sample=\textcolor{keyword}{True}\ \textcolor{keywordflow}{if}\ args.temperature\ >\ 0\ \textcolor{keywordflow}{else}\ \textcolor{keyword}{False},}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ temperature=args.temperature,}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max\_new\_tokens=1024,}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ use\_cache=\textcolor{keyword}{True},}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ outputs\ =\ tokenizer.batch\_decode(output\_ids,\ skip\_special\_tokens=\textcolor{keyword}{True})[0].strip()}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ ans\_id\ =\ shortuuid.uuid()}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ ans\_file.write(json.dumps(\{\textcolor{stringliteral}{"{}question\_id"{}}:\ idx,}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}prompt"{}}:\ cur\_prompt,}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}text"{}}:\ outputs,}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}answer\_id"{}}:\ ans\_id,}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}model\_id"{}}:\ model\_name,}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}metadata"{}}:\ \{\}\})\ +\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}})}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ ans\_file.flush()}
\DoxyCodeLine{00094\ \ \ \ \ ans\_file.close()}
\DoxyCodeLine{00095\ }

\end{DoxyCode}
Here is the call graph for this function\+:
% FIG 0
\Hypertarget{namespacemodel__vqa__science_a3348d548ad6768982ecb7ff411c3542d}\index{model\_vqa\_science@{model\_vqa\_science}!get\_chunk@{get\_chunk}}
\index{get\_chunk@{get\_chunk}!model\_vqa\_science@{model\_vqa\_science}}
\doxysubsubsection{\texorpdfstring{get\_chunk()}{get\_chunk()}}
{\footnotesize\ttfamily \label{namespacemodel__vqa__science_a3348d548ad6768982ecb7ff411c3542d} 
model\+\_\+vqa\+\_\+science.\+get\+\_\+chunk (\begin{DoxyParamCaption}\item[{}]{lst}{, }\item[{}]{n}{, }\item[{}]{k}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{model__vqa__science_8py_source_l00024}{24}} of file \mbox{\hyperlink{model__vqa__science_8py_source}{model\+\_\+vqa\+\_\+science.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00024\ \textcolor{keyword}{def\ }get\_chunk(lst,\ n,\ k):}
\DoxyCodeLine{00025\ \ \ \ \ chunks\ =\ split\_list(lst,\ n)}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keywordflow}{return}\ chunks[k]}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ }

\end{DoxyCode}
Here is the call graph for this function\+:
% FIG 1
Here is the caller graph for this function\+:
% FIG 2
\Hypertarget{namespacemodel__vqa__science_a1674fc1be04ac26c6ae97fb6672d19c6}\index{model\_vqa\_science@{model\_vqa\_science}!split\_list@{split\_list}}
\index{split\_list@{split\_list}!model\_vqa\_science@{model\_vqa\_science}}
\doxysubsubsection{\texorpdfstring{split\_list()}{split\_list()}}
{\footnotesize\ttfamily \label{namespacemodel__vqa__science_a1674fc1be04ac26c6ae97fb6672d19c6} 
model\+\_\+vqa\+\_\+science.\+split\+\_\+list (\begin{DoxyParamCaption}\item[{}]{lst}{, }\item[{}]{n}{}\end{DoxyParamCaption})}

\begin{DoxyVerb}Split a list into n (roughly) equal-sized chunks\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{model__vqa__science_8py_source_l00018}{18}} of file \mbox{\hyperlink{model__vqa__science_8py_source}{model\+\_\+vqa\+\_\+science.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00018\ \textcolor{keyword}{def\ }split\_list(lst,\ n):}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Split\ a\ list\ into\ n\ (roughly)\ equal-\/sized\ chunks"{}"{}"{}}}
\DoxyCodeLine{00020\ \ \ \ \ chunk\_size\ =\ math.ceil(len(lst)\ /\ n)\ \ \textcolor{comment}{\#\ integer\ division}}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{keywordflow}{return}\ [lst[i:i+chunk\_size]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(0,\ len(lst),\ chunk\_size)]}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
% FIG 3


\doxysubsection{Variable Documentation}
\Hypertarget{namespacemodel__vqa__science_a7d434750cdeb0b72cb0e07eec4b02a15}\index{model\_vqa\_science@{model\_vqa\_science}!action@{action}}
\index{action@{action}!model\_vqa\_science@{model\_vqa\_science}}
\doxysubsubsection{\texorpdfstring{action}{action}}
{\footnotesize\ttfamily \label{namespacemodel__vqa__science_a7d434750cdeb0b72cb0e07eec4b02a15} 
model\+\_\+vqa\+\_\+science.\+action}



Definition at line \mbox{\hyperlink{model__vqa__science_8py_source_l00107}{107}} of file \mbox{\hyperlink{model__vqa__science_8py_source}{model\+\_\+vqa\+\_\+science.\+py}}.

\Hypertarget{namespacemodel__vqa__science_aeec20ea62fe6c6c91ec309d58f39e990}\index{model\_vqa\_science@{model\_vqa\_science}!args@{args}}
\index{args@{args}!model\_vqa\_science@{model\_vqa\_science}}
\doxysubsubsection{\texorpdfstring{args}{args}}
{\footnotesize\ttfamily \label{namespacemodel__vqa__science_aeec20ea62fe6c6c91ec309d58f39e990} 
model\+\_\+vqa\+\_\+science.\+args = parser.\+parse\+\_\+args()}



Definition at line \mbox{\hyperlink{model__vqa__science_8py_source_l00109}{109}} of file \mbox{\hyperlink{model__vqa__science_8py_source}{model\+\_\+vqa\+\_\+science.\+py}}.

\Hypertarget{namespacemodel__vqa__science_a1dae8e20698189c7ebc9f30faa403900}\index{model\_vqa\_science@{model\_vqa\_science}!default@{default}}
\index{default@{default}!model\_vqa\_science@{model\_vqa\_science}}
\doxysubsubsection{\texorpdfstring{default}{default}}
{\footnotesize\ttfamily \label{namespacemodel__vqa__science_a1dae8e20698189c7ebc9f30faa403900} 
model\+\_\+vqa\+\_\+science.\+default}



Definition at line \mbox{\hyperlink{model__vqa__science_8py_source_l00098}{98}} of file \mbox{\hyperlink{model__vqa__science_8py_source}{model\+\_\+vqa\+\_\+science.\+py}}.

\Hypertarget{namespacemodel__vqa__science_ab1648604499e16b5202343be93cb41a5}\index{model\_vqa\_science@{model\_vqa\_science}!float@{float}}
\index{float@{float}!model\_vqa\_science@{model\_vqa\_science}}
\doxysubsubsection{\texorpdfstring{float}{float}}
{\footnotesize\ttfamily \label{namespacemodel__vqa__science_ab1648604499e16b5202343be93cb41a5} 
model\+\_\+vqa\+\_\+science.\+float}



Definition at line \mbox{\hyperlink{model__vqa__science_8py_source_l00106}{106}} of file \mbox{\hyperlink{model__vqa__science_8py_source}{model\+\_\+vqa\+\_\+science.\+py}}.

\Hypertarget{namespacemodel__vqa__science_a70f79d52599d5cb8fbc26aa97e55a815}\index{model\_vqa\_science@{model\_vqa\_science}!int@{int}}
\index{int@{int}!model\_vqa\_science@{model\_vqa\_science}}
\doxysubsubsection{\texorpdfstring{int}{int}}
{\footnotesize\ttfamily \label{namespacemodel__vqa__science_a70f79d52599d5cb8fbc26aa97e55a815} 
model\+\_\+vqa\+\_\+science.\+int}



Definition at line \mbox{\hyperlink{model__vqa__science_8py_source_l00104}{104}} of file \mbox{\hyperlink{model__vqa__science_8py_source}{model\+\_\+vqa\+\_\+science.\+py}}.

\Hypertarget{namespacemodel__vqa__science_ad45e0cd7ebb298b8887ef08cdf681d57}\index{model\_vqa\_science@{model\_vqa\_science}!parser@{parser}}
\index{parser@{parser}!model\_vqa\_science@{model\_vqa\_science}}
\doxysubsubsection{\texorpdfstring{parser}{parser}}
{\footnotesize\ttfamily \label{namespacemodel__vqa__science_ad45e0cd7ebb298b8887ef08cdf681d57} 
model\+\_\+vqa\+\_\+science.\+parser = argparse.\+Argument\+Parser()}



Definition at line \mbox{\hyperlink{model__vqa__science_8py_source_l00097}{97}} of file \mbox{\hyperlink{model__vqa__science_8py_source}{model\+\_\+vqa\+\_\+science.\+py}}.

\Hypertarget{namespacemodel__vqa__science_a3878d2a176d5b99451f4767a1284c059}\index{model\_vqa\_science@{model\_vqa\_science}!str@{str}}
\index{str@{str}!model\_vqa\_science@{model\_vqa\_science}}
\doxysubsubsection{\texorpdfstring{str}{str}}
{\footnotesize\ttfamily \label{namespacemodel__vqa__science_a3878d2a176d5b99451f4767a1284c059} 
model\+\_\+vqa\+\_\+science.\+str}



Definition at line \mbox{\hyperlink{model__vqa__science_8py_source_l00098}{98}} of file \mbox{\hyperlink{model__vqa__science_8py_source}{model\+\_\+vqa\+\_\+science.\+py}}.

\Hypertarget{namespacemodel__vqa__science_a96ed2903417054f0655b68add461abe1}\index{model\_vqa\_science@{model\_vqa\_science}!type@{type}}
\index{type@{type}!model\_vqa\_science@{model\_vqa\_science}}
\doxysubsubsection{\texorpdfstring{type}{type}}
{\footnotesize\ttfamily \label{namespacemodel__vqa__science_a96ed2903417054f0655b68add461abe1} 
model\+\_\+vqa\+\_\+science.\+type}



Definition at line \mbox{\hyperlink{model__vqa__science_8py_source_l00098}{98}} of file \mbox{\hyperlink{model__vqa__science_8py_source}{model\+\_\+vqa\+\_\+science.\+py}}.

