<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLaVA: llava/conversation.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LLaVA<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('conversation_8py_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">conversation.py</div></div>
</div><!--header-->
<div class="contents">
<a href="conversation_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html">    1</a></span><span class="keyword">import</span> dataclasses</div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="keyword">from</span> enum <span class="keyword">import</span> auto, Enum</div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="keyword">from</span> typing <span class="keyword">import</span> List, Tuple</div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="keyword">import</span> base64</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span> </div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span> </div>
<div class="foldopen" id="foldopen00009" data-start="" data-end="">
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_separator_style.html">    9</a></span><span class="keyword">class </span><a class="code hl_class" href="classllava_1_1conversation_1_1_separator_style.html">SeparatorStyle</a>(Enum):</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>    <span class="stringliteral">&quot;&quot;&quot;Different separator style.&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_separator_style.html#ac0cbb2d2865d68de042f9cc90feb2597">   11</a></span>    SINGLE = auto()</div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_separator_style.html#a913eb74d985f3cf326cddfb045bbf9cc">   12</a></span>    TWO = auto()</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_separator_style.html#afb154f5b529439539acf86465baed722">   13</a></span>    MPT = auto()</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_separator_style.html#ab7a7e891598675264f7157538523510f">   14</a></span>    PLAIN = auto()</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_separator_style.html#a32e595198fb71446c75e3f8cb9c03119">   15</a></span>    LLAMA_2 = auto()</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">@dataclasses.dataclass</span></div>
</div>
<div class="foldopen" id="foldopen00019" data-start="" data-end="">
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html">   19</a></span><span class="keyword">class </span><a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>:</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span>    <span class="stringliteral">&quot;&quot;&quot;A class that keeps all conversation history.&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>    system: str</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#aa85e8b8e6c6921a4ff32e619683dc8ad">   22</a></span>    roles: List[str]</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#ae3a5c57f049e96e6f225434bb9406bcf">   23</a></span>    messages: List[List[str]]</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>    offset: int</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#ab9968dbbe5f135e7bbad503aadcf822b">   25</a></span>    sep_style: SeparatorStyle = SeparatorStyle.SINGLE</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#ad226cecbaf3967b428df96dd6cdc7838">   26</a></span>    sep: str = <span class="stringliteral">&quot;###&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#a488eab928bb2bb10cb31d81bcdeec79f">   27</a></span>    sep2: str = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#a867869994113a0c5cbb01e713ed860d1">   28</a></span>    version: str = <span class="stringliteral">&quot;Unknown&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#ab9005b8aab961f9facc88115a8aebabb">   30</a></span>    skip_next: bool = <span class="keyword">False</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="foldopen" id="foldopen00032" data-start="" data-end="">
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#aa23fe0d270adbdfe0bd8fed0a5cc5e20">   32</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classllava_1_1conversation_1_1_conversation.html#aa23fe0d270adbdfe0bd8fed0a5cc5e20">get_prompt</a>(self):</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>        messages = self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ae3a5c57f049e96e6f225434bb9406bcf">messages</a></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>        <span class="keywordflow">if</span> len(messages) &gt; 0 <span class="keywordflow">and</span> type(messages[0][1]) <span class="keywordflow">is</span> tuple:</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>            messages = self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ae3a5c57f049e96e6f225434bb9406bcf">messages</a>.<a class="code hl_function" href="classllava_1_1conversation_1_1_conversation.html#a38d8efc1a45190d1efce9d318c533cbc">copy</a>()</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>            init_role, init_msg = messages[0].<a class="code hl_function" href="classllava_1_1conversation_1_1_conversation.html#a38d8efc1a45190d1efce9d318c533cbc">copy</a>()</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>            init_msg = init_msg[0].replace(<span class="stringliteral">&quot;&lt;image&gt;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>).strip()</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>            <span class="keywordflow">if</span> <span class="stringliteral">&#39;mmtag&#39;</span> <span class="keywordflow">in</span> self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#a867869994113a0c5cbb01e713ed860d1">version</a>:</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>                messages[0] = (init_role, init_msg)</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>                messages.insert(0, (self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#aa85e8b8e6c6921a4ff32e619683dc8ad">roles</a>[0], <span class="stringliteral">&quot;&lt;Image&gt;&lt;image&gt;&lt;/Image&gt;&quot;</span>))</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>                messages.insert(1, (self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#aa85e8b8e6c6921a4ff32e619683dc8ad">roles</a>[1], <span class="stringliteral">&quot;Received.&quot;</span>))</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>                messages[0] = (init_role, <span class="stringliteral">&quot;&lt;image&gt;\n&quot;</span> + init_msg)</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span> </div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>        <span class="keywordflow">if</span> self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ab9968dbbe5f135e7bbad503aadcf822b">sep_style</a> == SeparatorStyle.SINGLE:</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>            ret = self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#af781ad32d8cfa3eb46854935efdadf6e">system</a> + self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ad226cecbaf3967b428df96dd6cdc7838">sep</a></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>            <span class="keywordflow">for</span> role, message <span class="keywordflow">in</span> messages:</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>                <span class="keywordflow">if</span> message:</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>                    <span class="keywordflow">if</span> type(message) <span class="keywordflow">is</span> tuple:</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>                        message, _, _ = message</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>                    ret += role + <span class="stringliteral">&quot;: &quot;</span> + message + self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ad226cecbaf3967b428df96dd6cdc7838">sep</a></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>                    ret += role + <span class="stringliteral">&quot;:&quot;</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>        <span class="keywordflow">elif</span> self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ab9968dbbe5f135e7bbad503aadcf822b">sep_style</a> == SeparatorStyle.TWO:</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>            seps = [self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ad226cecbaf3967b428df96dd6cdc7838">sep</a>, self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#a488eab928bb2bb10cb31d81bcdeec79f">sep2</a>]</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>            ret = self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#af781ad32d8cfa3eb46854935efdadf6e">system</a> + seps[0]</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>            <span class="keywordflow">for</span> i, (role, message) <span class="keywordflow">in</span> enumerate(messages):</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>                <span class="keywordflow">if</span> message:</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>                    <span class="keywordflow">if</span> type(message) <span class="keywordflow">is</span> tuple:</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>                        message, _, _ = message</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>                    ret += role + <span class="stringliteral">&quot;: &quot;</span> + message + seps[i % 2]</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>                    ret += role + <span class="stringliteral">&quot;:&quot;</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>        <span class="keywordflow">elif</span> self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ab9968dbbe5f135e7bbad503aadcf822b">sep_style</a> == SeparatorStyle.MPT:</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>            ret = self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#af781ad32d8cfa3eb46854935efdadf6e">system</a> + self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ad226cecbaf3967b428df96dd6cdc7838">sep</a></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>            <span class="keywordflow">for</span> role, message <span class="keywordflow">in</span> messages:</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>                <span class="keywordflow">if</span> message:</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>                    <span class="keywordflow">if</span> type(message) <span class="keywordflow">is</span> tuple:</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>                        message, _, _ = message</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>                    ret += role + message + self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ad226cecbaf3967b428df96dd6cdc7838">sep</a></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>                    ret += role</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>        <span class="keywordflow">elif</span> self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ab9968dbbe5f135e7bbad503aadcf822b">sep_style</a> == SeparatorStyle.LLAMA_2:</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>            wrap_sys = <span class="keyword">lambda</span> msg: f<span class="stringliteral">&quot;&lt;&lt;SYS&gt;&gt;\n{msg}\n&lt;&lt;/SYS&gt;&gt;\n\n&quot;</span> <span class="keywordflow">if</span> len(msg) &gt; 0 <span class="keywordflow">else</span> msg</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>            wrap_inst = <span class="keyword">lambda</span> msg: f<span class="stringliteral">&quot;[INST] {msg} [/INST]&quot;</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>            ret = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span> </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>            <span class="keywordflow">for</span> i, (role, message) <span class="keywordflow">in</span> enumerate(messages):</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>                <span class="keywordflow">if</span> i == 0:</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>                    <span class="keyword">assert</span> message, <span class="stringliteral">&quot;first message should not be none&quot;</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>                    <span class="keyword">assert</span> role == self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#aa85e8b8e6c6921a4ff32e619683dc8ad">roles</a>[0], <span class="stringliteral">&quot;first message should come from user&quot;</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>                <span class="keywordflow">if</span> message:</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>                    <span class="keywordflow">if</span> type(message) <span class="keywordflow">is</span> tuple:</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>                        message, _, _ = message</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>                    <span class="keywordflow">if</span> i == 0: message = wrap_sys(self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#af781ad32d8cfa3eb46854935efdadf6e">system</a>) + message</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>                    <span class="keywordflow">if</span> i % 2 == 0:</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>                        message = wrap_inst(message)</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>                        ret += self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ad226cecbaf3967b428df96dd6cdc7838">sep</a> + message</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>                    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>                        ret += <span class="stringliteral">&quot; &quot;</span> + message + <span class="stringliteral">&quot; &quot;</span> + self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#a488eab928bb2bb10cb31d81bcdeec79f">sep2</a></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>                    ret += <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>            ret = ret.lstrip(self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ad226cecbaf3967b428df96dd6cdc7838">sep</a>)</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>        <span class="keywordflow">elif</span> self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ab9968dbbe5f135e7bbad503aadcf822b">sep_style</a> == SeparatorStyle.PLAIN:</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>            seps = [self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ad226cecbaf3967b428df96dd6cdc7838">sep</a>, self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#a488eab928bb2bb10cb31d81bcdeec79f">sep2</a>]</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>            ret = self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#af781ad32d8cfa3eb46854935efdadf6e">system</a></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>            <span class="keywordflow">for</span> i, (role, message) <span class="keywordflow">in</span> enumerate(messages):</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>                <span class="keywordflow">if</span> message:</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>                    <span class="keywordflow">if</span> type(message) <span class="keywordflow">is</span> tuple:</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>                        message, _, _ = message</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>                    ret += message + seps[i % 2]</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>                    ret += <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>            <span class="keywordflow">raise</span> ValueError(f<span class="stringliteral">&quot;Invalid style: {self.sep_style}&quot;</span>)</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span> </div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>        <span class="keywordflow">return</span> ret</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span> </div>
</div>
<div class="foldopen" id="foldopen00109" data-start="" data-end="">
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#a447ccd08d32f4bc78a30bd84690f1607">  109</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classllava_1_1conversation_1_1_conversation.html#a447ccd08d32f4bc78a30bd84690f1607">append_message</a>(self, role, message):</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>        self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ae3a5c57f049e96e6f225434bb9406bcf">messages</a>.append([role, message])</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
</div>
<div class="foldopen" id="foldopen00112" data-start="" data-end="">
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#abfeb3e1f9ead0751b57d2159b62e1f22">  112</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classllava_1_1conversation_1_1_conversation.html#abfeb3e1f9ead0751b57d2159b62e1f22">process_image</a>(self, image, image_process_mode, return_pil=False, image_format=&#39;PNG&#39;, max_len=1344, min_len=672):</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>        <span class="keywordflow">if</span> image_process_mode == <span class="stringliteral">&quot;Pad&quot;</span>:</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>            <span class="keyword">def </span>expand2square(pil_img, background_color=(122, 116, 104)):</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>                width, height = pil_img.size</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>                <span class="keywordflow">if</span> width == height:</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>                    <span class="keywordflow">return</span> pil_img</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>                <span class="keywordflow">elif</span> width &gt; height:</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>                    result = Image.new(pil_img.mode, (width, width), background_color)</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>                    result.paste(pil_img, (0, (width - height) // 2))</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>                    <span class="keywordflow">return</span> result</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>                    result = Image.new(pil_img.mode, (height, height), background_color)</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>                    result.paste(pil_img, ((height - width) // 2, 0))</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>                    <span class="keywordflow">return</span> result</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>            image = expand2square(image)</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>        <span class="keywordflow">elif</span> image_process_mode <span class="keywordflow">in</span> [<span class="stringliteral">&quot;Default&quot;</span>, <span class="stringliteral">&quot;Crop&quot;</span>]:</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>            <span class="keywordflow">pass</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>        <span class="keywordflow">elif</span> image_process_mode == <span class="stringliteral">&quot;Resize&quot;</span>:</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>            image = image.resize((336, 336))</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>            <span class="keywordflow">raise</span> ValueError(f<span class="stringliteral">&quot;Invalid image_process_mode: {image_process_mode}&quot;</span>)</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>        <span class="keywordflow">if</span> max(image.size) &gt; max_len:</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>            max_hw, min_hw = max(image.size), min(image.size)</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>            aspect_ratio = max_hw / min_hw</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>            shortest_edge = int(min(max_len / aspect_ratio, min_len, min_hw))</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>            longest_edge = int(shortest_edge * aspect_ratio)</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>            W, H = image.size</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>            <span class="keywordflow">if</span> H &gt; W:</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>                H, W = longest_edge, shortest_edge</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>                H, W = shortest_edge, longest_edge</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>            image = image.resize((W, H))</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>        <span class="keywordflow">if</span> return_pil:</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>            <span class="keywordflow">return</span> image</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>            buffered = BytesIO()</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>            image.save(buffered, format=image_format)</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>            img_b64_str = base64.b64encode(buffered.getvalue()).decode()</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>            <span class="keywordflow">return</span> img_b64_str</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span> </div>
</div>
<div class="foldopen" id="foldopen00152" data-start="" data-end="">
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#a9d03a129645a872cd36cda6308919996">  152</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classllava_1_1conversation_1_1_conversation.html#a9d03a129645a872cd36cda6308919996">get_images</a>(self, return_pil=False):</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>        images = []</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#adef03d35edfdc1d163abc906bffeb955">  154</a></span>        <span class="keywordflow">for</span> i, (role, msg) <span class="keywordflow">in</span> enumerate(self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ae3a5c57f049e96e6f225434bb9406bcf">messages</a>[self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#adef03d35edfdc1d163abc906bffeb955">offset</a>:]):</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>            <span class="keywordflow">if</span> i % 2 == 0:</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>                <span class="keywordflow">if</span> type(msg) <span class="keywordflow">is</span> tuple:</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>                    msg, image, image_process_mode = msg</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>                    image = self.<a class="code hl_function" href="classllava_1_1conversation_1_1_conversation.html#abfeb3e1f9ead0751b57d2159b62e1f22">process_image</a>(image, image_process_mode, return_pil=return_pil)</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>                    images.append(image)</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        <span class="keywordflow">return</span> images</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span> </div>
</div>
<div class="foldopen" id="foldopen00162" data-start="" data-end="">
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#acb46b7e2ce1ecd9be3892042d6676199">  162</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classllava_1_1conversation_1_1_conversation.html#acb46b7e2ce1ecd9be3892042d6676199">to_gradio_chatbot</a>(self):</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        ret = []</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>        <span class="keywordflow">for</span> i, (role, msg) <span class="keywordflow">in</span> enumerate(self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ae3a5c57f049e96e6f225434bb9406bcf">messages</a>[self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#adef03d35edfdc1d163abc906bffeb955">offset</a>:]):</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>            <span class="keywordflow">if</span> i % 2 == 0:</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>                <span class="keywordflow">if</span> type(msg) <span class="keywordflow">is</span> tuple:</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>                    msg, image, image_process_mode = msg</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>                    img_b64_str = self.<a class="code hl_function" href="classllava_1_1conversation_1_1_conversation.html#abfeb3e1f9ead0751b57d2159b62e1f22">process_image</a>(</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>                        image, <span class="stringliteral">&quot;Default&quot;</span>, return_pil=<span class="keyword">False</span>,</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>                        image_format=<span class="stringliteral">&#39;JPEG&#39;</span>)</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>                    img_str = f<span class="stringliteral">&#39;&lt;img src=&quot;data:image/jpeg;base64,{img_b64_str}&quot; alt=&quot;user upload image&quot; /&gt;&#39;</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>                    msg = img_str + msg.replace(<span class="stringliteral">&#39;&lt;image&gt;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>).strip()</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>                    ret.append([msg, <span class="keywordtype">None</span>])</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>                    ret.append([msg, <span class="keywordtype">None</span>])</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>                ret[-1][-1] = msg</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        <span class="keywordflow">return</span> ret</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span> </div>
</div>
<div class="foldopen" id="foldopen00180" data-start="" data-end="">
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#a38d8efc1a45190d1efce9d318c533cbc">  180</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classllava_1_1conversation_1_1_conversation.html#a38d8efc1a45190d1efce9d318c533cbc">copy</a>(self):</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>        <span class="keywordflow">return</span> <a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>(</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>            system=self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#af781ad32d8cfa3eb46854935efdadf6e">system</a>,</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>            roles=self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#aa85e8b8e6c6921a4ff32e619683dc8ad">roles</a>,</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>            messages=[[x, y] <span class="keywordflow">for</span> x, y <span class="keywordflow">in</span> self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ae3a5c57f049e96e6f225434bb9406bcf">messages</a>],</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>            offset=self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#adef03d35edfdc1d163abc906bffeb955">offset</a>,</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>            sep_style=self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ab9968dbbe5f135e7bbad503aadcf822b">sep_style</a>,</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>            sep=self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ad226cecbaf3967b428df96dd6cdc7838">sep</a>,</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>            sep2=self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#a488eab928bb2bb10cb31d81bcdeec79f">sep2</a>,</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>            version=self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#a867869994113a0c5cbb01e713ed860d1">version</a>)</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span> </div>
</div>
<div class="foldopen" id="foldopen00191" data-start="" data-end="">
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#aba2a2ea7d075a9091f858685ce10f06f">  191</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classllava_1_1conversation_1_1_conversation.html#aba2a2ea7d075a9091f858685ce10f06f">dict</a>(self):</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>        <span class="keywordflow">if</span> len(self.<a class="code hl_function" href="classllava_1_1conversation_1_1_conversation.html#a9d03a129645a872cd36cda6308919996">get_images</a>()) &gt; 0:</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>            <span class="keywordflow">return</span> {</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno"><a class="line" href="classllava_1_1conversation_1_1_conversation.html#af781ad32d8cfa3eb46854935efdadf6e">  194</a></span>                <span class="stringliteral">&quot;system&quot;</span>: self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#af781ad32d8cfa3eb46854935efdadf6e">system</a>,</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>                <span class="stringliteral">&quot;roles&quot;</span>: self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#aa85e8b8e6c6921a4ff32e619683dc8ad">roles</a>,</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>                <span class="stringliteral">&quot;messages&quot;</span>: [[x, y[0] <span class="keywordflow">if</span> type(y) <span class="keywordflow">is</span> tuple <span class="keywordflow">else</span> y] <span class="keywordflow">for</span> x, y <span class="keywordflow">in</span> self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ae3a5c57f049e96e6f225434bb9406bcf">messages</a>],</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>                <span class="stringliteral">&quot;offset&quot;</span>: self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#adef03d35edfdc1d163abc906bffeb955">offset</a>,</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>                <span class="stringliteral">&quot;sep&quot;</span>: self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ad226cecbaf3967b428df96dd6cdc7838">sep</a>,</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>                <span class="stringliteral">&quot;sep2&quot;</span>: self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#a488eab928bb2bb10cb31d81bcdeec79f">sep2</a>,</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>            }</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>        <span class="keywordflow">return</span> {</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>            <span class="stringliteral">&quot;system&quot;</span>: self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#af781ad32d8cfa3eb46854935efdadf6e">system</a>,</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>            <span class="stringliteral">&quot;roles&quot;</span>: self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#aa85e8b8e6c6921a4ff32e619683dc8ad">roles</a>,</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>            <span class="stringliteral">&quot;messages&quot;</span>: self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ae3a5c57f049e96e6f225434bb9406bcf">messages</a>,</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>            <span class="stringliteral">&quot;offset&quot;</span>: self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#adef03d35edfdc1d163abc906bffeb955">offset</a>,</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>            <span class="stringliteral">&quot;sep&quot;</span>: self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#ad226cecbaf3967b428df96dd6cdc7838">sep</a>,</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>            <span class="stringliteral">&quot;sep2&quot;</span>: self.<a class="code hl_variable" href="classllava_1_1conversation_1_1_conversation.html#a488eab928bb2bb10cb31d81bcdeec79f">sep2</a>,</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>        }</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span> </div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span> </div>
</div>
</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#a0ea7e88b34ff4170dcc15bda3c16a08d">  211</a></span>conv_vicuna_v0 = <a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>(</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    system=<span class="stringliteral">&quot;A chat between a curious human and an artificial intelligence assistant. &quot;</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>           <span class="stringliteral">&quot;The assistant gives helpful, detailed, and polite answers to the human&#39;s questions.&quot;</span>,</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    roles=(<span class="stringliteral">&quot;Human&quot;</span>, <span class="stringliteral">&quot;Assistant&quot;</span>),</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    messages=(</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>        (<span class="stringliteral">&quot;Human&quot;</span>, <span class="stringliteral">&quot;What are the key differences between renewable and non-renewable energy sources?&quot;</span>),</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>        (<span class="stringliteral">&quot;Assistant&quot;</span>,</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>            <span class="stringliteral">&quot;Renewable energy sources are those that can be replenished naturally in a relatively &quot;</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>            <span class="stringliteral">&quot;short amount of time, such as solar, wind, hydro, geothermal, and biomass. &quot;</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>            <span class="stringliteral">&quot;Non-renewable energy sources, on the other hand, are finite and will eventually be &quot;</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>            <span class="stringliteral">&quot;depleted, such as coal, oil, and natural gas. Here are some key differences between &quot;</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>            <span class="stringliteral">&quot;renewable and non-renewable energy sources:\n&quot;</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>            <span class="stringliteral">&quot;1. Availability: Renewable energy sources are virtually inexhaustible, while non-renewable &quot;</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>            <span class="stringliteral">&quot;energy sources are finite and will eventually run out.\n&quot;</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>            <span class="stringliteral">&quot;2. Environmental impact: Renewable energy sources have a much lower environmental impact &quot;</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>            <span class="stringliteral">&quot;than non-renewable sources, which can lead to air and water pollution, greenhouse gas emissions, &quot;</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>            <span class="stringliteral">&quot;and other negative effects.\n&quot;</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>            <span class="stringliteral">&quot;3. Cost: Renewable energy sources can be more expensive to initially set up, but they typically &quot;</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>            <span class="stringliteral">&quot;have lower operational costs than non-renewable sources.\n&quot;</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>            <span class="stringliteral">&quot;4. Reliability: Renewable energy sources are often more reliable and can be used in more remote &quot;</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>            <span class="stringliteral">&quot;locations than non-renewable sources.\n&quot;</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>            <span class="stringliteral">&quot;5. Flexibility: Renewable energy sources are often more flexible and can be adapted to different &quot;</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>            <span class="stringliteral">&quot;situations and needs, while non-renewable sources are more rigid and inflexible.\n&quot;</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>            <span class="stringliteral">&quot;6. Sustainability: Renewable energy sources are more sustainable over the long term, while &quot;</span></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>            <span class="stringliteral">&quot;non-renewable sources are not, and their depletion can lead to economic and social instability.\n&quot;</span>)</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    ),</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    offset=2,</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    sep_style=SeparatorStyle.SINGLE,</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    sep=<span class="stringliteral">&quot;###&quot;</span>,</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>)</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span> </div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#a8bc33fc17d5ec73e58df6d8d68e1cdb6">  242</a></span>conv_vicuna_v1 = <a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>(</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    system=<span class="stringliteral">&quot;A chat between a curious user and an artificial intelligence assistant. &quot;</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    <span class="stringliteral">&quot;The assistant gives helpful, detailed, and polite answers to the user&#39;s questions.&quot;</span>,</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    roles=(<span class="stringliteral">&quot;USER&quot;</span>, <span class="stringliteral">&quot;ASSISTANT&quot;</span>),</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    version=<span class="stringliteral">&quot;v1&quot;</span>,</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>    messages=(),</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>    offset=0,</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>    sep_style=SeparatorStyle.TWO,</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    sep=<span class="stringliteral">&quot; &quot;</span>,</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    sep2=<span class="stringliteral">&quot;&lt;/s&gt;&quot;</span>,</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>)</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#ab81d01c1151226c6f4c05e96d70ea904">  254</a></span>conv_llama_2 = <a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>(</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    system=<span class="stringliteral">&quot;&quot;&quot;You are a helpful, respectful and honest assistant. Always answer as helpfully as possible, while being safe.  Your answers should not include any harmful, unethical, racist, sexist, toxic, dangerous, or illegal content. Please ensure that your responses are socially unbiased and positive in nature.</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span><span class="stringliteral">If a question does not make any sense, or is not factually coherent, explain why instead of answering something not correct. If you don&#39;t know the answer to a question, please don&#39;t share false information.&quot;&quot;&quot;</span>,</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    roles=(<span class="stringliteral">&quot;USER&quot;</span>, <span class="stringliteral">&quot;ASSISTANT&quot;</span>),</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    version=<span class="stringliteral">&quot;llama_v2&quot;</span>,</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    messages=(),</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    offset=0,</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    sep_style=SeparatorStyle.LLAMA_2,</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    sep=<span class="stringliteral">&quot;&lt;s&gt;&quot;</span>,</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    sep2=<span class="stringliteral">&quot;&lt;/s&gt;&quot;</span>,</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>)</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#aee4891707f40527c86c0483aed04dec7">  267</a></span>conv_llava_llama_2 = <a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>(</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    system=<span class="stringliteral">&quot;You are a helpful language and vision assistant. &quot;</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>           <span class="stringliteral">&quot;You are able to understand the visual content that the user provides, &quot;</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>           <span class="stringliteral">&quot;and assist the user with a variety of tasks using natural language.&quot;</span>,</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    roles=(<span class="stringliteral">&quot;USER&quot;</span>, <span class="stringliteral">&quot;ASSISTANT&quot;</span>),</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    version=<span class="stringliteral">&quot;llama_v2&quot;</span>,</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    messages=(),</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    offset=0,</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>    sep_style=SeparatorStyle.LLAMA_2,</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    sep=<span class="stringliteral">&quot;&lt;s&gt;&quot;</span>,</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    sep2=<span class="stringliteral">&quot;&lt;/s&gt;&quot;</span>,</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>)</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span> </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#a1bfa9feb395cdbf2877280180b20afeb">  280</a></span>conv_mpt = <a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>(</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>    system=<span class="stringliteral">&quot;&quot;&quot;&lt;|im_start|&gt;system</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span><span class="stringliteral">A conversation between a user and an LLM-based AI assistant. The assistant gives helpful and honest answers.&quot;&quot;&quot;</span>,</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    roles=(<span class="stringliteral">&quot;&lt;|im_start|&gt;user\n&quot;</span>, <span class="stringliteral">&quot;&lt;|im_start|&gt;assistant\n&quot;</span>),</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>    version=<span class="stringliteral">&quot;mpt&quot;</span>,</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    messages=(),</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    offset=0,</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    sep_style=SeparatorStyle.MPT,</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    sep=<span class="stringliteral">&quot;&lt;|im_end|&gt;&quot;</span>,</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>)</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span> </div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#a13d74de68160e56b91eefeda821aea34">  291</a></span>conv_llava_plain = <a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>(</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>    system=<span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>    roles=(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>),</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    messages=(</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    ),</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>    offset=0,</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    sep_style=SeparatorStyle.PLAIN,</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>    sep=<span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>)</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span> </div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#a5193c5b29e23374ccc3994d186962609">  301</a></span>conv_llava_v0 = <a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>(</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>    system=<span class="stringliteral">&quot;A chat between a curious human and an artificial intelligence assistant. &quot;</span></div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>           <span class="stringliteral">&quot;The assistant gives helpful, detailed, and polite answers to the human&#39;s questions.&quot;</span>,</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    roles=(<span class="stringliteral">&quot;Human&quot;</span>, <span class="stringliteral">&quot;Assistant&quot;</span>),</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    messages=(</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    ),</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    offset=0,</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>    sep_style=SeparatorStyle.SINGLE,</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    sep=<span class="stringliteral">&quot;###&quot;</span>,</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>)</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span> </div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#ac62bbf7722871c6913873056481dfce4">  312</a></span>conv_llava_v0_mmtag = <a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>(</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>    system=<span class="stringliteral">&quot;A chat between a curious user and an artificial intelligence assistant. &quot;</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>           <span class="stringliteral">&quot;The assistant is able to understand the visual content that the user provides, and assist the user with a variety of tasks using natural language.&quot;</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>           <span class="stringliteral">&quot;The visual content will be provided with the following format: &lt;Image&gt;visual content&lt;/Image&gt;.&quot;</span>,</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    roles=(<span class="stringliteral">&quot;Human&quot;</span>, <span class="stringliteral">&quot;Assistant&quot;</span>),</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>    messages=(</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    ),</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    offset=0,</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    sep_style=SeparatorStyle.SINGLE,</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    sep=<span class="stringliteral">&quot;###&quot;</span>,</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>    version=<span class="stringliteral">&quot;v0_mmtag&quot;</span>,</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>)</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#ab96947de3105fb8ead71d55a055fec06">  325</a></span>conv_llava_v1 = <a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>(</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    system=<span class="stringliteral">&quot;A chat between a curious human and an artificial intelligence assistant. &quot;</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>           <span class="stringliteral">&quot;The assistant gives helpful, detailed, and polite answers to the human&#39;s questions.&quot;</span>,</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    roles=(<span class="stringliteral">&quot;USER&quot;</span>, <span class="stringliteral">&quot;ASSISTANT&quot;</span>),</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    version=<span class="stringliteral">&quot;v1&quot;</span>,</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    messages=(),</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    offset=0,</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>    sep_style=SeparatorStyle.TWO,</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    sep=<span class="stringliteral">&quot; &quot;</span>,</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    sep2=<span class="stringliteral">&quot;&lt;/s&gt;&quot;</span>,</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>)</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span> </div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#a58a7c20021b9a112b108f907b4b1b290">  337</a></span>conv_llava_v1_mmtag = <a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>(</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    system=<span class="stringliteral">&quot;A chat between a curious user and an artificial intelligence assistant. &quot;</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>           <span class="stringliteral">&quot;The assistant is able to understand the visual content that the user provides, and assist the user with a variety of tasks using natural language.&quot;</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>           <span class="stringliteral">&quot;The visual content will be provided with the following format: &lt;Image&gt;visual content&lt;/Image&gt;.&quot;</span>,</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>    roles=(<span class="stringliteral">&quot;USER&quot;</span>, <span class="stringliteral">&quot;ASSISTANT&quot;</span>),</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>    messages=(),</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>    offset=0,</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    sep_style=SeparatorStyle.TWO,</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    sep=<span class="stringliteral">&quot; &quot;</span>,</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    sep2=<span class="stringliteral">&quot;&lt;/s&gt;&quot;</span>,</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    version=<span class="stringliteral">&quot;v1_mmtag&quot;</span>,</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>)</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span> </div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#a4a7ea6a07c18c32b74f6aaab78cd7484">  350</a></span>conv_mistral_instruct = <a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>(</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    system=<span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>    roles=(<span class="stringliteral">&quot;USER&quot;</span>, <span class="stringliteral">&quot;ASSISTANT&quot;</span>),</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    version=<span class="stringliteral">&quot;llama_v2&quot;</span>,</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    messages=(),</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    offset=0,</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    sep_style=SeparatorStyle.LLAMA_2,</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    sep=<span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>    sep2=<span class="stringliteral">&quot;&lt;/s&gt;&quot;</span>,</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>)</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span> </div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#aaed194350e5e5982ccfe886cdfacef92">  361</a></span>conv_chatml_direct = <a class="code hl_class" href="classllava_1_1conversation_1_1_conversation.html">Conversation</a>(</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    system=<span class="stringliteral">&quot;&quot;&quot;&lt;|im_start|&gt;system</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span><span class="stringliteral">Answer the questions.&quot;&quot;&quot;</span>,</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    roles=(<span class="stringliteral">&quot;&lt;|im_start|&gt;user\n&quot;</span>, <span class="stringliteral">&quot;&lt;|im_start|&gt;assistant\n&quot;</span>),</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    version=<span class="stringliteral">&quot;mpt&quot;</span>,</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    messages=(),</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>    offset=0,</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    sep_style=SeparatorStyle.MPT,</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>    sep=<span class="stringliteral">&quot;&lt;|im_end|&gt;&quot;</span>,</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>)</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span> </div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#ab81a5d5030ea37093c29f5026d602d86">  372</a></span>default_conversation = conv_vicuna_v1</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno"><a class="line" href="namespacellava_1_1conversation.html#a738d06459c92a97d57206c98c314ceec">  373</a></span>conv_templates = {</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>    <span class="stringliteral">&quot;default&quot;</span>: conv_vicuna_v0,</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>    <span class="stringliteral">&quot;v0&quot;</span>: conv_vicuna_v0,</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    <span class="stringliteral">&quot;v1&quot;</span>: conv_vicuna_v1,</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    <span class="stringliteral">&quot;vicuna_v1&quot;</span>: conv_vicuna_v1,</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>    <span class="stringliteral">&quot;llama_2&quot;</span>: conv_llama_2,</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>    <span class="stringliteral">&quot;mistral_instruct&quot;</span>: conv_mistral_instruct,</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    <span class="stringliteral">&quot;chatml_direct&quot;</span>: conv_chatml_direct,</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    <span class="stringliteral">&quot;mistral_direct&quot;</span>: conv_chatml_direct,</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span> </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    <span class="stringliteral">&quot;plain&quot;</span>: conv_llava_plain,</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <span class="stringliteral">&quot;v0_plain&quot;</span>: conv_llava_plain,</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    <span class="stringliteral">&quot;llava_v0&quot;</span>: conv_llava_v0,</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    <span class="stringliteral">&quot;v0_mmtag&quot;</span>: conv_llava_v0_mmtag,</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <span class="stringliteral">&quot;llava_v1&quot;</span>: conv_llava_v1,</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    <span class="stringliteral">&quot;v1_mmtag&quot;</span>: conv_llava_v1_mmtag,</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="stringliteral">&quot;llava_llama_2&quot;</span>: conv_llava_llama_2,</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span> </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    <span class="stringliteral">&quot;mpt&quot;</span>: conv_mpt,</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>}</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span> </div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span> </div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    print(default_conversation.get_prompt())</div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html">llava.conversation.Conversation</a></div><div class="ttdef"><b>Definition</b> <a href="#l00019">conversation.py:19</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_a38d8efc1a45190d1efce9d318c533cbc"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#a38d8efc1a45190d1efce9d318c533cbc">llava.conversation.Conversation.copy</a></div><div class="ttdeci">copy(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00180">conversation.py:180</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_a447ccd08d32f4bc78a30bd84690f1607"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#a447ccd08d32f4bc78a30bd84690f1607">llava.conversation.Conversation.append_message</a></div><div class="ttdeci">append_message(self, role, message)</div><div class="ttdef"><b>Definition</b> <a href="#l00109">conversation.py:109</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_a488eab928bb2bb10cb31d81bcdeec79f"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#a488eab928bb2bb10cb31d81bcdeec79f">llava.conversation.Conversation.sep2</a></div><div class="ttdeci">str sep2</div><div class="ttdef"><b>Definition</b> <a href="#l00027">conversation.py:27</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_a867869994113a0c5cbb01e713ed860d1"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#a867869994113a0c5cbb01e713ed860d1">llava.conversation.Conversation.version</a></div><div class="ttdeci">str version</div><div class="ttdef"><b>Definition</b> <a href="#l00028">conversation.py:28</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_a9d03a129645a872cd36cda6308919996"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#a9d03a129645a872cd36cda6308919996">llava.conversation.Conversation.get_images</a></div><div class="ttdeci">get_images(self, return_pil=False)</div><div class="ttdef"><b>Definition</b> <a href="#l00152">conversation.py:152</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_aa23fe0d270adbdfe0bd8fed0a5cc5e20"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#aa23fe0d270adbdfe0bd8fed0a5cc5e20">llava.conversation.Conversation.get_prompt</a></div><div class="ttdeci">get_prompt(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00032">conversation.py:32</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_aa85e8b8e6c6921a4ff32e619683dc8ad"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#aa85e8b8e6c6921a4ff32e619683dc8ad">llava.conversation.Conversation.roles</a></div><div class="ttdeci">List roles</div><div class="ttdef"><b>Definition</b> <a href="#l00022">conversation.py:22</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_ab9968dbbe5f135e7bbad503aadcf822b"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#ab9968dbbe5f135e7bbad503aadcf822b">llava.conversation.Conversation.sep_style</a></div><div class="ttdeci">SeparatorStyle sep_style</div><div class="ttdef"><b>Definition</b> <a href="#l00025">conversation.py:25</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_aba2a2ea7d075a9091f858685ce10f06f"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#aba2a2ea7d075a9091f858685ce10f06f">llava.conversation.Conversation.dict</a></div><div class="ttdeci">dict(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00191">conversation.py:191</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_abfeb3e1f9ead0751b57d2159b62e1f22"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#abfeb3e1f9ead0751b57d2159b62e1f22">llava.conversation.Conversation.process_image</a></div><div class="ttdeci">process_image(self, image, image_process_mode, return_pil=False, image_format=&#39;PNG&#39;, max_len=1344, min_len=672)</div><div class="ttdef"><b>Definition</b> <a href="#l00112">conversation.py:112</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_acb46b7e2ce1ecd9be3892042d6676199"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#acb46b7e2ce1ecd9be3892042d6676199">llava.conversation.Conversation.to_gradio_chatbot</a></div><div class="ttdeci">to_gradio_chatbot(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00162">conversation.py:162</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_ad226cecbaf3967b428df96dd6cdc7838"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#ad226cecbaf3967b428df96dd6cdc7838">llava.conversation.Conversation.sep</a></div><div class="ttdeci">str sep</div><div class="ttdef"><b>Definition</b> <a href="#l00026">conversation.py:26</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_adef03d35edfdc1d163abc906bffeb955"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#adef03d35edfdc1d163abc906bffeb955">llava.conversation.Conversation.offset</a></div><div class="ttdeci">]) offset</div><div class="ttdef"><b>Definition</b> <a href="#l00154">conversation.py:154</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_ae3a5c57f049e96e6f225434bb9406bcf"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#ae3a5c57f049e96e6f225434bb9406bcf">llava.conversation.Conversation.messages</a></div><div class="ttdeci">List messages</div><div class="ttdef"><b>Definition</b> <a href="#l00023">conversation.py:23</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_conversation_html_af781ad32d8cfa3eb46854935efdadf6e"><div class="ttname"><a href="classllava_1_1conversation_1_1_conversation.html#af781ad32d8cfa3eb46854935efdadf6e">llava.conversation.Conversation.system</a></div><div class="ttdeci">system</div><div class="ttdef"><b>Definition</b> <a href="#l00194">conversation.py:194</a></div></div>
<div class="ttc" id="aclassllava_1_1conversation_1_1_separator_style_html"><div class="ttname"><a href="classllava_1_1conversation_1_1_separator_style.html">llava.conversation.SeparatorStyle</a></div><div class="ttdef"><b>Definition</b> <a href="#l00009">conversation.py:9</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_37cf2145a883c1decbd06f2f48a5ebfd.html">llava</a></li><li class="navelem"><a class="el" href="conversation_8py.html">conversation.py</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.0 </li>
  </ul>
</div>
</body>
</html>
